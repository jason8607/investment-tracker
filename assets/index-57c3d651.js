import{r as Ct,o as m,c as f,a as t,F as nt,b as rt,d as Q,w as ht,t as c,u as et,e as Yt,f as Jt,g as at,n as j,T as Zt,h as dt,i as Kt,K as Ht,C as mt,A as _t,p as vt,j as pt,k as wt,L as $t,B as kt,P as Ft,l as zt,m as bt,q as N,s as V,v as Nt,x as ft,y as Xt,z as Vt,D as tt,E as L,G as Ut,H as At,I as Gt,J as jt,M as Qt,N as St,O as Tt,Q as Wt,R as Rt,S as O,U as H,V as It,W as te,X as ee,Y as se}from"./vendor-386eb522.js";(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))k(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&k(i)}).observe(document,{childList:!0,subtree:!0});function C(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function k(n){if(n.ep)return;n.ep=!0;const o=C(n);fetch(n.href,o)}})();const Pt="investment-tracker-stocks",qt="investment-tracker-realized";function gt(){const $=()=>{try{const v=localStorage.getItem(Pt);return v?JSON.parse(v):[]}catch(v){return console.error("無法讀取持股資料",v),[]}},d=v=>{try{localStorage.setItem(Pt,JSON.stringify(v))}catch(x){console.error("無法儲存持股資料",x)}},C=v=>{const x=$();x.push(v),d(x)},k=(v,x)=>{const a=$();a[v]=x,d(a)},n=v=>{const x=$();x.splice(v,1),d(x)},o=()=>{try{const v=localStorage.getItem(qt);return v?JSON.parse(v):[]}catch(v){return console.error("無法讀取已實現收益資料",v),[]}},i=v=>{try{localStorage.setItem(qt,JSON.stringify(v))}catch(x){console.error("無法儲存已實現收益資料",x)}};return{getStocks:$,setStocks:d,addStock:C,updateStock:k,deleteStock:n,getRealizedTrades:o,setRealizedTrades:i,addRealizedTrade:v=>{const x=o();x.push(v),i(x)},updateRealizedTrade:(v,x)=>{const a=o();a[v]=x,i(a)},deleteRealizedTrade:v=>{const x=o();x.splice(v,1),i(x)}}}const le={class:"min-h-screen"},ae={class:"bg-primary text-white p-4 shadow-md"},oe={class:"container mx-auto flex justify-between items-center"},ne={class:"flex space-x-2"},re={class:"btn bg-secondary text-white text-sm px-3 py-1 cursor-pointer"},ie={class:"bg-white shadow-sm"},ue={class:"container mx-auto"},ce={class:"flex"},de={class:"container mx-auto p-4"},me={class:"bg-gray-100 text-gray-600 p-4 text-center text-sm"},ve={__name:"App",setup($){const{getStocks:d,getRealizedTrades:C,setStocks:k,setRealizedTrades:n}=gt(),o=[{name:"持股管理",path:"/"},{name:"已實現收益",path:"/realized"},{name:"圖表分析",path:"/charts"}],i=()=>{const T=et.book_new(),S=d(),v=C(),x=S.map(P=>({股票代碼:P.symbol,股票名稱:P.name,市場:P.market,成本價:P.cost,數量:P.quantity,購買日期:P.purchaseDate})),a=v.map(P=>({股票代碼:P.symbol,股票名稱:P.name,賣出價格:P.sellPrice,數量:P.quantity,成本:P.cost,實現損益:P.profit,日期:P.date})),g=et.json_to_sheet(x),W=et.json_to_sheet(a);et.book_append_sheet(T,g,"持股紀錄"),et.book_append_sheet(T,W,"已實現收益"),Yt(T,"投資損益資料.xlsx")},D=T=>{const S=T.target.files[0];if(!S)return;const v=new FileReader;v.onload=x=>{const a=new Uint8Array(x.target.result),g=Jt(a,{type:"array"}),W=g.Sheets.持股紀錄;if(W){const r=et.sheet_to_json(W).map(q=>({symbol:q.股票代碼,name:q.股票名稱,market:q.市場,cost:parseFloat(q.成本價),quantity:parseInt(q.數量),purchaseDate:q.購買日期}));k(r)}const P=g.Sheets.已實現收益;if(P){const r=et.sheet_to_json(P).map(q=>({symbol:q.股票代碼,name:q.股票名稱,sellPrice:parseFloat(q.賣出價格),quantity:parseInt(q.數量),cost:parseFloat(q.成本),profit:parseFloat(q.實現損益),date:q.日期}));n(r)}T.target.value="",alert("資料匯入成功！")},v.readAsArrayBuffer(S)};return(T,S)=>{const v=Ct("router-link"),x=Ct("router-view");return m(),f("div",le,[t("header",ae,[t("div",oe,[S[3]||(S[3]=t("h1",{class:"text-xl md:text-2xl font-bold"},"投資損益小幫手",-1)),t("div",ne,[t("button",{onClick:i,class:"btn bg-secondary text-white text-sm px-3 py-1"},S[0]||(S[0]=[t("span",{class:"hidden md:inline"},"匯出資料",-1),t("span",{class:"md:hidden"},"匯出",-1)])),t("label",re,[S[1]||(S[1]=t("span",{class:"hidden md:inline"},"匯入資料",-1)),S[2]||(S[2]=t("span",{class:"md:hidden"},"匯入",-1)),t("input",{type:"file",accept:".xlsx",class:"hidden",onChange:D},null,32)])])])]),t("nav",ie,[t("div",ue,[t("ul",ce,[(m(),f(nt,null,rt(o,a=>t("li",{key:a.path},[Q(v,{to:a.path,class:j(["block px-4 py-3 hover:bg-gray-100 transition-colors border-b-2",T.$route.path===a.path?"border-primary text-primary font-medium":"border-transparent"])},{default:ht(()=>[at(c(a.name),1)]),_:2},1032,["to","class"])])),64))])])]),t("main",de,[Q(x,null,{default:ht(({Component:a})=>[Q(Zt,{name:"fade",mode:"out-in"},{default:ht(()=>[(m(),dt(Ht,null,[(m(),dt(Kt(a),{key:T.$route.path}))],1024))]),_:2},1024)]),_:1})]),t("footer",me,[t("p",null,"投資損益小幫手 © "+c(new Date().getFullYear()),1)])])}}};const pe={class:"mb-6"},be={class:"flex flex-wrap space-x-2"},fe=["onClick"],ge={class:"card"},ye={key:0,class:"p-4"},he={key:0,class:"text-center py-6 text-gray-500"},xe={key:1,class:"flex flex-col md:flex-row"},_e={class:"w-full md:w-1/2 min-h-[300px]"},we={key:0},$e={key:1,class:"h-[300px] flex items-center justify-center"},ke={class:"w-full md:w-1/2 p-4"},Se={class:"flex-1"},De={class:"text-right"},Ce={key:1,class:"p-4"},Te={key:0,class:"text-center py-6 text-gray-500"},Pe={key:1,class:"min-h-[300px]"},qe={key:0},Fe={key:1,class:"h-[300px] flex items-center justify-center"},ze={key:2,class:"p-4"},Ne={key:0,class:"text-center py-6 text-gray-500"},Ve={key:1,class:"min-h-[300px]"},Ue={key:0},Ae={key:1,class:"h-[300px] flex items-center justify-center"},je={__name:"ChartsView",setup($){mt.register(_t,vt,pt,wt,$t,kt,Ft,zt,bt);const{getStocks:d,getRealizedTrades:C}=gt(),k=N("allocation"),n=N([]),o=N([]),i=N({}),D=N(!1),T=N(!0),S=[{id:"allocation",name:"持股分配"},{id:"profit",name:"總體損益"},{id:"realized",name:"已實現收益趨勢"}],v=["#4CAF50","#2196F3","#F44336","#FF9800","#9C27B0","#3F51B5","#009688","#795548","#607D8B","#E91E63"],x=V(()=>n.value&&n.value.length>0),a=V(()=>o.value&&o.value.length>0),g=V(()=>x.value||a.value);Nt([n,o,i],()=>{(x.value||a.value)&&Object.keys(i.value).length>0&&(console.log("圖表數據已就緒"),D.value=!0)},{deep:!0});const W=V(()=>{if(!x.value)return[];const y=n.value.map(_=>{var F;const A=(((F=i.value[_.symbol])==null?void 0:F.price)||_.cost)*_.quantity;return{..._,marketValue:A}}),p=y.reduce((_,U)=>_+U.marketValue,0);return y.map(_=>({..._,percentage:_.marketValue/p*100})).sort((_,U)=>U.marketValue-_.marketValue)}),P=V(()=>x.value?{labels:W.value.map(y=>y.name),datasets:[{data:W.value.map(y=>y.marketValue),backgroundColor:W.value.map((y,p)=>v[p%v.length]),hoverOffset:4}]}:{labels:[],datasets:[{data:[],backgroundColor:[],hoverOffset:4}]}),I=V(()=>{const y=["未實現損益","已實現收益","總體損益"];if(!g.value)return{labels:y,datasets:[{label:"損益金額",data:[0,0,0],backgroundColor:Array(3).fill("rgba(200, 200, 200, 0.6)"),borderColor:Array(3).fill("rgb(200, 200, 200)"),borderWidth:1}]};const p=n.value.reduce((F,Z)=>{var K;const st=(((K=i.value[Z.symbol])==null?void 0:K.price)||Z.cost)*Z.quantity,M=Z.cost*Z.quantity;return F+(st-M)},0),_=o.value.reduce((F,Z)=>F+Z.profit,0),U=p+_,A=[p,_,U];return{labels:y,datasets:[{label:"損益金額",data:A,backgroundColor:A.map(F=>F>=0?"rgba(76, 175, 80, 0.6)":"rgba(244, 67, 54, 0.6)"),borderColor:A.map(F=>F>=0?"rgb(76, 175, 80)":"rgb(244, 67, 54)"),borderWidth:1}]}}),r=V(()=>{if(!a.value)return{labels:[],datasets:[{label:"累計已實現收益",data:[],borderColor:"rgb(54, 162, 235)",backgroundColor:"rgba(54, 162, 235, 0.5)",tension:.1,pointBackgroundColor:[]}]};const y=[...o.value].sort((A,F)=>new Date(A.date)-new Date(F.date));let p=0;const _=[],U=[];return y.forEach(A=>{p+=A.profit,_.push(p),U.push(Ut(A.date).format("YYYY/MM/DD"))}),{labels:U,datasets:[{label:"累計已實現收益",data:_,borderColor:"rgb(54, 162, 235)",backgroundColor:"rgba(54, 162, 235, 0.5)",tension:.1,pointBackgroundColor:_.map(A=>A>=0?"rgb(76, 175, 80)":"rgb(244, 67, 54)")}]}}),q={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(y){const p=y.label||"",_=y.raw||0,U=_/y.dataset.data.reduce((A,F)=>A+F,0)*100;return`${p}: ${J(_)} (${U.toFixed(2)}%)`}}}}},X={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(y){return`${y.dataset.label}: ${J(y.raw)}`}}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(y){return J(y)}}}}},Y={responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{callbacks:{label:function(y){return`${y.dataset.label}: ${J(y.raw)}`}}}},scales:{y:{ticks:{callback:function(y){return J(y)}}}}},J=y=>new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(y),E=()=>{try{D.value=!1,n.value=d()||[],o.value=C()||[],console.log(`載入了 ${n.value.length} 支股票和 ${o.value.length} 筆交易記錄`);const y={};n.value.forEach(p=>{p&&p.symbol&&(y[p.symbol]={price:p.cost||0,change:0,changePercent:0})}),i.value=y;try{const p=localStorage.getItem("investment-tracker-prices");if(p){const _=JSON.parse(p);_&&typeof _=="object"&&(i.value={...i.value,..._})}}catch(p){console.error("無法讀取價格資料",p)}setTimeout(()=>{n.value&&n.value.length>0||o.value&&o.value.length>0?(console.log("圖表數據驗證成功，準備渲染圖表"),D.value=!0):console.log("無有效數據，不渲染圖表")},100)}catch(y){console.error("載入數據時出錯:",y),n.value=[],o.value=[],i.value={},D.value=!1}};return ft(()=>{console.log("圖表分析頁面加載中...");try{E(),T.value=!1;const y=p=>{(p.key==="investment-tracker-stocks"||p.key==="investment-tracker-realized"||p.key==="investment-tracker-prices")&&(console.log("儲存數據變更，重新載入圖表數據"),D.value=!1,setTimeout(()=>{E()},50))};window.addEventListener("storage",y),Xt(()=>{console.log("移除儲存變化事件監聽器"),window.removeEventListener("storage",y)})}catch(y){console.error("圖表分析頁面初始化失敗:",y),n.value=[],o.value=[],i.value={},D.value=!1}}),Vt(()=>{if(console.log("圖表分析頁面激活中，初次掛載狀態:",T.value),T.value){T.value=!1;return}try{E()}catch(y){console.error("圖表分析頁面激活時失敗:",y)}}),(y,p)=>(m(),f("div",null,[p[7]||(p[7]=t("h2",{class:"text-xl font-bold mb-4"},"圖表分析",-1)),t("div",pe,[t("div",be,[(m(),f(nt,null,rt(S,_=>t("button",{key:_.id,onClick:U=>k.value=_.id,class:j(["px-4 py-2 rounded-md transition-colors mb-2",k.value===_.id?"bg-primary text-white":"bg-gray-100 text-gray-700"])},c(_.name),11,fe)),64))])]),t("div",ge,[k.value==="allocation"?(m(),f("div",ye,[p[2]||(p[2]=t("h3",{class:"text-lg font-medium mb-4"},"持股分配",-1)),x.value?(m(),f("div",xe,[t("div",_e,[D.value&&P.value.datasets[0].data.length>0?(m(),f("div",we,[Q(tt(At),{data:P.value,options:q,height:250},null,8,["data"])])):(m(),f("div",$e,p[0]||(p[0]=[t("p",{class:"text-gray-500"},"正在載入圖表...",-1)])))]),t("div",ke,[p[1]||(p[1]=t("h4",{class:"text-md font-medium mb-2"},"持股比例",-1)),(m(!0),f(nt,null,rt(W.value,(_,U)=>(m(),f("div",{key:U,class:"flex items-center mb-2"},[t("div",{class:"w-4 h-4 rounded-full mr-2",style:Gt({backgroundColor:v[U%v.length]})},null,4),t("div",Se,c(_.name)+" ("+c(_.symbol)+")",1),t("div",De,c(_.percentage.toFixed(2))+"%",1)]))),128))])])):(m(),f("div",he," 尚未新增持股資料，請先在持股管理頁面新增股票。 "))])):L("",!0),k.value==="profit"?(m(),f("div",Ce,[p[4]||(p[4]=t("h3",{class:"text-lg font-medium mb-4"},"總體損益",-1)),g.value?(m(),f("div",Pe,[D.value&&I.value.datasets[0].data.length>0?(m(),f("div",qe,[Q(tt(jt),{data:I.value,options:X,height:250},null,8,["data"])])):(m(),f("div",Fe,p[3]||(p[3]=[t("p",{class:"text-gray-500"},"正在載入圖表...",-1)])))])):(m(),f("div",Te," 尚未有足夠資料，請先新增持股或已實現收益。 "))])):L("",!0),k.value==="realized"?(m(),f("div",ze,[p[6]||(p[6]=t("h3",{class:"text-lg font-medium mb-4"},"已實現收益分析",-1)),a.value?(m(),f("div",Ve,[D.value&&r.value.datasets[0].data.length>0?(m(),f("div",Ue,[Q(tt(Qt),{data:r.value,options:Y,height:250},null,8,["data"])])):(m(),f("div",Ae,p[5]||(p[5]=[t("p",{class:"text-gray-500"},"正在載入圖表...",-1)])))])):(m(),f("div",Ne," 尚未新增已實現收益資料，請先在已實現收益頁面新增資料。 "))])):L("",!0)])]))}},Dt="https://yahoo-finance-backend.vercel.app";let lt={USD_TWD:null,lastUpdated:null};async function We(){const $=new Date;if(lt.USD_TWD&&lt.lastUpdated&&$-lt.lastUpdated<36e5)return console.log("使用緩存的匯率數據"),lt.USD_TWD;try{const d=["USDTWD=X","TWD=X"];let C,k=null;for(const n of d)try{const o=`${Dt}/api/stock/${n}`;if(console.log(`請求美元兌台幣匯率 (${n})...`),C=await St.get(o,{headers:{Accept:"application/json","Cache-Control":"no-cache"},timeout:1e4}),!C.data.error&&C.data.price){k=C.data.price,console.log(`成功獲取美元兌台幣匯率: 1 USD = ${k} TWD (使用${n})`);break}}catch(o){console.error(`使用 ${n} 獲取匯率失敗:`,o.message)}k||(console.log("無法從API獲取匯率，使用預設值"),k=30),lt={USD_TWD:k,lastUpdated:$};try{localStorage.setItem("exchange-rate-cache",JSON.stringify(lt))}catch(n){console.error("無法將匯率數據存入localStorage",n)}return k}catch(d){console.error("獲取匯率失敗:",d);try{const C=localStorage.getItem("exchange-rate-cache");if(C){const k=JSON.parse(C);return console.log("使用localStorage中的匯率數據"),k.USD_TWD}}catch(C){console.error("讀取緩存匯率失敗",C)}return 30}}function xt($){return $?$.includes(".")?$:$.includes(".TW")||$.length<=6&&/^\d{4,}[A-Za-z]?$/.test($)?`${$}.TW`:$:""}async function Ot($){const d=$,C=xt($),k=`${Dt}/api/stock/${C}`;console.log(`請求股票數據：${C}`);try{const n=await St.get(k,{headers:{Accept:"application/json","Cache-Control":"no-cache"},timeout:1e4});if(n.data.error)throw new Error(`API 錯誤: ${n.data.error}`);return console.log(`成功獲取 ${C} 價格: ${n.data.price} ${n.data.currency}`),{...n.data,originalSymbol:d,name:n.data.name||n.data.shortName||n.data.longName||"未知股票"}}catch(n){throw console.error(`獲取 ${C} 價格失敗:`,n),n.response?new Error(`API 請求失敗: ${n.response.status} ${n.response.statusText}`):n.request?new Error("無法連接到服務器，請檢查網絡連接"):n}}async function Re($){const d=$.filter(n=>n&&n.trim());if(d.length===0)return[];const C=d.map(n=>xt(n)),k=`${Dt}/api/stocks?symbols=${C.join(",")}`;console.log(`批量獲取股票數據: ${d.join(", ")}`);try{const n=await St.get(k,{headers:{Accept:"application/json","Cache-Control":"no-cache"},timeout:15e3});return console.log(`成功獲取 ${n.data.length} 支股票數據`),n.data.map((i,D)=>(i.originalSymbol||(i.originalSymbol=d[D]),i.name||(i.name=i.shortName||i.longName||"未知股票"),i))}catch(n){console.error("批量獲取股票數據失敗:",n),console.log("嘗試逐個獲取股票數據...");const o=d.map(i=>Ot(i).catch(D=>(console.error(`獲取 ${i} 數據失敗:`,D),{error:!0,errorMessage:D.message||"未知錯誤",symbol:xt(i),originalSymbol:i,name:"未知股票"})));return Promise.all(o)}}async function Et($){try{const d=await Ot($);return d.name||d.shortName||d.longName||"未知股票"}catch(d){return console.error(`獲取股票 ${$} 名稱失敗:`,d),null}}function ct($){return $==null?"":$>0?"positive":$<0?"negative":""}const Ie={class:"market-pie-chart",style:{width:"250px",height:"250px"}},Oe={key:1,class:"text-center text-gray-500 h-full flex items-center justify-center"},Mt={__name:"MarketPieChart",props:{twValue:{type:Number,required:!0},usValue:{type:Number,required:!0}},setup($){mt.register(_t,vt,pt,bt);const d=$,C=V(()=>{const n=d.twValue>0||d.usValue>0;return{labels:["台股","美股"],datasets:[{backgroundColor:["#36A2EB","#FF6384"],data:n?[d.twValue,d.usValue]:[]}]}}),k={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:n=>{const o=n.label||"",i=n.raw||0,D=d.twValue+d.usValue,T=D>0?(i/D*100).toFixed(2):0;return`${o}: ${T}%`}}}}};return(n,o)=>(m(),f("div",Ie,[C.value.datasets[0].data.length>0?(m(),dt(tt(At),{key:0,data:C.value,options:k,height:250},null,8,["data"])):(m(),f("div",Oe," 暫無資料 "))]))}},Ee={class:"market-bar-chart",style:{width:"250px",height:"250px"}},Me={key:1,class:"text-center text-gray-500 h-full flex items-center justify-center"},Bt={__name:"MarketBarChart",props:{twProfit:{type:Number,required:!0},usProfit:{type:Number,required:!0},twCost:{type:Number,required:!0},usCost:{type:Number,required:!0}},setup($){mt.register(wt,$t,kt,bt,vt,pt);const d=$,C=(o,i)=>i<=0?0:o/i*100,k=V(()=>{const o=C(d.twProfit,d.twCost),i=C(d.usProfit,d.usCost),D=d.twCost>0||d.usCost>0;return{labels:["台股","美股"],datasets:[{label:"報酬率 (%)",backgroundColor:[o>=0?"rgba(76, 175, 80, 0.6)":"rgba(244, 67, 54, 0.6)",i>=0?"rgba(76, 175, 80, 0.6)":"rgba(244, 67, 54, 0.6)"],borderColor:[o>=0?"rgba(76, 175, 80, 1)":"rgba(244, 67, 54, 1)",i>=0?"rgba(76, 175, 80, 1)":"rgba(244, 67, 54, 1)"],borderWidth:1,data:D?[o,i]:[]}]}}),n={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:o=>`報酬率: ${(o.raw||0).toFixed(2)}%`}}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"報酬率 (%)"},ticks:{callback:function(o){return o+"%"}}}}};return ft(()=>{Tt(()=>{k.value.datasets[0].data.length>0&&console.log("Chart data loaded:",k.value)})}),Nt(()=>[d.twProfit,d.usProfit,d.twCost,d.usCost],()=>{Tt(()=>{console.log("Props updated, chart should re-render")})}),(o,i)=>(m(),f("div",Ee,[k.value.datasets[0].data.length>0?(m(),dt(tt(jt),{key:0,data:k.value,options:n,height:250},null,8,["data"])):(m(),f("div",Me," 暫無資料 "))]))}},Be={class:"card bg-white p-4 mb-6"},Le={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Ye={class:"p-3 bg-gray-50 rounded-lg"},Je={class:"text-lg font-semibold"},Ze={class:"p-3 bg-gray-50 rounded-lg"},Ke={class:"text-lg font-semibold"},He={class:"p-3 bg-gray-50 rounded-lg"},Xe={class:"text-sm"},Ge={key:0,class:"card bg-white p-4 mb-6"},Qe={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ts={class:"h-64 flex items-center justify-center"},es={class:"grid grid-cols-2 gap-4 mt-3"},ss={class:"bg-gray-50 p-3 rounded-lg"},ls={class:"font-semibold"},as={class:"bg-gray-50 p-3 rounded-lg"},os={class:"font-semibold"},ns={class:"h-64 flex items-center justify-center"},rs={class:"grid grid-cols-2 gap-4 mt-3"},is={class:"font-semibold"},us={class:"text-xs"},cs={key:1,class:"bg-gray-50 p-3 rounded-lg"},ds={class:"font-semibold"},ms={class:"text-xs"},vs={key:3,class:"bg-gray-50 p-3 rounded-lg"},ps={class:"flex justify-between items-center mb-4"},bs={class:"tabs"},fs={class:"flex items-center"},gs={class:"flex items-center"},ys={class:"text-sm text-gray-500 mr-3"},hs={key:0,class:"inline-block animate-spin"},xs={class:"card"},_s={key:0,class:"text-center py-6 text-gray-500"},ws={key:1,class:"table-container"},$s={class:"table"},ks={class:"flex space-x-2"},Ss=["onClick"],Ds=["onClick"],Cs={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},Ts={class:"bg-white rounded-lg p-6 max-w-md w-full"},Ps={class:"text-lg font-bold mb-4"},qs={class:"mb-4"},Fs={class:"mb-4"},zs=["disabled"],Ns={key:0,class:"text-sm text-gray-500 mt-1"},Vs={class:"mb-4"},Us={class:"mb-4"},As={class:"mb-4"},js={class:"mb-4"},Ws={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},Rs={class:"bg-white rounded-lg p-6 max-w-md w-full"},Is={class:"mb-4"},Os={class:"flex justify-end space-x-3"},Es={__name:"HomeView",setup($){const{getStocks:d,addStock:C,updateStock:k,deleteStock:n}=gt(),o=N([]),i=N({}),D=N(!1),T=N(null),S=N(null),v=N(!1),x=N(30),a=N("all"),g=Wt({symbol:"",name:"",market:"台股",cost:0,quantity:0,purchaseDate:new Date().toISOString().split("T")[0]}),W=N(!1),P=async()=>{if(g.symbol){W.value=!0;try{const l=await Et(g.symbol);l&&(g.name=l,console.log(`自動獲取股票名稱: ${g.symbol} -> ${l}`))}catch(l){console.error("獲取股票名稱失敗:",l)}finally{W.value=!1}}},I=V(()=>a.value==="all"?o.value:a.value==="tw"?o.value.filter(l=>B(l)==="TWD"):a.value==="us"?o.value.filter(l=>B(l)==="USD"):o.value),r=V(()=>{const l={tw:{cost:0,value:0,profit:0},us:{cost:0,value:0,profit:0}};return!o.value||o.value.length===0||o.value.forEach(e=>{const w=B(e),b=e.cost*e.quantity,z=K(e);if(!z||isNaN(z))return;const G=z*e.quantity;if(w==="USD"){const ut=b*x.value,ot=G*x.value;l.us.cost+=ut,l.us.value+=ot,l.us.profit+=ot-ut}else l.tw.cost+=b,l.tw.value+=G,l.tw.profit+=G-b}),l}),q=V(()=>!r.value||!r.value.tw||!r.value.us?0:r.value.tw.cost+r.value.us.cost),X=V(()=>!r.value||!r.value.tw||!r.value.us?0:r.value.tw.value+r.value.us.value),Y=V(()=>!X.value||!q.value?0:X.value-q.value),J=V(()=>q.value===0?0:Y.value/q.value*100),E=V(()=>{if(!r.value||!r.value.tw||!r.value.us)return{tw:0,us:0};const l=r.value.tw.value||0,e=r.value.us.value||0,w=l+e;return w===0?{tw:0,us:0}:{tw:l/w*100,us:e/w*100}}),y=l=>o.value.findIndex(e=>e.symbol===l.symbol),p=()=>{try{console.log("載入持股數據..."),o.value=d()||[],_(!1)}catch(l){console.error("載入持股數據失敗",l),o.value=[]}},_=async(l=!0)=>{if(!(!o.value||o.value.length===0)){l&&(v.value=!0);try{const e=o.value.map(z=>z.symbol).filter(z=>z);if(e.length===0){v.value=!1;return}console.log("正在更新以下股票價格:",e.join(", "));const w=await Re(e);if(!w||w.length===0){console.warn("未獲取到任何股票價格數據"),v.value=!1;return}const b={};w.forEach(z=>{if(!z)return;const G=z.originalSymbol||z.symbol;G&&(b[G]=z)}),console.log("已更新價格數據:",Object.keys(b).join(", ")),i.value=b;try{localStorage.setItem("investment-tracker-prices",JSON.stringify(b))}catch(z){console.error("無法儲存價格資料到本地存儲",z)}}catch(e){console.error("更新價格出錯",e)}finally{l&&(v.value=!1)}}},U=l=>{const e=o.value[l];T.value=l,g.symbol=e.symbol,g.name=e.name,g.market=e.market,g.cost=e.cost,g.quantity=e.quantity,g.purchaseDate=e.purchaseDate||"",D.value=!0},A=l=>{S.value=l},F=()=>{S.value!==null&&(n(S.value),p(),S.value=null)},Z=()=>{const l={symbol:g.symbol,name:g.name,market:g.market,cost:g.cost,quantity:g.quantity,purchaseDate:g.purchaseDate};T.value!==null?k(T.value,l):C(l),p(),T.value=null,D.value=!1,st()},it=()=>{D.value=!1,T.value=null,st()},st=()=>{g.symbol="",g.name="",g.market="台股",g.cost=0,g.quantity=0,g.purchaseDate=new Date().toISOString().split("T")[0]},M=(l,e="TWD")=>{const w=e==="USD"?"US$":"NT$",b=new Intl.NumberFormat("zh-TW",{minimumFractionDigits:0,maximumFractionDigits:0}).format(l);return`${w}${b}`},K=l=>{if(!l||!i.value)return 0;const e=i.value[l.symbol]||i.value[`${l.symbol}.TW`]||Object.values(i.value).find(w=>w&&(w.originalSymbol===l.symbol||w.symbol===l.symbol||w.symbol===`${l.symbol}.TW`));return e&&e.price||0},B=l=>{if(!l)return"TWD";if(l.market==="美股")return"USD";if(i.value){const e=i.value[l.symbol]||i.value[`${l.symbol}.TW`]||Object.values(i.value).find(w=>w&&(w.originalSymbol===l.symbol||w.symbol===l.symbol||w.symbol===`${l.symbol}.TW`));if(e&&e.currency)return e.currency}return l.market==="美股"?"USD":"TWD"},yt=l=>{const e=K(l);return e?`${B(l)==="USD"?"US$":"NT$"}${e.toFixed(2)}`:"載入中..."},u=l=>{if(!l||!i.value)return 0;const e=i.value[l.symbol]||i.value[`${l.symbol}.TW`]||Object.values(i.value).find(w=>w&&(w.originalSymbol===l.symbol||w.symbol===l.symbol||w.symbol===`${l.symbol}.TW`));return(e==null?void 0:e.change)||0},s=l=>{if(!l)return"載入中...";const e=K(l);if(!e)return"載入中...";const w=l.cost*l.quantity,z=e*l.quantity-w,G=w>0?z/w*100:0,ut=B(l),ot=z>=0?"+":"";return`${ot}${M(z,ut)} (${ot}${G.toFixed(2)}%)`},R=(l,e)=>{if(!l||!e)return"";const w=l.cost*l.quantity,z=e*l.quantity-w;return z>0?"positive":z<0?"negative":""},h=(l,e)=>l==null?"-":`${e==="USD"?"US$":"NT$"}${l.toFixed(2)}`;return ft(async()=>{try{const l=localStorage.getItem("exchange-rate-cache");if(l){const w=JSON.parse(l);w.USD_TWD&&(x.value=w.USD_TWD,console.log(`從緩存讀取匯率: 1 USD = ${x.value} TWD`))}p();const e=await We();e&&!isNaN(e)&&(x.value=e,console.log(`設置匯率: 1 USD = ${e} TWD`),_())}catch(l){console.error("頁面初始化時發生錯誤",l)}}),(l,e)=>{var w;return m(),f("div",null,[e[34]||(e[34]=t("h2",{class:"text-xl font-bold mb-4"},"持股管理",-1)),t("div",Be,[t("div",Le,[t("div",Ye,[e[12]||(e[12]=t("h3",{class:"text-gray-500 text-sm"},"總投資成本",-1)),t("p",Je,c(M(q.value)),1)]),t("div",Ze,[e[13]||(e[13]=t("h3",{class:"text-gray-500 text-sm"},"目前總市值",-1)),t("p",Ke,c(M(X.value)),1)]),t("div",He,[e[14]||(e[14]=t("h3",{class:"text-gray-500 text-sm"},"未實現損益",-1)),t("p",{class:j(["text-lg font-semibold",tt(ct)(Y.value)])},[at(c(Y.value>0?"+":"")+c(M(Y.value))+" ",1),t("span",Xe," ("+c(J.value>0?"+":"")+c(J.value.toFixed(2))+"%) ",1)],2)])])]),o.value.length>0?(m(),f("div",Ge,[t("div",Qe,[t("div",null,[e[17]||(e[17]=t("h3",{class:"text-lg font-bold mb-3"},"市場分佈",-1)),t("div",ts,[Q(Mt,{"tw-value":r.value&&r.value.tw?r.value.tw.value:0,"us-value":r.value&&r.value.us?r.value.us.value:0},null,8,["tw-value","us-value"])]),t("div",es,[t("div",ss,[e[15]||(e[15]=t("h4",{class:"text-sm text-gray-500"},"台股占比",-1)),t("p",ls,c(E.value&&E.value.tw?E.value.tw.toFixed(2):"0.00")+"% ",1)]),t("div",as,[e[16]||(e[16]=t("h4",{class:"text-sm text-gray-500"},"美股占比",-1)),t("p",os,c(E.value&&E.value.us?E.value.us.toFixed(2):"0.00")+"% ",1)])])]),t("div",null,[e[22]||(e[22]=t("h3",{class:"text-lg font-bold mb-3"},"市場表現",-1)),t("div",ns,[Q(Bt,{"tw-profit":r.value&&r.value.tw?r.value.tw.profit:0,"us-profit":r.value&&r.value.us?r.value.us.profit:0,"tw-cost":r.value&&r.value.tw?r.value.tw.cost:0,"us-cost":r.value&&r.value.us?r.value.us.cost:0},null,8,["tw-profit","us-profit","tw-cost","us-cost"])]),t("div",rs,[r.value&&r.value.tw?(m(),f("div",{key:0,class:j(["bg-gray-50 p-3 rounded-lg",tt(ct)(r.value.tw.profit)])},[e[18]||(e[18]=t("h4",{class:"text-sm text-gray-500"},"台股損益",-1)),t("p",is,[at(c(r.value.tw.profit>0?"+":"")+c(M(r.value.tw.profit))+" ",1),t("span",us," ("+c(r.value.tw.cost>0?(r.value.tw.profit/r.value.tw.cost*100).toFixed(2)+"%":"0%")+") ",1)])],2)):(m(),f("div",cs,e[19]||(e[19]=[t("h4",{class:"text-sm text-gray-500"},"台股損益",-1),t("p",{class:"font-semibold"},"NT$0",-1)]))),r.value&&r.value.us?(m(),f("div",{key:2,class:j(["bg-gray-50 p-3 rounded-lg",tt(ct)(r.value.us.profit)])},[e[20]||(e[20]=t("h4",{class:"text-sm text-gray-500"},"美股損益",-1)),t("p",ds,[at(c(r.value.us.profit>0?"+":"")+c(M(r.value.us.profit))+" ",1),t("span",ms," ("+c(r.value.us.cost>0?(r.value.us.profit/r.value.us.cost*100).toFixed(2)+"%":"0%")+") ",1)])],2)):(m(),f("div",vs,e[21]||(e[21]=[t("h4",{class:"text-sm text-gray-500"},"美股損益",-1),t("p",{class:"font-semibold"},"US$0",-1)])))])])])])):L("",!0),t("div",ps,[t("div",bs,[t("button",{onClick:e[0]||(e[0]=b=>a.value="all"),class:j(["tab-btn mr-2 px-4 py-2 rounded-lg",a.value==="all"?"bg-primary text-white":"bg-gray-100"])}," 全部持股 ",2),t("button",{onClick:e[1]||(e[1]=b=>a.value="tw"),class:j(["tab-btn mr-2 px-4 py-2 rounded-lg",a.value==="tw"?"bg-primary text-white":"bg-gray-100"])}," 台股 ",2),t("button",{onClick:e[2]||(e[2]=b=>a.value="us"),class:j(["tab-btn px-4 py-2 rounded-lg",a.value==="us"?"bg-primary text-white":"bg-gray-100"])}," 美股 ",2)]),t("div",fs,[t("button",{onClick:e[3]||(e[3]=b=>D.value=!0),class:"btn btn-primary mr-2"}," + 新增持股 "),t("div",gs,[t("span",ys,"匯率: 1 USD = "+c(x.value.toFixed(2))+" TWD",1),t("button",{onClick:_,class:"btn bg-gray-100 text-gray-700 flex items-center"},[e[23]||(e[23]=t("span",{class:"mr-1"},"更新價格",-1)),v.value?(m(),f("span",hs,"⟳")):L("",!0)])])])]),t("div",xs,[I.value.length===0?(m(),f("div",_s,c(a.value==="all"?"尚未新增持股資料，請點擊「新增持股」按鈕開始追蹤。":`尚無${a.value==="tw"?"台股":"美股"}資料。`),1)):(m(),f("div",ws,[t("table",$s,[e[24]||(e[24]=t("thead",null,[t("tr",null,[t("th",null,"代碼"),t("th",null,"名稱"),t("th",null,"市場"),t("th",null,"持有股數"),t("th",null,"成本價"),t("th",null,"目前價格"),t("th",null,"市值"),t("th",null,"損益"),t("th",null,"操作")])],-1)),t("tbody",null,[(m(!0),f(nt,null,rt(I.value,(b,z)=>(m(),f("tr",{key:z},[t("td",null,c(b.symbol),1),t("td",null,c(b.name),1),t("td",null,c(b.market),1),t("td",null,c(b.quantity),1),t("td",null,c(h(b.cost,B(b))),1),t("td",{class:j(tt(ct)(u(b)))},c(yt(b)),3),t("td",null,c(K(b)?M(b.quantity*K(b),B(b)):"載入中..."),1),t("td",{class:j(R(b,K(b)))},c(s(b)),3),t("td",null,[t("div",ks,[t("button",{onClick:G=>U(y(b)),class:"text-primary text-sm"}," 編輯 ",8,Ss),t("button",{onClick:G=>A(y(b)),class:"text-danger text-sm"}," 刪除 ",8,Ds)])])]))),128))])])]))]),D.value?(m(),f("div",Cs,[t("div",Ts,[t("h3",Ps,c(T.value===null?"新增持股":"編輯持股"),1),t("form",{onSubmit:Rt(Z,["prevent"])},[t("div",qs,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium mb-1"},"股票代碼",-1)),O(t("input",{"onUpdate:modelValue":e[4]||(e[4]=b=>g.symbol=b),required:"",class:"input w-full",placeholder:"例如：2330.TW 或 AAPL",onBlur:P},null,544),[[H,g.symbol]])]),t("div",Fs,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium mb-1"},"股票名稱",-1)),O(t("input",{"onUpdate:modelValue":e[5]||(e[5]=b=>g.name=b),required:"",class:"input w-full",placeholder:"自動獲取，或手動輸入",disabled:W.value},null,8,zs),[[H,g.name]]),W.value?(m(),f("div",Ns," 正在獲取股票名稱... ")):L("",!0)]),t("div",Vs,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium mb-1"},"市場",-1)),O(t("select",{"onUpdate:modelValue":e[6]||(e[6]=b=>g.market=b),required:"",class:"input w-full"},e[27]||(e[27]=[t("option",{value:"台股"},"台股",-1),t("option",{value:"美股"},"美股",-1),t("option",{value:"其他"},"其他",-1)]),512),[[It,g.market]])]),t("div",Us,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium mb-1"},"成本價",-1)),O(t("input",{"onUpdate:modelValue":e[7]||(e[7]=b=>g.cost=b),type:"number",step:"0.01",required:"",class:"input w-full",placeholder:"每股成本"},null,512),[[H,g.cost,void 0,{number:!0}]])]),t("div",As,[e[30]||(e[30]=t("label",{class:"block text-sm font-medium mb-1"},"持有股數",-1)),O(t("input",{"onUpdate:modelValue":e[8]||(e[8]=b=>g.quantity=b),type:"number",required:"",class:"input w-full",placeholder:"持有數量"},null,512),[[H,g.quantity,void 0,{number:!0}]])]),t("div",js,[e[31]||(e[31]=t("label",{class:"block text-sm font-medium mb-1"},"購買日期",-1)),O(t("input",{"onUpdate:modelValue":e[9]||(e[9]=b=>g.purchaseDate=b),type:"date",class:"input w-full"},null,512),[[H,g.purchaseDate]])]),t("div",{class:"flex justify-end space-x-3"},[t("button",{type:"button",onClick:it,class:"btn bg-gray-200 text-gray-800"}," 取消 "),e[32]||(e[32]=t("button",{type:"submit",class:"btn btn-primary"},"儲存",-1))])],32)])])):L("",!0),S.value!==null?(m(),f("div",Ws,[t("div",Rs,[e[33]||(e[33]=t("h3",{class:"text-lg font-bold mb-4"},"確認刪除",-1)),t("p",Is," 確定要刪除「"+c((w=o.value[S.value])==null?void 0:w.name)+"」的持股資料嗎？ ",1),t("div",Os,[t("button",{onClick:e[10]||(e[10]=b=>S.value=null),class:"btn bg-gray-200 text-gray-800"}," 取消 "),t("button",{onClick:e[11]||(e[11]=b=>F()),class:"btn btn-danger"}," 確認刪除 ")])])])):L("",!0)])}}},Ms={class:"card bg-white p-4 mb-6"},Bs={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Ls={class:"p-3 bg-gray-50 rounded-lg"},Ys={class:"p-3 bg-gray-50 rounded-lg"},Js={class:"text-lg font-semibold"},Zs={class:"p-3 bg-gray-50 rounded-lg"},Ks={key:0,class:"card bg-white p-4 mb-6"},Hs={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Xs={class:"h-64 flex items-center justify-center"},Gs={class:"grid grid-cols-2 gap-4 mt-3"},Qs={class:"bg-gray-50 p-3 rounded-lg"},tl={class:"font-semibold"},el={class:"bg-gray-50 p-3 rounded-lg"},sl={class:"font-semibold"},ll={class:"h-64 flex items-center justify-center"},al={class:"grid grid-cols-2 gap-4 mt-3"},ol={class:"font-semibold"},nl={class:"text-xs"},rl={class:"font-semibold"},il={class:"text-xs"},ul={class:"flex justify-between items-center mb-4"},cl={class:"tabs"},dl={class:"card"},ml={key:0,class:"text-center py-6 text-gray-500"},vl={key:1,class:"table-container"},pl={class:"table"},bl={class:"flex space-x-2"},fl=["onClick"],gl=["onClick"],yl={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},hl={class:"bg-white rounded-lg p-6 max-w-md w-full"},xl={class:"text-lg font-bold mb-4"},_l={class:"mb-4"},wl={class:"mb-4"},$l=["disabled"],kl={key:0,class:"text-sm text-gray-500 mt-1"},Sl={class:"mb-4"},Dl={class:"mb-4"},Cl={class:"mb-4"},Tl={class:"mb-4"},Pl={class:"mb-4"},ql=["value"],Fl={class:"mb-4"},zl={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},Nl={class:"bg-white rounded-lg p-6 max-w-md w-full"},Vl={class:"mb-4"},Ul={class:"flex justify-end space-x-3"},Al={__name:"RealizedView",setup($){mt.register(_t,vt,pt,wt,$t,kt,bt,Ft,zt);const{getRealizedTrades:d,addRealizedTrade:C,updateRealizedTrade:k,deleteRealizedTrade:n}=gt(),o=N([]),i=N(!1),D=N(null),T=N(null),S=N("all"),v=N(0),x=N(!0),a=Wt({symbol:"",name:"",sellPrice:0,quantity:0,buyPrice:0,date:new Date().toISOString().split("T")[0],market:"台股"}),g=V(()=>P.value.reduce((u,s)=>u+s.profit,0)),W=V(()=>{if(P.value.length===0)return 0;const u=P.value.reduce((R,h)=>R+h.cost,0);return u===0?0:P.value.reduce((R,h)=>R+h.profit,0)/u*100}),P=V(()=>S.value==="all"?X.value:S.value==="tw"?X.value.filter(u=>I(u,"台股")):S.value==="us"?X.value.filter(u=>I(u,"美股")):X.value),I=(u,s)=>u.market?u.market===s:s==="台股"?/^\d+$/.test(u.symbol.split(".")[0]):s==="美股"?/[A-Za-z]/.test(u.symbol):!1,r=V(()=>{const u={tw:{profit:0,cost:0},us:{profit:0,cost:0}};return o.value.length===0||o.value.forEach(s=>{I(s,"台股")?(u.tw.profit+=s.profit,u.tw.cost+=s.cost):I(s,"美股")&&(u.us.profit+=s.profit,u.us.cost+=s.cost)}),u}),q=V(()=>{const u=Math.abs(r.value.tw.profit),s=Math.abs(r.value.us.profit),R=u+s;return{tw:R>0?u/R*100:0,us:R>0?s/R*100:0}}),X=V(()=>[...o.value].sort((u,s)=>new Date(s.date)-new Date(u.date))),Y=()=>{o.value=d(),v.value++,console.log("載入交易數據後更新圖表計數器:",v.value)},J=u=>o.value.findIndex(s=>s.symbol===u.symbol&&s.date===u.date&&s.profit===u.profit),E=u=>{const s=o.value[u];D.value=u,a.symbol=s.symbol,a.name=s.name,a.market=s.market||(I(s,"台股")?"台股":"美股"),a.sellPrice=s.sellPrice,a.quantity=s.quantity,a.buyPrice=s.cost/s.quantity||0,a.date=s.date,i.value=!0},y=u=>{T.value=u},p=()=>{T.value!==null&&(n(T.value),Y(),T.value=null)},_=()=>{const u=M(),R=a.sellPrice*a.quantity-u,h={symbol:a.symbol,name:a.name,market:a.market,sellPrice:a.sellPrice,quantity:a.quantity,cost:u,profit:R,date:a.date};D.value!==null?k(D.value,h):C(h),Y(),D.value=null,i.value=!1,A()},U=()=>{i.value=!1,D.value=null,A()},A=()=>{a.symbol="",a.name="",a.market="台股",a.sellPrice=0,a.quantity=0,a.buyPrice=0,a.date=new Date().toISOString().split("T")[0]},F=u=>{const s="NT$",R=new Intl.NumberFormat("zh-TW",{minimumFractionDigits:0,maximumFractionDigits:0}).format(u);return`${s}${R}`},Z=u=>`NT$${u.toFixed(2)}`,it=u=>Ut(u).format("YYYY/MM/DD"),st=u=>{if(u.cost===0)return"0.00%";const s=u.profit/u.cost*100;return`${s>=0?"+":""}${s.toFixed(2)}%`},M=()=>a.buyPrice*a.quantity,K=()=>{const u=M();return F(u)},B=N(!1),yt=async()=>{if(a.symbol){B.value=!0;try{const u=await Et(a.symbol);u&&(a.name=u,console.log(`自動獲取股票名稱: ${a.symbol} -> ${u}`),a.symbol.includes(".TW")||/^\d{4,}[A-Za-z]?$/.test(a.symbol)?a.market="台股":/[A-Za-z]/.test(a.symbol)&&(a.market="美股"))}catch(u){console.error("獲取股票名稱失敗:",u)}finally{B.value=!1}}};return ft(()=>{Y()}),Vt(()=>{if(console.log("RealizedView 被激活, 初次掛載狀態:",x.value),x.value){x.value=!1;return}v.value++,console.log("激活時更新圖表計數器:",v.value),Y(),setTimeout(()=>{v.value++,console.log("延遲後再次更新圖表計數器:",v.value)},300)}),(u,s)=>{var R;return m(),f("div",null,[s[34]||(s[34]=t("h2",{class:"text-xl font-bold mb-4"},"已實現收益",-1)),t("div",Ms,[t("div",Bs,[t("div",Ls,[s[13]||(s[13]=t("h3",{class:"text-gray-500 text-sm"},"總實現收益",-1)),t("p",{class:j(["text-lg font-semibold",g.value>=0?"positive":"negative"])},c(g.value>0?"+":"")+c(F(g.value)),3)]),t("div",Ys,[s[14]||(s[14]=t("h3",{class:"text-gray-500 text-sm"},"總交易次數",-1)),t("p",Js,c(o.value.length)+" 次",1)]),t("div",Zs,[s[15]||(s[15]=t("h3",{class:"text-gray-500 text-sm"},"平均報酬率",-1)),t("p",{class:j(["text-lg font-semibold",W.value>=0?"positive":"negative"])},c(W.value>0?"+":"")+c(W.value.toFixed(2))+"% ",3)])])]),o.value.length>0?(m(),f("div",Ks,[t("div",Hs,[t("div",null,[s[18]||(s[18]=t("h3",{class:"text-lg font-bold mb-3"},"市場分佈",-1)),t("div",Xs,[Q(Mt,{"tw-value":r.value.tw.profit,"us-value":r.value.us.profit},null,8,["tw-value","us-value"])]),t("div",Gs,[t("div",Qs,[s[16]||(s[16]=t("h4",{class:"text-sm text-gray-500"},"台股占比",-1)),t("p",tl,c(q.value.tw.toFixed(2))+"% ",1)]),t("div",el,[s[17]||(s[17]=t("h4",{class:"text-sm text-gray-500"},"美股占比",-1)),t("p",sl,c(q.value.us.toFixed(2))+"% ",1)])])]),t("div",null,[s[21]||(s[21]=t("h3",{class:"text-lg font-bold mb-3"},"市場表現",-1)),t("div",ll,[Q(Bt,{"tw-profit":r.value.tw.profit,"us-profit":r.value.us.profit,"tw-cost":r.value.tw.cost,"us-cost":r.value.us.cost},null,8,["tw-profit","us-profit","tw-cost","us-cost"])]),t("div",al,[t("div",{class:j(["bg-gray-50 p-3 rounded-lg",r.value.tw.profit>=0?"positive":"negative"])},[s[19]||(s[19]=t("h4",{class:"text-sm text-gray-500"},"台股損益",-1)),t("p",ol,[at(c(r.value.tw.profit>0?"+":"")+c(F(r.value.tw.profit))+" ",1),t("span",nl," ("+c(r.value.tw.cost>0?(r.value.tw.profit/r.value.tw.cost*100).toFixed(2)+"%":"0%")+") ",1)])],2),t("div",{class:j(["bg-gray-50 p-3 rounded-lg",r.value.us.profit>=0?"positive":"negative"])},[s[20]||(s[20]=t("h4",{class:"text-sm text-gray-500"},"美股損益",-1)),t("p",rl,[at(c(r.value.us.profit>0?"+":"")+c(F(r.value.us.profit))+" ",1),t("span",il," ("+c(r.value.us.cost>0?(r.value.us.profit/r.value.us.cost*100).toFixed(2)+"%":"0%")+") ",1)])],2)])])])])):L("",!0),t("div",ul,[t("div",cl,[t("button",{onClick:s[0]||(s[0]=h=>S.value="all"),class:j(["tab-btn mr-2 px-4 py-2 rounded-lg",S.value==="all"?"bg-primary text-white":"bg-gray-100"])}," 全部交易 ",2),t("button",{onClick:s[1]||(s[1]=h=>S.value="tw"),class:j(["tab-btn mr-2 px-4 py-2 rounded-lg",S.value==="tw"?"bg-primary text-white":"bg-gray-100"])}," 台股 ",2),t("button",{onClick:s[2]||(s[2]=h=>S.value="us"),class:j(["tab-btn px-4 py-2 rounded-lg",S.value==="us"?"bg-primary text-white":"bg-gray-100"])}," 美股 ",2)]),t("button",{onClick:s[3]||(s[3]=h=>i.value=!0),class:"btn btn-primary"}," + 新增已實現收益 ")]),t("div",dl,[P.value.length===0?(m(),f("div",ml,c(S.value==="all"?"尚未新增已實現收益資料，請點擊「新增已實現收益」按鈕進行新增。":`尚無${S.value==="tw"?"台股":"美股"}已實現交易資料。`),1)):(m(),f("div",vl,[t("table",pl,[s[22]||(s[22]=t("thead",null,[t("tr",null,[t("th",null,"日期"),t("th",null,"代碼"),t("th",null,"名稱"),t("th",null,"市場"),t("th",null,"賣出價格"),t("th",null,"數量"),t("th",null,"總成本"),t("th",null,"實現損益"),t("th",null,"報酬率"),t("th",null,"操作")])],-1)),t("tbody",null,[(m(!0),f(nt,null,rt(P.value,(h,l)=>(m(),f("tr",{key:l},[t("td",null,c(it(h.date)),1),t("td",null,c(h.symbol),1),t("td",null,c(h.name),1),t("td",null,c(h.market||(I(h,"台股")?"台股":"美股")),1),t("td",null,c(Z(h.sellPrice)),1),t("td",null,c(h.quantity),1),t("td",null,c(F(h.cost)),1),t("td",{class:j(h.profit>=0?"positive":"negative")},c(h.profit>0?"+":"")+c(F(h.profit)),3),t("td",{class:j(h.profit>=0?"positive":"negative")},c(st(h)),3),t("td",null,[t("div",bl,[t("button",{onClick:e=>E(J(h)),class:"text-primary text-sm"}," 編輯 ",8,fl),t("button",{onClick:e=>y(J(h)),class:"text-danger text-sm"}," 刪除 ",8,gl)])])]))),128))])])]))]),i.value?(m(),f("div",yl,[t("div",hl,[t("h3",xl,c(D.value===null?"新增已實現收益":"編輯已實現收益"),1),t("form",{onSubmit:Rt(_,["prevent"])},[t("div",_l,[s[23]||(s[23]=t("label",{class:"block text-sm font-medium mb-1"},"股票代碼",-1)),O(t("input",{"onUpdate:modelValue":s[4]||(s[4]=h=>a.symbol=h),required:"",class:"input w-full",placeholder:"例如：2330.TW 或 AAPL",onBlur:yt},null,544),[[H,a.symbol]])]),t("div",wl,[s[24]||(s[24]=t("label",{class:"block text-sm font-medium mb-1"},"股票名稱",-1)),O(t("input",{"onUpdate:modelValue":s[5]||(s[5]=h=>a.name=h),required:"",class:"input w-full",placeholder:"自動獲取，或手動輸入",disabled:B.value},null,8,$l),[[H,a.name]]),B.value?(m(),f("div",kl," 正在獲取股票名稱... ")):L("",!0)]),t("div",Sl,[s[26]||(s[26]=t("label",{class:"block text-sm font-medium mb-1"},"市場",-1)),O(t("select",{"onUpdate:modelValue":s[6]||(s[6]=h=>a.market=h),required:"",class:"input w-full"},s[25]||(s[25]=[t("option",{value:"台股"},"台股",-1),t("option",{value:"美股"},"美股",-1),t("option",{value:"其他"},"其他",-1)]),512),[[It,a.market]])]),t("div",Dl,[s[27]||(s[27]=t("label",{class:"block text-sm font-medium mb-1"},"賣出價格",-1)),O(t("input",{"onUpdate:modelValue":s[7]||(s[7]=h=>a.sellPrice=h),type:"number",step:"0.01",required:"",class:"input w-full",placeholder:"每股賣出價格"},null,512),[[H,a.sellPrice,void 0,{number:!0}]])]),t("div",Cl,[s[28]||(s[28]=t("label",{class:"block text-sm font-medium mb-1"},"數量",-1)),O(t("input",{"onUpdate:modelValue":s[8]||(s[8]=h=>a.quantity=h),type:"number",required:"",class:"input w-full",placeholder:"賣出數量"},null,512),[[H,a.quantity,void 0,{number:!0}]])]),t("div",Tl,[s[29]||(s[29]=t("label",{class:"block text-sm font-medium mb-1"},"買入價格",-1)),O(t("input",{"onUpdate:modelValue":s[9]||(s[9]=h=>a.buyPrice=h),type:"number",step:"0.01",required:"",class:"input w-full",placeholder:"每股買入價格"},null,512),[[H,a.buyPrice,void 0,{number:!0}]])]),t("div",Pl,[s[30]||(s[30]=t("label",{class:"block text-sm font-medium mb-1"},"總成本",-1)),t("input",{value:K(),type:"number",step:"0.01",disabled:"",class:"input w-full bg-gray-100"},null,8,ql)]),t("div",Fl,[s[31]||(s[31]=t("label",{class:"block text-sm font-medium mb-1"},"賣出日期",-1)),O(t("input",{"onUpdate:modelValue":s[10]||(s[10]=h=>a.date=h),type:"date",required:"",class:"input w-full"},null,512),[[H,a.date]])]),t("div",{class:"flex justify-end space-x-3"},[t("button",{type:"button",onClick:U,class:"btn bg-gray-200 text-gray-800"}," 取消 "),s[32]||(s[32]=t("button",{type:"submit",class:"btn btn-primary"},"儲存",-1))])],32)])])):L("",!0),T.value!==null?(m(),f("div",zl,[t("div",Nl,[s[33]||(s[33]=t("h3",{class:"text-lg font-bold mb-4"},"確認刪除",-1)),t("p",Vl," 確定要刪除「"+c((R=o.value[T.value])==null?void 0:R.name)+"」的已實現收益資料嗎？ ",1),t("div",Ul,[t("button",{onClick:s[11]||(s[11]=h=>T.value=null),class:"btn bg-gray-200 text-gray-800"}," 取消 "),t("button",{onClick:s[12]||(s[12]=h=>p()),class:"btn btn-danger"}," 確認刪除 ")])])])):L("",!0)])}}},jl=[{path:"/",component:Es},{path:"/realized",component:Al},{path:"/charts",component:je}],Wl=te({history:ee(),routes:jl}),Lt=se(ve);Lt.use(Wl);Lt.mount("#app");
