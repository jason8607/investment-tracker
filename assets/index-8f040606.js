import{r as et,o as h,c as x,a as t,F as K,b as J,d as L,w as X,t as f,u as U,e as mt,f as pt,g as at,n as j,T as bt,h as vt,i as yt,C as ft,A as gt,p as ht,j as xt,k as _t,B as kt,P as $t,L as wt,l as St,m as z,q as I,s as Q,v as N,x as E,y as rt,z as Ct,D as Pt,E as Dt,G as Tt,H as it,I as ut,J as V,K as M,M as qt,N as zt,O as Ft,Q as It}from"./vendor-fc4b5792.js";(function(){const b=document.createElement("link").relList;if(b&&b.supports&&b.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))k(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const v of a.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&k(v)}).observe(document,{childList:!0,subtree:!0});function D(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function k(r){if(r.ep)return;r.ep=!0;const a=D(r);fetch(r.href,a)}})();const st="investment-tracker-stocks",lt="investment-tracker-realized";function G(){const _=()=>{try{const i=localStorage.getItem(st);return i?JSON.parse(i):[]}catch(i){return console.error("無法讀取持股資料",i),[]}},b=i=>{try{localStorage.setItem(st,JSON.stringify(i))}catch(o){console.error("無法儲存持股資料",o)}},D=i=>{const o=_();o.push(i),b(o)},k=(i,o)=>{const d=_();d[i]=o,b(d)},r=i=>{const o=_();o.splice(i,1),b(o)},a=()=>{try{const i=localStorage.getItem(lt);return i?JSON.parse(i):[]}catch(i){return console.error("無法讀取已實現收益資料",i),[]}},v=i=>{try{localStorage.setItem(lt,JSON.stringify(i))}catch(o){console.error("無法儲存已實現收益資料",o)}};return{getStocks:_,setStocks:b,addStock:D,updateStock:k,deleteStock:r,getRealizedTrades:a,setRealizedTrades:v,addRealizedTrade:i=>{const o=a();o.push(i),v(o)},updateRealizedTrade:(i,o)=>{const d=a();d[i]=o,v(d)},deleteRealizedTrade:i=>{const o=a();o.splice(i,1),v(o)}}}const Rt={class:"min-h-screen"},Vt={class:"bg-primary text-white p-4 shadow-md"},At={class:"container mx-auto flex justify-between items-center"},Ot={class:"flex space-x-2"},Mt={class:"btn bg-secondary text-white text-sm px-3 py-1 cursor-pointer"},jt={class:"bg-white shadow-sm"},Et={class:"container mx-auto"},Ut={class:"flex"},Nt={class:"container mx-auto p-4"},Wt={class:"bg-gray-100 text-gray-600 p-4 text-center text-sm"},Lt={__name:"App",setup(_){const{getStocks:b,getRealizedTrades:D,setStocks:k,setRealizedTrades:r}=G(),a=[{name:"持股管理",path:"/"},{name:"已實現收益",path:"/realized"},{name:"圖表分析",path:"/charts"}],v=()=>{const m=U.book_new(),l=b(),i=D(),o=l.map($=>({股票代碼:$.symbol,股票名稱:$.name,市場:$.market,成本價:$.cost,數量:$.quantity,購買日期:$.purchaseDate})),d=i.map($=>({股票代碼:$.symbol,股票名稱:$.name,賣出價格:$.sellPrice,數量:$.quantity,成本:$.cost,實現損益:$.profit,日期:$.date})),q=U.json_to_sheet(o),P=U.json_to_sheet(d);U.book_append_sheet(m,q,"持股紀錄"),U.book_append_sheet(m,P,"已實現收益"),mt(m,"投資損益資料.xlsx")},w=m=>{const l=m.target.files[0];if(!l)return;const i=new FileReader;i.onload=o=>{const d=new Uint8Array(o.target.result),q=pt(d,{type:"array"}),P=q.Sheets.持股紀錄;if(P){const A=U.sheet_to_json(P).map(C=>({symbol:C.股票代碼,name:C.股票名稱,market:C.市場,cost:parseFloat(C.成本價),quantity:parseInt(C.數量),purchaseDate:C.購買日期}));k(A)}const $=q.Sheets.已實現收益;if($){const A=U.sheet_to_json($).map(C=>({symbol:C.股票代碼,name:C.股票名稱,sellPrice:parseFloat(C.賣出價格),quantity:parseInt(C.數量),cost:parseFloat(C.成本),profit:parseFloat(C.實現損益),date:C.日期}));r(A)}m.target.value="",alert("資料匯入成功！")},i.readAsArrayBuffer(l)};return(m,l)=>{const i=et("router-link"),o=et("router-view");return h(),x("div",Rt,[t("header",Vt,[t("div",At,[l[3]||(l[3]=t("h1",{class:"text-xl md:text-2xl font-bold"},"投資損益小幫手",-1)),t("div",Ot,[t("button",{onClick:v,class:"btn bg-secondary text-white text-sm px-3 py-1"},l[0]||(l[0]=[t("span",{class:"hidden md:inline"},"匯出資料",-1),t("span",{class:"md:hidden"},"匯出",-1)])),t("label",Mt,[l[1]||(l[1]=t("span",{class:"hidden md:inline"},"匯入資料",-1)),l[2]||(l[2]=t("span",{class:"md:hidden"},"匯入",-1)),t("input",{type:"file",accept:".xlsx",class:"hidden",onChange:w},null,32)])])])]),t("nav",jt,[t("div",Et,[t("ul",Ut,[(h(),x(K,null,J(a,d=>t("li",{key:d.path},[L(i,{to:d.path,class:j(["block px-4 py-3 hover:bg-gray-100 transition-colors border-b-2",m.$route.path===d.path?"border-primary text-primary font-medium":"border-transparent"])},{default:X(()=>[at(f(d.name),1)]),_:2},1032,["to","class"])])),64))])])]),t("main",Nt,[L(o,null,{default:X(({Component:d})=>[L(bt,{name:"fade",mode:"out-in"},{default:X(()=>[(h(),vt(yt(d)))]),_:2},1024)]),_:1})]),t("footer",Wt,[t("p",null,"投資損益小幫手 © "+f(new Date().getFullYear()),1)])])}}};const Bt={class:"mb-6"},Yt={class:"flex flex-wrap space-x-2"},Kt=["onClick"],Jt={class:"card"},Ht={key:0,class:"p-4"},Gt={key:0,class:"text-center py-6 text-gray-500"},Xt={key:1,class:"flex flex-col md:flex-row"},Zt={class:"w-full md:w-1/2 min-h-[300px]"},Qt={class:"w-full md:w-1/2 p-4"},te={class:"flex-1"},ee={class:"text-right"},se={key:1,class:"p-4"},le={key:0,class:"text-center py-6 text-gray-500"},ne={key:1,class:"min-h-[300px]"},oe={key:2,class:"p-4"},ae={key:0,class:"text-center py-6 text-gray-500"},re={key:1,class:"min-h-[300px]"},ie={__name:"ChartsView",setup(_){ft.register(gt,ht,xt,_t,LinearScale,kt,$t,wt,St);const{getStocks:b,getRealizedTrades:D}=G(),k=z("allocation"),r=z([]),a=z([]),v=z({}),w=[{id:"allocation",name:"持股分配"},{id:"profit",name:"總體損益"},{id:"realized",name:"已實現收益趨勢"}],m=["#4CAF50","#2196F3","#F44336","#FF9800","#9C27B0","#3F51B5","#009688","#795548","#607D8B","#E91E63"],l=I(()=>r.value.length>0),i=I(()=>a.value.length>0),o=I(()=>l.value||i.value),d=I(()=>{if(!l.value)return[];const p=r.value.map(y=>{var S;const e=(((S=v.value[y.symbol])==null?void 0:S.price)||y.cost)*y.quantity;return{...y,marketValue:e}}),g=p.reduce((y,u)=>y+u.marketValue,0);return p.map(y=>({...y,percentage:y.marketValue/g*100})).sort((y,u)=>u.marketValue-y.marketValue)}),q=I(()=>l.value?{labels:d.value.map(p=>p.name),datasets:[{data:d.value.map(p=>p.marketValue),backgroundColor:d.value.map((p,g)=>m[g%m.length]),hoverOffset:4}]}:{datasets:[]}),P=I(()=>{const p=["未實現損益","已實現收益","總體損益"],g=r.value.reduce((S,n)=>{var F;const T=(((F=v.value[n.symbol])==null?void 0:F.price)||n.cost)*n.quantity,c=n.cost*n.quantity;return S+(T-c)},0),y=a.value.reduce((S,n)=>S+n.profit,0),u=g+y,e=[g,y,u];return{labels:p,datasets:[{label:"損益金額",data:e,backgroundColor:e.map(S=>S>=0?"rgba(76, 175, 80, 0.6)":"rgba(244, 67, 54, 0.6)"),borderColor:e.map(S=>S>=0?"rgb(76, 175, 80)":"rgb(244, 67, 54)"),borderWidth:1}]}}),$=I(()=>{if(!i.value)return{datasets:[]};const p=[...a.value].sort((e,S)=>new Date(e.date)-new Date(S.date));let g=0;const y=[],u=[];return p.forEach(e=>{g+=e.profit,y.push(g),u.push(rt(e.date).format("YYYY/MM/DD"))}),{labels:u,datasets:[{label:"累計已實現收益",data:y,borderColor:"rgb(54, 162, 235)",backgroundColor:"rgba(54, 162, 235, 0.5)",tension:.1,pointBackgroundColor:y.map(e=>e>=0?"rgb(76, 175, 80)":"rgb(244, 67, 54)")}]}}),R={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(p){const g=p.label||"",y=p.raw||0,u=y/p.dataset.data.reduce((e,S)=>e+S,0)*100;return`${g}: ${O(y)} (${u.toFixed(2)}%)`}}}}},A={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(p){return`${p.dataset.label}: ${O(p.raw)}`}}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(p){return O(p)}}}}},C={responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{callbacks:{label:function(p){return`${p.dataset.label}: ${O(p.raw)}`}}}},scales:{y:{ticks:{callback:function(p){return O(p)}}}}},O=p=>new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(p),W=()=>{r.value=b(),a.value=D();const p={};r.value.forEach(g=>{p[g.symbol]={price:g.cost,change:0,changePercent:0}}),v.value=p;try{const g=localStorage.getItem("investment-tracker-prices");g&&(v.value={...v.value,...JSON.parse(g)})}catch(g){console.error("無法讀取價格資料",g)}};return Q(()=>{W(),window.addEventListener("storage",p=>{(p.key==="investment-tracker-stocks"||p.key==="investment-tracker-realized"||p.key==="investment-tracker-prices")&&W()})}),(p,g)=>(h(),x("div",null,[g[4]||(g[4]=t("h2",{class:"text-xl font-bold mb-4"},"圖表分析",-1)),t("div",Bt,[t("div",Yt,[(h(),x(K,null,J(w,y=>t("button",{key:y.id,onClick:u=>k.value=y.id,class:j(["px-4 py-2 rounded-md transition-colors mb-2",k.value===y.id?"bg-primary text-white":"bg-gray-100 text-gray-700"])},f(y.name),11,Kt)),64))])]),t("div",Jt,[k.value==="allocation"?(h(),x("div",Ht,[g[1]||(g[1]=t("h3",{class:"text-lg font-medium mb-4"},"持股分配",-1)),l.value?(h(),x("div",Xt,[t("div",Zt,[L(N(Ct),{"chart-data":q.value,"chart-options":R},null,8,["chart-data"])]),t("div",Qt,[g[0]||(g[0]=t("h4",{class:"text-md font-medium mb-2"},"持股比例",-1)),(h(!0),x(K,null,J(d.value,(y,u)=>(h(),x("div",{key:u,class:"flex items-center mb-2"},[t("div",{class:"w-4 h-4 rounded-full mr-2",style:Pt({backgroundColor:m[u%m.length]})},null,4),t("div",te,f(y.name)+" ("+f(y.symbol)+")",1),t("div",ee,f(y.percentage.toFixed(2))+"%",1)]))),128))])])):(h(),x("div",Gt," 尚未新增持股資料，請先在持股管理頁面新增股票。 "))])):E("",!0),k.value==="profit"?(h(),x("div",se,[g[2]||(g[2]=t("h3",{class:"text-lg font-medium mb-4"},"總體損益",-1)),o.value?(h(),x("div",ne,[L(N(Dt),{"chart-data":P.value,"chart-options":A},null,8,["chart-data"])])):(h(),x("div",le," 尚未有足夠資料，請先新增持股或已實現收益。 "))])):E("",!0),k.value==="realized"?(h(),x("div",oe,[g[3]||(g[3]=t("h3",{class:"text-lg font-medium mb-4"},"已實現收益分析",-1)),i.value?(h(),x("div",re,[L(N(Tt),{"chart-data":$.value,"chart-options":C},null,8,["chart-data"])])):(h(),x("div",ae," 尚未新增已實現收益資料，請先在已實現收益頁面新增資料。 "))])):E("",!0)])]))}},ue="https://corsproxy.io/?",Y=["https://api.allorigins.win/raw?url=","https://cors-anywhere.herokuapp.com/"];function Z(_){return _?_.includes(".")?_:/^\d+$/.test(_)?`${_}.TW`:_:""}async function ce(_){var w,m,l,i;const b=Z(_),D=new Date().getTime(),k=`https://query1.finance.yahoo.com/v8/finance/chart/${b}?interval=1d&t=${D}`;let r=`${ue}${encodeURIComponent(k)}`,a=-1;console.log(`請求股票數據：${b}`);const v=Y.length+1;for(let o=0;o<v;o++)try{const d=await fetch(r,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Accept:"application/json","Cache-Control":"no-cache"}});if(!d.ok){if(console.warn(`API 請求失敗 (${b}): ${d.status} ${d.statusText}`),a++,a<Y.length){r=`${Y[a]}${encodeURIComponent(k)}`,console.log(`嘗試下一個代理 #${a+1}...`);continue}throw new Error(`API 請求失敗: ${d.status} ${d.statusText}`)}const q=await d.json();if((w=q.chart)!=null&&w.error)throw new Error(`Yahoo API 錯誤: ${JSON.stringify(q.chart.error)}`);if(!((i=(l=(m=q.chart)==null?void 0:m.result)==null?void 0:l[0])!=null&&i.meta))throw new Error("API 返回數據結構異常");const P=q.chart.result[0],$=P.meta.regularMarketPrice,R=P.meta.currency||(b.endsWith(".TW")?"TWD":"USD");return console.log(`成功獲取 ${b} 價格: ${$} ${R}`),{symbol:b,price:$,change:P.meta.regularMarketChange,changePercent:P.meta.regularMarketChangePercent,time:new Date(P.meta.regularMarketTime*1e3),currency:R,exchangeName:P.meta.exchangeName||"",lastUpdated:new Date}}catch(d){if(o===v-1||a>=Y.length-1)throw console.error(`獲取 ${b} 價格失敗:`,d),d;a++,r=`${Y[a]}${encodeURIComponent(k)}`,console.log(`API 錯誤，嘗試下一個代理 #${a+1}...`)}throw new Error(`無法獲取 ${b} 的股票數據`)}async function de(_){const b=_.filter(r=>r&&r.trim());if(b.length===0)return[];const D=[],k=2;console.log(`開始批量獲取 ${b.length} 支股票數據`);for(let r=0;r<b.length;r+=k){const a=b.slice(r,r+k);console.log(`處理批次 ${Math.floor(r/k)+1}/${Math.ceil(b.length/k)}: ${a.join(", ")}`);const v=a.map(m=>ce(m).catch(l=>(console.error(`獲取 ${m} 數據失敗:`,l),{error:!0,errorMessage:l.message||"未知錯誤",symbol:Z(m),originalSymbol:m}))),w=await Promise.all(v);D.push(...w),r+k<b.length&&(console.log("延遲 1.5 秒後獲取下一批..."),await new Promise(m=>setTimeout(m,1500)))}return D.map((r,a)=>r.error?{originalSymbol:b[a],symbol:Z(b[a]),price:null,error:!0,errorMessage:r.errorMessage||"獲取數據失敗"}:{originalSymbol:b[a],...r})}function nt(_,b,D=2){return _==null?"-":`${b==="TWD"?"NT$":"$"}${_.toFixed(D)}`}function ot(_){return _==null?"":_>0?"positive":_<0?"negative":""}const me={class:"card bg-white p-4 mb-6"},pe={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},be={class:"p-3 bg-gray-50 rounded-lg"},ve={class:"text-lg font-semibold"},ye={class:"p-3 bg-gray-50 rounded-lg"},fe={class:"text-lg font-semibold"},ge={class:"p-3 bg-gray-50 rounded-lg"},he={class:"text-sm"},xe={class:"flex justify-between items-center mb-4"},_e={key:0,class:"inline-block animate-spin"},ke={class:"card"},$e={key:0,class:"text-center py-6 text-gray-500"},we={key:1,class:"table-container"},Se={class:"table"},Ce={class:"flex space-x-2"},Pe=["onClick"],De=["onClick"],Te={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},qe={class:"bg-white rounded-lg p-6 max-w-md w-full"},ze={class:"text-lg font-bold mb-4"},Fe={class:"mb-4"},Ie={class:"mb-4"},Re={class:"mb-4"},Ve={class:"mb-4"},Ae={class:"mb-4"},Oe={class:"mb-4"},Me={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},je={class:"bg-white rounded-lg p-6 max-w-md w-full"},Ee={class:"mb-4"},Ue={class:"flex justify-end space-x-3"},Ne={__name:"HomeView",setup(_){const{getStocks:b,addStock:D,updateStock:k,deleteStock:r}=G(),a=z([]),v=z({}),w=z(!1),m=z(null),l=z(null),i=z(!1),o=it({symbol:"",name:"",market:"台股",cost:0,quantity:0,purchaseDate:new Date().toISOString().split("T")[0]}),d=I(()=>a.value.reduce((n,s)=>n+s.cost*s.quantity,0)),q=I(()=>a.value.reduce((n,s)=>{var c;const T=((c=v.value[s.symbol])==null?void 0:c.price)||0;return n+T*s.quantity},0)),P=I(()=>q.value-d.value),$=I(()=>d.value===0?0:P.value/d.value*100),R=()=>{a.value=b(),a.value.length>0&&A()},A=async()=>{if(a.value.length!==0){i.value=!0;try{const n=a.value.map(c=>c.symbol),s=await de(n),T={};s.forEach(c=>{T[c.symbol]=c}),v.value=T}catch(n){console.error("更新價格出錯",n)}finally{i.value=!1}}},C=n=>{const s=a.value[n];m.value=n,o.symbol=s.symbol,o.name=s.name,o.market=s.market,o.cost=s.cost,o.quantity=s.quantity,o.purchaseDate=s.purchaseDate||"",w.value=!0},O=n=>{l.value=n},W=()=>{l.value!==null&&(r(l.value),R(),l.value=null)},p=()=>{const n={symbol:o.symbol,name:o.name,market:o.market,cost:o.cost,quantity:o.quantity,purchaseDate:o.purchaseDate};m.value!==null?k(m.value,n):D(n),R(),m.value=null,w.value=!1,y()},g=()=>{w.value=!1,m.value=null,y()},y=()=>{o.symbol="",o.name="",o.market="台股",o.cost=0,o.quantity=0,o.purchaseDate=new Date().toISOString().split("T")[0]},u=n=>new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(n),e=(n,s)=>{if(!s)return"載入中...";const T=n.cost*n.quantity,F=s*n.quantity-T,H=T>0?F/T*100:0,B=F>=0?"+":"";return`${B}${u(F)} (${B}${H.toFixed(2)}%)`},S=(n,s)=>{if(!s)return"";const T=n.cost*n.quantity,F=s*n.quantity-T;return F>0?"positive":F<0?"negative":""};return Q(()=>{R();const n=setInterval(A,5*60*1e3);return()=>clearInterval(n)}),(n,s)=>{var T;return h(),x("div",null,[s[23]||(s[23]=t("h2",{class:"text-xl font-bold mb-4"},"持股管理",-1)),t("div",me,[t("div",pe,[t("div",be,[s[9]||(s[9]=t("h3",{class:"text-gray-500 text-sm"},"總投資成本",-1)),t("p",ve,f(u(d.value)),1)]),t("div",ye,[s[10]||(s[10]=t("h3",{class:"text-gray-500 text-sm"},"目前總市值",-1)),t("p",fe,f(u(q.value)),1)]),t("div",ge,[s[11]||(s[11]=t("h3",{class:"text-gray-500 text-sm"},"未實現損益",-1)),t("p",{class:j(["text-lg font-semibold",N(ot)(P.value)])},[at(f(P.value>0?"+":"")+f(u(P.value))+" ",1),t("span",he," ("+f($.value>0?"+":"")+f($.value.toFixed(2))+"%) ",1)],2)])])]),t("div",xe,[t("button",{onClick:s[0]||(s[0]=c=>w.value=!0),class:"btn btn-primary"}," + 新增持股 "),t("button",{onClick:A,class:"btn bg-gray-100 text-gray-700 flex items-center"},[s[12]||(s[12]=t("span",{class:"mr-1"},"更新價格",-1)),i.value?(h(),x("span",_e,"⟳")):E("",!0)])]),t("div",ke,[a.value.length===0?(h(),x("div",$e," 尚未新增持股資料，請點擊「新增持股」按鈕開始追蹤。 ")):(h(),x("div",we,[t("table",Se,[s[13]||(s[13]=t("thead",null,[t("tr",null,[t("th",null,"代碼"),t("th",null,"名稱"),t("th",null,"市場"),t("th",null,"持有股數"),t("th",null,"成本價"),t("th",null,"目前價格"),t("th",null,"市值"),t("th",null,"損益"),t("th",null,"操作")])],-1)),t("tbody",null,[(h(!0),x(K,null,J(a.value,(c,F)=>{var H,B,tt;return h(),x("tr",{key:F},[t("td",null,f(c.symbol),1),t("td",null,f(c.name),1),t("td",null,f(c.market),1),t("td",null,f(c.quantity),1),t("td",null,f(N(nt)(c.cost)),1),t("td",{class:j(N(ot)((H=v.value[c.symbol])==null?void 0:H.change))},f(v.value[c.symbol]?N(nt)(v.value[c.symbol].price):"載入中..."),3),t("td",null,f(v.value[c.symbol]?u(c.quantity*v.value[c.symbol].price):"載入中..."),1),t("td",{class:j(S(c,(B=v.value[c.symbol])==null?void 0:B.price))},f(e(c,(tt=v.value[c.symbol])==null?void 0:tt.price)),3),t("td",null,[t("div",Ce,[t("button",{onClick:dt=>C(F),class:"text-primary text-sm"}," 編輯 ",8,Pe),t("button",{onClick:dt=>O(F),class:"text-danger text-sm"}," 刪除 ",8,De)])])])}),128))])])]))]),w.value?(h(),x("div",Te,[t("div",qe,[t("h3",ze,f(m.value===null?"新增持股":"編輯持股"),1),t("form",{onSubmit:ut(p,["prevent"])},[t("div",Fe,[s[14]||(s[14]=t("label",{class:"block text-sm font-medium mb-1"},"股票代碼",-1)),V(t("input",{"onUpdate:modelValue":s[1]||(s[1]=c=>o.symbol=c),required:"",class:"input w-full",placeholder:"例如：2330.TW 或 AAPL"},null,512),[[M,o.symbol]])]),t("div",Ie,[s[15]||(s[15]=t("label",{class:"block text-sm font-medium mb-1"},"股票名稱",-1)),V(t("input",{"onUpdate:modelValue":s[2]||(s[2]=c=>o.name=c),required:"",class:"input w-full",placeholder:"例如：台積電 或 蘋果"},null,512),[[M,o.name]])]),t("div",Re,[s[17]||(s[17]=t("label",{class:"block text-sm font-medium mb-1"},"市場",-1)),V(t("select",{"onUpdate:modelValue":s[3]||(s[3]=c=>o.market=c),required:"",class:"input w-full"},s[16]||(s[16]=[t("option",{value:"台股"},"台股",-1),t("option",{value:"美股"},"美股",-1),t("option",{value:"其他"},"其他",-1)]),512),[[qt,o.market]])]),t("div",Ve,[s[18]||(s[18]=t("label",{class:"block text-sm font-medium mb-1"},"成本價",-1)),V(t("input",{"onUpdate:modelValue":s[4]||(s[4]=c=>o.cost=c),type:"number",step:"0.01",required:"",class:"input w-full",placeholder:"每股成本"},null,512),[[M,o.cost,void 0,{number:!0}]])]),t("div",Ae,[s[19]||(s[19]=t("label",{class:"block text-sm font-medium mb-1"},"持有股數",-1)),V(t("input",{"onUpdate:modelValue":s[5]||(s[5]=c=>o.quantity=c),type:"number",required:"",class:"input w-full",placeholder:"持有數量"},null,512),[[M,o.quantity,void 0,{number:!0}]])]),t("div",Oe,[s[20]||(s[20]=t("label",{class:"block text-sm font-medium mb-1"},"購買日期",-1)),V(t("input",{"onUpdate:modelValue":s[6]||(s[6]=c=>o.purchaseDate=c),type:"date",class:"input w-full"},null,512),[[M,o.purchaseDate]])]),t("div",{class:"flex justify-end space-x-3"},[t("button",{type:"button",onClick:g,class:"btn bg-gray-200 text-gray-800"}," 取消 "),s[21]||(s[21]=t("button",{type:"submit",class:"btn btn-primary"},"儲存",-1))])],32)])])):E("",!0),l.value!==null?(h(),x("div",Me,[t("div",je,[s[22]||(s[22]=t("h3",{class:"text-lg font-bold mb-4"},"確認刪除",-1)),t("p",Ee," 確定要刪除「"+f((T=a.value[l.value])==null?void 0:T.name)+"」的持股資料嗎？ ",1),t("div",Ue,[t("button",{onClick:s[7]||(s[7]=c=>l.value=null),class:"btn bg-gray-200 text-gray-800"}," 取消 "),t("button",{onClick:s[8]||(s[8]=c=>W()),class:"btn btn-danger"}," 確認刪除 ")])])])):E("",!0)])}}},We={class:"card bg-white p-4 mb-6"},Le={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Be={class:"p-3 bg-gray-50 rounded-lg"},Ye={class:"p-3 bg-gray-50 rounded-lg"},Ke={class:"text-lg font-semibold"},Je={class:"flex justify-between items-center mb-4"},He={class:"card"},Ge={key:0,class:"text-center py-6 text-gray-500"},Xe={key:1,class:"table-container"},Ze={class:"table"},Qe={class:"flex space-x-2"},ts=["onClick"],es=["onClick"],ss={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},ls={class:"bg-white rounded-lg p-6 max-w-md w-full"},ns={class:"text-lg font-bold mb-4"},os={class:"mb-4"},as={class:"mb-4"},rs={class:"mb-4"},is={class:"mb-4"},us={class:"mb-4"},cs={class:"mb-4"},ds=["value"],ms={class:"mb-4"},ps={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},bs={class:"bg-white rounded-lg p-6 max-w-md w-full"},vs={class:"mb-4"},ys={class:"flex justify-end space-x-3"},fs={__name:"RealizedView",setup(_){const{getRealizedTrades:b,addRealizedTrade:D,updateRealizedTrade:k,deleteRealizedTrade:r}=G(),a=z([]),v=z(!1),w=z(null),m=z(null),l=it({symbol:"",name:"",sellPrice:0,quantity:0,buyPrice:0,date:new Date().toISOString().split("T")[0]}),i=I(()=>a.value.reduce((u,e)=>u+e.profit,0)),o=I(()=>[...a.value].sort((u,e)=>new Date(e.date)-new Date(u.date))),d=()=>{a.value=b()},q=u=>{const e=a.value[u];w.value=u,l.symbol=e.symbol,l.name=e.name,l.sellPrice=e.sellPrice,l.quantity=e.quantity,l.buyPrice=e.cost/e.quantity||0,l.date=e.date,v.value=!0},P=u=>{m.value=u},$=()=>{m.value!==null&&(r(m.value),d(),m.value=null)},R=()=>{const u=y(),S=l.sellPrice*l.quantity-u,n={symbol:l.symbol,name:l.name,sellPrice:l.sellPrice,quantity:l.quantity,cost:u,profit:S,date:l.date};w.value!==null?k(w.value,n):D(n),d(),w.value=null,v.value=!1,C()},A=()=>{v.value=!1,w.value=null,C()},C=()=>{l.symbol="",l.name="",l.sellPrice=0,l.quantity=0,l.buyPrice=0,l.date=new Date().toISOString().split("T")[0]},O=u=>new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(u),W=u=>u.toFixed(2),p=u=>rt(u).format("YYYY/MM/DD"),g=u=>{if(u.cost===0)return"0.00%";const e=u.profit/u.cost*100;return`${e>=0?"+":""}${e.toFixed(2)}%`},y=()=>l.buyPrice*l.quantity;return Q(()=>{d()}),(u,e)=>{var S;return h(),x("div",null,[e[21]||(e[21]=t("h2",{class:"text-xl font-bold mb-4"},"已實現收益",-1)),t("div",We,[t("div",Le,[t("div",Be,[e[9]||(e[9]=t("h3",{class:"text-gray-500 text-sm"},"總實現收益",-1)),t("p",{class:j(["text-lg font-semibold",i.value>=0?"positive":"negative"])},f(i.value>0?"+":"")+f(O(i.value)),3)]),t("div",Ye,[e[10]||(e[10]=t("h3",{class:"text-gray-500 text-sm"},"總交易次數",-1)),t("p",Ke,f(a.value.length)+" 次",1)])])]),t("div",Je,[t("button",{onClick:e[0]||(e[0]=n=>v.value=!0),class:"btn btn-primary"}," + 新增已實現收益 ")]),t("div",He,[a.value.length===0?(h(),x("div",Ge," 尚未新增已實現收益資料，請點擊「新增已實現收益」按鈕進行新增。 ")):(h(),x("div",Xe,[t("table",Ze,[e[11]||(e[11]=t("thead",null,[t("tr",null,[t("th",null,"日期"),t("th",null,"代碼"),t("th",null,"名稱"),t("th",null,"賣出價格"),t("th",null,"數量"),t("th",null,"總成本"),t("th",null,"實現損益"),t("th",null,"報酬率"),t("th",null,"操作")])],-1)),t("tbody",null,[(h(!0),x(K,null,J(o.value,(n,s)=>(h(),x("tr",{key:s},[t("td",null,f(p(n.date)),1),t("td",null,f(n.symbol),1),t("td",null,f(n.name),1),t("td",null,f(W(n.sellPrice)),1),t("td",null,f(n.quantity),1),t("td",null,f(O(n.cost)),1),t("td",{class:j(n.profit>=0?"positive":"negative")},f(n.profit>0?"+":"")+f(O(n.profit)),3),t("td",{class:j(n.profit>=0?"positive":"negative")},f(g(n)),3),t("td",null,[t("div",Qe,[t("button",{onClick:T=>q(s),class:"text-primary text-sm"}," 編輯 ",8,ts),t("button",{onClick:T=>P(s),class:"text-danger text-sm"}," 刪除 ",8,es)])])]))),128))])])]))]),v.value?(h(),x("div",ss,[t("div",ls,[t("h3",ns,f(w.value===null?"新增已實現收益":"編輯已實現收益"),1),t("form",{onSubmit:ut(R,["prevent"])},[t("div",os,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium mb-1"},"股票代碼",-1)),V(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>l.symbol=n),required:"",class:"input w-full",placeholder:"例如：2330.TW 或 AAPL"},null,512),[[M,l.symbol]])]),t("div",as,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium mb-1"},"股票名稱",-1)),V(t("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>l.name=n),required:"",class:"input w-full",placeholder:"例如：台積電 或 蘋果"},null,512),[[M,l.name]])]),t("div",rs,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium mb-1"},"賣出價格",-1)),V(t("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>l.sellPrice=n),type:"number",step:"0.01",required:"",class:"input w-full",placeholder:"每股賣出價格"},null,512),[[M,l.sellPrice,void 0,{number:!0}]])]),t("div",is,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium mb-1"},"數量",-1)),V(t("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>l.quantity=n),type:"number",required:"",class:"input w-full",placeholder:"賣出數量"},null,512),[[M,l.quantity,void 0,{number:!0}]])]),t("div",us,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium mb-1"},"買入價格",-1)),V(t("input",{"onUpdate:modelValue":e[5]||(e[5]=n=>l.buyPrice=n),type:"number",step:"0.01",required:"",class:"input w-full",placeholder:"每股買入價格"},null,512),[[M,l.buyPrice,void 0,{number:!0}]])]),t("div",cs,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium mb-1"},"總成本",-1)),t("input",{value:y(),type:"number",step:"0.01",disabled:"",class:"input w-full bg-gray-100"},null,8,ds)]),t("div",ms,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium mb-1"},"賣出日期",-1)),V(t("input",{"onUpdate:modelValue":e[6]||(e[6]=n=>l.date=n),type:"date",required:"",class:"input w-full"},null,512),[[M,l.date]])]),t("div",{class:"flex justify-end space-x-3"},[t("button",{type:"button",onClick:A,class:"btn bg-gray-200 text-gray-800"}," 取消 "),e[19]||(e[19]=t("button",{type:"submit",class:"btn btn-primary"},"儲存",-1))])],32)])])):E("",!0),m.value!==null?(h(),x("div",ps,[t("div",bs,[e[20]||(e[20]=t("h3",{class:"text-lg font-bold mb-4"},"確認刪除",-1)),t("p",vs," 確定要刪除「"+f((S=a.value[m.value])==null?void 0:S.name)+"」的已實現收益資料嗎？ ",1),t("div",ys,[t("button",{onClick:e[7]||(e[7]=n=>m.value=null),class:"btn bg-gray-200 text-gray-800"}," 取消 "),t("button",{onClick:e[8]||(e[8]=n=>$()),class:"btn btn-danger"}," 確認刪除 ")])])])):E("",!0)])}}},gs=[{path:"/",component:Ne},{path:"/realized",component:fs},{path:"/charts",component:ie}],hs=zt({history:Ft(),routes:gs}),ct=It(Lt);ct.use(hs);ct.mount("#app");
