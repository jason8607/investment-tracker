import{r as it,o as $,c as k,a as t,F as H,b as X,d as Y,w as et,t as y,u as N,e as vt,f as gt,g as mt,n as I,T as ht,h as xt,i as _t,C as $t,A as kt,p as St,j as wt,k as Dt,B as Tt,P as Ct,L as Pt,l as qt,m as q,q as F,s as ot,v as J,x as E,y as pt,z as zt,D as Ft,E as Ut,G as Vt,H as nt,I as bt,J as yt,K as V,M as R,N as Wt,O as Ot,Q as At,R as Rt}from"./vendor-d115be86.js";(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))_(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&_(c)}).observe(document,{childList:!0,subtree:!0});function x(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function _(l){if(l.ep)return;l.ep=!0;const r=x(l);fetch(l.href,r)}})();const ct="investment-tracker-stocks",ut="investment-tracker-realized";function G(){const b=()=>{try{const u=localStorage.getItem(ct);return u?JSON.parse(u):[]}catch(u){return console.error("無法讀取持股資料",u),[]}},h=u=>{try{localStorage.setItem(ct,JSON.stringify(u))}catch(v){console.error("無法儲存持股資料",v)}},x=u=>{const v=b();v.push(u),h(v)},_=(u,v)=>{const a=b();a[u]=v,h(a)},l=u=>{const v=b();v.splice(u,1),h(v)},r=()=>{try{const u=localStorage.getItem(ut);return u?JSON.parse(u):[]}catch(u){return console.error("無法讀取已實現收益資料",u),[]}},c=u=>{try{localStorage.setItem(ut,JSON.stringify(u))}catch(v){console.error("無法儲存已實現收益資料",v)}};return{getStocks:b,setStocks:h,addStock:x,updateStock:_,deleteStock:l,getRealizedTrades:r,setRealizedTrades:c,addRealizedTrade:u=>{const v=r();v.push(u),c(v)},updateRealizedTrade:(u,v)=>{const a=r();a[u]=v,c(a)},deleteRealizedTrade:u=>{const v=r();v.splice(u,1),c(v)}}}const jt={class:"min-h-screen"},It={class:"bg-primary text-white p-4 shadow-md"},Et={class:"container mx-auto flex justify-between items-center"},Nt={class:"flex space-x-2"},Mt={class:"btn bg-secondary text-white text-sm px-3 py-1 cursor-pointer"},Lt={class:"bg-white shadow-sm"},Bt={class:"container mx-auto"},Yt={class:"flex"},Jt={class:"container mx-auto p-4"},Kt={class:"bg-gray-100 text-gray-600 p-4 text-center text-sm"},Ht={__name:"App",setup(b){const{getStocks:h,getRealizedTrades:x,setStocks:_,setRealizedTrades:l}=G(),r=[{name:"持股管理",path:"/"},{name:"已實現收益",path:"/realized"},{name:"圖表分析",path:"/charts"}],c=()=>{const S=N.book_new(),o=h(),u=x(),v=o.map(D=>({股票代碼:D.symbol,股票名稱:D.name,市場:D.market,成本價:D.cost,數量:D.quantity,購買日期:D.purchaseDate})),a=u.map(D=>({股票代碼:D.symbol,股票名稱:D.name,賣出價格:D.sellPrice,數量:D.quantity,成本:D.cost,實現損益:D.profit,日期:D.date})),z=N.json_to_sheet(v),W=N.json_to_sheet(a);N.book_append_sheet(S,z,"持股紀錄"),N.book_append_sheet(S,W,"已實現收益"),vt(S,"投資損益資料.xlsx")},P=S=>{const o=S.target.files[0];if(!o)return;const u=new FileReader;u.onload=v=>{const a=new Uint8Array(v.target.result),z=gt(a,{type:"array"}),W=z.Sheets.持股紀錄;if(W){const O=N.sheet_to_json(W).map(C=>({symbol:C.股票代碼,name:C.股票名稱,market:C.市場,cost:parseFloat(C.成本價),quantity:parseInt(C.數量),purchaseDate:C.購買日期}));_(O)}const D=z.Sheets.已實現收益;if(D){const O=N.sheet_to_json(D).map(C=>({symbol:C.股票代碼,name:C.股票名稱,sellPrice:parseFloat(C.賣出價格),quantity:parseInt(C.數量),cost:parseFloat(C.成本),profit:parseFloat(C.實現損益),date:C.日期}));l(O)}S.target.value="",alert("資料匯入成功！")},u.readAsArrayBuffer(o)};return(S,o)=>{const u=it("router-link"),v=it("router-view");return $(),k("div",jt,[t("header",It,[t("div",Et,[o[3]||(o[3]=t("h1",{class:"text-xl md:text-2xl font-bold"},"投資損益小幫手",-1)),t("div",Nt,[t("button",{onClick:c,class:"btn bg-secondary text-white text-sm px-3 py-1"},o[0]||(o[0]=[t("span",{class:"hidden md:inline"},"匯出資料",-1),t("span",{class:"md:hidden"},"匯出",-1)])),t("label",Mt,[o[1]||(o[1]=t("span",{class:"hidden md:inline"},"匯入資料",-1)),o[2]||(o[2]=t("span",{class:"md:hidden"},"匯入",-1)),t("input",{type:"file",accept:".xlsx",class:"hidden",onChange:P},null,32)])])])]),t("nav",Lt,[t("div",Bt,[t("ul",Yt,[($(),k(H,null,X(r,a=>t("li",{key:a.path},[Y(u,{to:a.path,class:I(["block px-4 py-3 hover:bg-gray-100 transition-colors border-b-2",S.$route.path===a.path?"border-primary text-primary font-medium":"border-transparent"])},{default:et(()=>[mt(y(a.name),1)]),_:2},1032,["to","class"])])),64))])])]),t("main",Jt,[Y(v,null,{default:et(({Component:a})=>[Y(ht,{name:"fade",mode:"out-in"},{default:et(()=>[($(),xt(_t(a)))]),_:2},1024)]),_:1})]),t("footer",Kt,[t("p",null,"投資損益小幫手 © "+y(new Date().getFullYear()),1)])])}}};const Xt={class:"mb-6"},Zt={class:"flex flex-wrap space-x-2"},Gt=["onClick"],Qt={class:"card"},te={key:0,class:"p-4"},ee={key:0,class:"text-center py-6 text-gray-500"},se={key:1,class:"flex flex-col md:flex-row"},le={class:"w-full md:w-1/2 min-h-[300px]"},oe={class:"w-full md:w-1/2 p-4"},ne={class:"flex-1"},ae={class:"text-right"},re={key:1,class:"p-4"},ie={key:0,class:"text-center py-6 text-gray-500"},ce={key:1,class:"min-h-[300px]"},ue={key:2,class:"p-4"},de={key:0,class:"text-center py-6 text-gray-500"},me={key:1,class:"min-h-[300px]"},pe={__name:"ChartsView",setup(b){$t.register(kt,St,wt,Dt,LinearScale,Tt,Ct,Pt,qt);const{getStocks:h,getRealizedTrades:x}=G(),_=q("allocation"),l=q([]),r=q([]),c=q({}),P=[{id:"allocation",name:"持股分配"},{id:"profit",name:"總體損益"},{id:"realized",name:"已實現收益趨勢"}],S=["#4CAF50","#2196F3","#F44336","#FF9800","#9C27B0","#3F51B5","#009688","#795548","#607D8B","#E91E63"],o=F(()=>l.value.length>0),u=F(()=>r.value.length>0),v=F(()=>o.value||u.value),a=F(()=>{if(!o.value)return[];const p=l.value.map(f=>{var T;const s=(((T=c.value[f.symbol])==null?void 0:T.price)||f.cost)*f.quantity;return{...f,marketValue:s}}),g=p.reduce((f,m)=>f+m.marketValue,0);return p.map(f=>({...f,percentage:f.marketValue/g*100})).sort((f,m)=>m.marketValue-f.marketValue)}),z=F(()=>o.value?{labels:a.value.map(p=>p.name),datasets:[{data:a.value.map(p=>p.marketValue),backgroundColor:a.value.map((p,g)=>S[g%S.length]),hoverOffset:4}]}:{datasets:[]}),W=F(()=>{const p=["未實現損益","已實現收益","總體損益"],g=l.value.reduce((T,d)=>{var Z;const K=(((Z=c.value[d.symbol])==null?void 0:Z.price)||d.cost)*d.quantity,Q=d.cost*d.quantity;return T+(K-Q)},0),f=r.value.reduce((T,d)=>T+d.profit,0),m=g+f,s=[g,f,m];return{labels:p,datasets:[{label:"損益金額",data:s,backgroundColor:s.map(T=>T>=0?"rgba(76, 175, 80, 0.6)":"rgba(244, 67, 54, 0.6)"),borderColor:s.map(T=>T>=0?"rgb(76, 175, 80)":"rgb(244, 67, 54)"),borderWidth:1}]}}),D=F(()=>{if(!u.value)return{datasets:[]};const p=[...r.value].sort((s,T)=>new Date(s.date)-new Date(T.date));let g=0;const f=[],m=[];return p.forEach(s=>{g+=s.profit,f.push(g),m.push(pt(s.date).format("YYYY/MM/DD"))}),{labels:m,datasets:[{label:"累計已實現收益",data:f,borderColor:"rgb(54, 162, 235)",backgroundColor:"rgba(54, 162, 235, 0.5)",tension:.1,pointBackgroundColor:f.map(s=>s>=0?"rgb(76, 175, 80)":"rgb(244, 67, 54)")}]}}),j={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(p){const g=p.label||"",f=p.raw||0,m=f/p.dataset.data.reduce((s,T)=>s+T,0)*100;return`${g}: ${A(f)} (${m.toFixed(2)}%)`}}}}},O={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(p){return`${p.dataset.label}: ${A(p.raw)}`}}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(p){return A(p)}}}}},C={responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{callbacks:{label:function(p){return`${p.dataset.label}: ${A(p.raw)}`}}}},scales:{y:{ticks:{callback:function(p){return A(p)}}}}},A=p=>new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(p),M=()=>{l.value=h(),r.value=x();const p={};l.value.forEach(g=>{p[g.symbol]={price:g.cost,change:0,changePercent:0}}),c.value=p;try{const g=localStorage.getItem("investment-tracker-prices");g&&(c.value={...c.value,...JSON.parse(g)})}catch(g){console.error("無法讀取價格資料",g)}};return ot(()=>{M(),window.addEventListener("storage",p=>{(p.key==="investment-tracker-stocks"||p.key==="investment-tracker-realized"||p.key==="investment-tracker-prices")&&M()})}),(p,g)=>($(),k("div",null,[g[4]||(g[4]=t("h2",{class:"text-xl font-bold mb-4"},"圖表分析",-1)),t("div",Xt,[t("div",Zt,[($(),k(H,null,X(P,f=>t("button",{key:f.id,onClick:m=>_.value=f.id,class:I(["px-4 py-2 rounded-md transition-colors mb-2",_.value===f.id?"bg-primary text-white":"bg-gray-100 text-gray-700"])},y(f.name),11,Gt)),64))])]),t("div",Qt,[_.value==="allocation"?($(),k("div",te,[g[1]||(g[1]=t("h3",{class:"text-lg font-medium mb-4"},"持股分配",-1)),o.value?($(),k("div",se,[t("div",le,[Y(J(zt),{"chart-data":z.value,"chart-options":j},null,8,["chart-data"])]),t("div",oe,[g[0]||(g[0]=t("h4",{class:"text-md font-medium mb-2"},"持股比例",-1)),($(!0),k(H,null,X(a.value,(f,m)=>($(),k("div",{key:m,class:"flex items-center mb-2"},[t("div",{class:"w-4 h-4 rounded-full mr-2",style:Ft({backgroundColor:S[m%S.length]})},null,4),t("div",ne,y(f.name)+" ("+y(f.symbol)+")",1),t("div",ae,y(f.percentage.toFixed(2))+"%",1)]))),128))])])):($(),k("div",ee," 尚未新增持股資料，請先在持股管理頁面新增股票。 "))])):E("",!0),_.value==="profit"?($(),k("div",re,[g[2]||(g[2]=t("h3",{class:"text-lg font-medium mb-4"},"總體損益",-1)),v.value?($(),k("div",ce,[Y(J(Ut),{"chart-data":W.value,"chart-options":O},null,8,["chart-data"])])):($(),k("div",ie," 尚未有足夠資料，請先新增持股或已實現收益。 "))])):E("",!0),_.value==="realized"?($(),k("div",ue,[g[3]||(g[3]=t("h3",{class:"text-lg font-medium mb-4"},"已實現收益分析",-1)),u.value?($(),k("div",me,[Y(J(Vt),{"chart-data":D.value,"chart-options":C},null,8,["chart-data"])])):($(),k("div",de," 尚未新增已實現收益資料，請先在已實現收益頁面新增資料。 "))])):E("",!0)])]))}},at="https://yahoo-finance-backend.vercel.app";let B={USD_TWD:null,lastUpdated:null};async function be(){const b=new Date;if(B.USD_TWD&&B.lastUpdated&&b-B.lastUpdated<36e5)return console.log("使用緩存的匯率數據"),B.USD_TWD;try{const h=["USDTWD=X","TWD=X"];let x,_=null;for(const l of h)try{const r=`${at}/api/stock/${l}`;if(console.log(`請求美元兌台幣匯率 (${l})...`),x=await nt.get(r,{headers:{Accept:"application/json","Cache-Control":"no-cache"},timeout:1e4}),!x.data.error&&x.data.price){_=x.data.price,console.log(`成功獲取美元兌台幣匯率: 1 USD = ${_} TWD (使用${l})`);break}}catch(r){console.error(`使用 ${l} 獲取匯率失敗:`,r.message)}_||(console.log("無法從API獲取匯率，使用預設值"),_=30),B={USD_TWD:_,lastUpdated:b};try{localStorage.setItem("exchange-rate-cache",JSON.stringify(B))}catch(l){console.error("無法將匯率數據存入localStorage",l)}return _}catch(h){console.error("獲取匯率失敗:",h);try{const x=localStorage.getItem("exchange-rate-cache");if(x){const _=JSON.parse(x);return console.log("使用localStorage中的匯率數據"),_.USD_TWD}}catch(x){console.error("讀取緩存匯率失敗",x)}return 30}}function lt(b){return b?b.includes(".")?b:/^\d+$/.test(b)?`${b}.TW`:b:""}async function ye(b){const h=b,x=lt(b),_=`${at}/api/stock/${x}`;console.log(`請求股票數據：${x}`);try{const l=await nt.get(_,{headers:{Accept:"application/json","Cache-Control":"no-cache"},timeout:1e4});if(l.data.error)throw new Error(`API 錯誤: ${l.data.error}`);return console.log(`成功獲取 ${x} 價格: ${l.data.price} ${l.data.currency}`),{...l.data,originalSymbol:h}}catch(l){throw console.error(`獲取 ${x} 價格失敗:`,l),l.response?new Error(`API 請求失敗: ${l.response.status} ${l.response.statusText}`):l.request?new Error("無法連接到服務器，請檢查網絡連接"):l}}async function fe(b){const h=b.filter(l=>l&&l.trim());if(h.length===0)return[];const x=h.map(l=>lt(l)),_=`${at}/api/stocks?symbols=${x.join(",")}`;console.log(`批量獲取股票數據: ${h.join(", ")}`);try{const l=await nt.get(_,{headers:{Accept:"application/json","Cache-Control":"no-cache"},timeout:15e3});return console.log(`成功獲取 ${l.data.length} 支股票數據`),l.data.map((c,P)=>(c.originalSymbol||(c.originalSymbol=h[P]),c))}catch(l){console.error("批量獲取股票數據失敗:",l),console.log("嘗試逐個獲取股票數據...");const r=h.map(c=>ye(c).catch(P=>(console.error(`獲取 ${c} 數據失敗:`,P),{error:!0,errorMessage:P.message||"未知錯誤",symbol:lt(c),originalSymbol:c})));return Promise.all(r)}}function st(b,h,x=2){return b==null?"-":`${h==="TWD"?"NT$":"$"}${b.toFixed(x)}`}function ve(b,h,x=2){if(b==null)return"-";const _=`$${b.toFixed(x)}`,l=`NT$${(b*h).toFixed(x)}`;return`${_} (${l})`}function dt(b){return b==null?"":b>0?"positive":b<0?"negative":""}const ge={class:"card bg-white p-4 mb-6"},he={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},xe={class:"p-3 bg-gray-50 rounded-lg"},_e={class:"text-lg font-semibold"},$e={class:"p-3 bg-gray-50 rounded-lg"},ke={class:"text-lg font-semibold"},Se={class:"p-3 bg-gray-50 rounded-lg"},we={class:"text-sm"},De={class:"flex justify-between items-center mb-4"},Te={class:"flex items-center"},Ce={class:"text-sm text-gray-500 mr-3"},Pe={key:0,class:"inline-block animate-spin"},qe={class:"card"},ze={key:0,class:"text-center py-6 text-gray-500"},Fe={key:1,class:"table-container"},Ue={class:"table"},Ve={class:"flex space-x-2"},We=["onClick"],Oe=["onClick"],Ae={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},Re={class:"bg-white rounded-lg p-6 max-w-md w-full"},je={class:"text-lg font-bold mb-4"},Ie={class:"mb-4"},Ee={class:"mb-4"},Ne={class:"mb-4"},Me={class:"mb-4"},Le={class:"mb-4"},Be={class:"mb-4"},Ye={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},Je={class:"bg-white rounded-lg p-6 max-w-md w-full"},Ke={class:"mb-4"},He={class:"flex justify-end space-x-3"},Xe={__name:"HomeView",setup(b){const{getStocks:h,addStock:x,updateStock:_,deleteStock:l}=G(),r=q([]),c=q({}),P=q(!1),S=q(null),o=q(null),u=q(!1),v=q(30),a=bt({symbol:"",name:"",market:"台股",cost:0,quantity:0,purchaseDate:new Date().toISOString().split("T")[0]}),z=F(()=>r.value.reduce((n,e)=>n+e.cost*e.quantity,0)),W=F(()=>r.value.reduce((n,e)=>{const w=d(e);return n+w*e.quantity},0)),D=F(()=>W.value-z.value),j=F(()=>z.value===0?0:D.value/z.value*100),O=()=>{r.value=h(),r.value.length>0&&C()},C=async()=>{if(r.value.length!==0){u.value=!0;try{const n=r.value.map(i=>i.symbol),e=await fe(n),w={};e.forEach(i=>{const U=i.originalSymbol||i.symbol;w[U]=i}),c.value=w;try{localStorage.setItem("investment-tracker-prices",JSON.stringify(w))}catch(i){console.error("無法儲存價格資料到本地存儲",i)}}catch(n){console.error("更新價格出錯",n)}finally{u.value=!1}}},A=n=>{const e=r.value[n];S.value=n,a.symbol=e.symbol,a.name=e.name,a.market=e.market,a.cost=e.cost,a.quantity=e.quantity,a.purchaseDate=e.purchaseDate||"",P.value=!0},M=n=>{o.value=n},p=()=>{o.value!==null&&(l(o.value),O(),o.value=null)},g=()=>{const n={symbol:a.symbol,name:a.name,market:a.market,cost:a.cost,quantity:a.quantity,purchaseDate:a.purchaseDate};S.value!==null?_(S.value,n):x(n),O(),S.value=null,P.value=!1,m()},f=()=>{P.value=!1,S.value=null,m()},m=()=>{a.symbol="",a.name="",a.market="台股",a.cost=0,a.quantity=0,a.purchaseDate=new Date().toISOString().split("T")[0]},s=n=>new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(n),T=n=>{const e=c.value[n.symbol]||c.value[`${n.symbol}.TW`]||Object.values(c.value).find(w=>w.originalSymbol===n.symbol||w.symbol===n.symbol||w.symbol===`${n.symbol}.TW`);return e&&e.price||0},d=n=>{const e=T(n),w=c.value[n.symbol]||c.value[`${n.symbol}.TW`]||Object.values(c.value).find(i=>i.originalSymbol===n.symbol||i.symbol===n.symbol||i.symbol===`${n.symbol}.TW`);return w&&w.currency==="USD"?e*v.value:e},L=n=>{const e=T(n);if(!e)return"載入中...";const w=c.value[n.symbol]||c.value[`${n.symbol}.TW`]||Object.values(c.value).find(i=>i.originalSymbol===n.symbol||i.symbol===n.symbol||i.symbol===`${n.symbol}.TW`);return w?w.currency==="USD"?ve(e,v.value):st(e,"TWD"):st(e)},K=n=>{const e=c.value[n.symbol]||c.value[`${n.symbol}.TW`]||Object.values(c.value).find(w=>w.originalSymbol===n.symbol||w.symbol===n.symbol||w.symbol===`${n.symbol}.TW`);return(e==null?void 0:e.change)||0},Q=(n,e)=>{if(!e)return"載入中...";const w=n.cost*n.quantity,U=e*n.quantity-w,tt=w>0?U/w*100:0,rt=U>=0?"+":"";return`${rt}${s(U)} (${rt}${tt.toFixed(2)}%)`},Z=(n,e)=>{if(!e)return"";const w=n.cost*n.quantity,U=e*n.quantity-w;return U>0?"positive":U<0?"negative":""};return ot(()=>{O(),be().then(n=>{v.value=n,console.log(`設置匯率: 1 USD = ${n} TWD`),C()}).catch(n=>{console.error("獲取匯率失敗，使用預設值",n)})}),(n,e)=>{var w;return $(),k("div",null,[e[23]||(e[23]=t("h2",{class:"text-xl font-bold mb-4"},"持股管理",-1)),t("div",ge,[t("div",he,[t("div",xe,[e[9]||(e[9]=t("h3",{class:"text-gray-500 text-sm"},"總投資成本",-1)),t("p",_e,y(s(z.value)),1)]),t("div",$e,[e[10]||(e[10]=t("h3",{class:"text-gray-500 text-sm"},"目前總市值",-1)),t("p",ke,y(s(W.value)),1)]),t("div",Se,[e[11]||(e[11]=t("h3",{class:"text-gray-500 text-sm"},"未實現損益",-1)),t("p",{class:I(["text-lg font-semibold",J(dt)(D.value)])},[mt(y(D.value>0?"+":"")+y(s(D.value))+" ",1),t("span",we," ("+y(j.value>0?"+":"")+y(j.value.toFixed(2))+"%) ",1)],2)])])]),t("div",De,[t("button",{onClick:e[0]||(e[0]=i=>P.value=!0),class:"btn btn-primary"}," + 新增持股 "),t("div",Te,[t("span",Ce,"匯率: 1 USD = "+y(v.value.toFixed(2))+" TWD",1),t("button",{onClick:C,class:"btn bg-gray-100 text-gray-700 flex items-center"},[e[12]||(e[12]=t("span",{class:"mr-1"},"更新價格",-1)),u.value?($(),k("span",Pe,"⟳")):E("",!0)])])]),t("div",qe,[r.value.length===0?($(),k("div",ze," 尚未新增持股資料，請點擊「新增持股」按鈕開始追蹤。 ")):($(),k("div",Fe,[t("table",Ue,[e[13]||(e[13]=t("thead",null,[t("tr",null,[t("th",null,"代碼"),t("th",null,"名稱"),t("th",null,"市場"),t("th",null,"持有股數"),t("th",null,"成本價"),t("th",null,"目前價格"),t("th",null,"市值"),t("th",null,"損益"),t("th",null,"操作")])],-1)),t("tbody",null,[($(!0),k(H,null,X(r.value,(i,U)=>($(),k("tr",{key:U},[t("td",null,y(i.symbol),1),t("td",null,y(i.name),1),t("td",null,y(i.market),1),t("td",null,y(i.quantity),1),t("td",null,y(J(st)(i.cost)),1),t("td",{class:I(J(dt)(K(i)))},y(L(i)),3),t("td",null,y(T(i)?s(i.quantity*d(i)):"載入中..."),1),t("td",{class:I(Z(i,d(i)))},y(Q(i,d(i))),3),t("td",null,[t("div",Ve,[t("button",{onClick:tt=>A(U),class:"text-primary text-sm"}," 編輯 ",8,We),t("button",{onClick:tt=>M(U),class:"text-danger text-sm"}," 刪除 ",8,Oe)])])]))),128))])])]))]),P.value?($(),k("div",Ae,[t("div",Re,[t("h3",je,y(S.value===null?"新增持股":"編輯持股"),1),t("form",{onSubmit:yt(g,["prevent"])},[t("div",Ie,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium mb-1"},"股票代碼",-1)),V(t("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>a.symbol=i),required:"",class:"input w-full",placeholder:"例如：2330.TW 或 AAPL"},null,512),[[R,a.symbol]])]),t("div",Ee,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium mb-1"},"股票名稱",-1)),V(t("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>a.name=i),required:"",class:"input w-full",placeholder:"例如：台積電 或 蘋果"},null,512),[[R,a.name]])]),t("div",Ne,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium mb-1"},"市場",-1)),V(t("select",{"onUpdate:modelValue":e[3]||(e[3]=i=>a.market=i),required:"",class:"input w-full"},e[16]||(e[16]=[t("option",{value:"台股"},"台股",-1),t("option",{value:"美股"},"美股",-1),t("option",{value:"其他"},"其他",-1)]),512),[[Wt,a.market]])]),t("div",Me,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium mb-1"},"成本價",-1)),V(t("input",{"onUpdate:modelValue":e[4]||(e[4]=i=>a.cost=i),type:"number",step:"0.01",required:"",class:"input w-full",placeholder:"每股成本"},null,512),[[R,a.cost,void 0,{number:!0}]])]),t("div",Le,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium mb-1"},"持有股數",-1)),V(t("input",{"onUpdate:modelValue":e[5]||(e[5]=i=>a.quantity=i),type:"number",required:"",class:"input w-full",placeholder:"持有數量"},null,512),[[R,a.quantity,void 0,{number:!0}]])]),t("div",Be,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium mb-1"},"購買日期",-1)),V(t("input",{"onUpdate:modelValue":e[6]||(e[6]=i=>a.purchaseDate=i),type:"date",class:"input w-full"},null,512),[[R,a.purchaseDate]])]),t("div",{class:"flex justify-end space-x-3"},[t("button",{type:"button",onClick:f,class:"btn bg-gray-200 text-gray-800"}," 取消 "),e[21]||(e[21]=t("button",{type:"submit",class:"btn btn-primary"},"儲存",-1))])],32)])])):E("",!0),o.value!==null?($(),k("div",Ye,[t("div",Je,[e[22]||(e[22]=t("h3",{class:"text-lg font-bold mb-4"},"確認刪除",-1)),t("p",Ke," 確定要刪除「"+y((w=r.value[o.value])==null?void 0:w.name)+"」的持股資料嗎？ ",1),t("div",He,[t("button",{onClick:e[7]||(e[7]=i=>o.value=null),class:"btn bg-gray-200 text-gray-800"}," 取消 "),t("button",{onClick:e[8]||(e[8]=i=>p()),class:"btn btn-danger"}," 確認刪除 ")])])])):E("",!0)])}}},Ze={class:"card bg-white p-4 mb-6"},Ge={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Qe={class:"p-3 bg-gray-50 rounded-lg"},ts={class:"p-3 bg-gray-50 rounded-lg"},es={class:"text-lg font-semibold"},ss={class:"flex justify-between items-center mb-4"},ls={class:"card"},os={key:0,class:"text-center py-6 text-gray-500"},ns={key:1,class:"table-container"},as={class:"table"},rs={class:"flex space-x-2"},is=["onClick"],cs=["onClick"],us={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},ds={class:"bg-white rounded-lg p-6 max-w-md w-full"},ms={class:"text-lg font-bold mb-4"},ps={class:"mb-4"},bs={class:"mb-4"},ys={class:"mb-4"},fs={class:"mb-4"},vs={class:"mb-4"},gs={class:"mb-4"},hs=["value"],xs={class:"mb-4"},_s={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},$s={class:"bg-white rounded-lg p-6 max-w-md w-full"},ks={class:"mb-4"},Ss={class:"flex justify-end space-x-3"},ws={__name:"RealizedView",setup(b){const{getRealizedTrades:h,addRealizedTrade:x,updateRealizedTrade:_,deleteRealizedTrade:l}=G(),r=q([]),c=q(!1),P=q(null),S=q(null),o=bt({symbol:"",name:"",sellPrice:0,quantity:0,buyPrice:0,date:new Date().toISOString().split("T")[0]}),u=F(()=>r.value.reduce((m,s)=>m+s.profit,0)),v=F(()=>[...r.value].sort((m,s)=>new Date(s.date)-new Date(m.date))),a=()=>{r.value=h()},z=m=>{const s=r.value[m];P.value=m,o.symbol=s.symbol,o.name=s.name,o.sellPrice=s.sellPrice,o.quantity=s.quantity,o.buyPrice=s.cost/s.quantity||0,o.date=s.date,c.value=!0},W=m=>{S.value=m},D=()=>{S.value!==null&&(l(S.value),a(),S.value=null)},j=()=>{const m=f(),T=o.sellPrice*o.quantity-m,d={symbol:o.symbol,name:o.name,sellPrice:o.sellPrice,quantity:o.quantity,cost:m,profit:T,date:o.date};P.value!==null?_(P.value,d):x(d),a(),P.value=null,c.value=!1,C()},O=()=>{c.value=!1,P.value=null,C()},C=()=>{o.symbol="",o.name="",o.sellPrice=0,o.quantity=0,o.buyPrice=0,o.date=new Date().toISOString().split("T")[0]},A=m=>new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(m),M=m=>m.toFixed(2),p=m=>pt(m).format("YYYY/MM/DD"),g=m=>{if(m.cost===0)return"0.00%";const s=m.profit/m.cost*100;return`${s>=0?"+":""}${s.toFixed(2)}%`},f=()=>o.buyPrice*o.quantity;return ot(()=>{a()}),(m,s)=>{var T;return $(),k("div",null,[s[21]||(s[21]=t("h2",{class:"text-xl font-bold mb-4"},"已實現收益",-1)),t("div",Ze,[t("div",Ge,[t("div",Qe,[s[9]||(s[9]=t("h3",{class:"text-gray-500 text-sm"},"總實現收益",-1)),t("p",{class:I(["text-lg font-semibold",u.value>=0?"positive":"negative"])},y(u.value>0?"+":"")+y(A(u.value)),3)]),t("div",ts,[s[10]||(s[10]=t("h3",{class:"text-gray-500 text-sm"},"總交易次數",-1)),t("p",es,y(r.value.length)+" 次",1)])])]),t("div",ss,[t("button",{onClick:s[0]||(s[0]=d=>c.value=!0),class:"btn btn-primary"}," + 新增已實現收益 ")]),t("div",ls,[r.value.length===0?($(),k("div",os," 尚未新增已實現收益資料，請點擊「新增已實現收益」按鈕進行新增。 ")):($(),k("div",ns,[t("table",as,[s[11]||(s[11]=t("thead",null,[t("tr",null,[t("th",null,"日期"),t("th",null,"代碼"),t("th",null,"名稱"),t("th",null,"賣出價格"),t("th",null,"數量"),t("th",null,"總成本"),t("th",null,"實現損益"),t("th",null,"報酬率"),t("th",null,"操作")])],-1)),t("tbody",null,[($(!0),k(H,null,X(v.value,(d,L)=>($(),k("tr",{key:L},[t("td",null,y(p(d.date)),1),t("td",null,y(d.symbol),1),t("td",null,y(d.name),1),t("td",null,y(M(d.sellPrice)),1),t("td",null,y(d.quantity),1),t("td",null,y(A(d.cost)),1),t("td",{class:I(d.profit>=0?"positive":"negative")},y(d.profit>0?"+":"")+y(A(d.profit)),3),t("td",{class:I(d.profit>=0?"positive":"negative")},y(g(d)),3),t("td",null,[t("div",rs,[t("button",{onClick:K=>z(L),class:"text-primary text-sm"}," 編輯 ",8,is),t("button",{onClick:K=>W(L),class:"text-danger text-sm"}," 刪除 ",8,cs)])])]))),128))])])]))]),c.value?($(),k("div",us,[t("div",ds,[t("h3",ms,y(P.value===null?"新增已實現收益":"編輯已實現收益"),1),t("form",{onSubmit:yt(j,["prevent"])},[t("div",ps,[s[12]||(s[12]=t("label",{class:"block text-sm font-medium mb-1"},"股票代碼",-1)),V(t("input",{"onUpdate:modelValue":s[1]||(s[1]=d=>o.symbol=d),required:"",class:"input w-full",placeholder:"例如：2330.TW 或 AAPL"},null,512),[[R,o.symbol]])]),t("div",bs,[s[13]||(s[13]=t("label",{class:"block text-sm font-medium mb-1"},"股票名稱",-1)),V(t("input",{"onUpdate:modelValue":s[2]||(s[2]=d=>o.name=d),required:"",class:"input w-full",placeholder:"例如：台積電 或 蘋果"},null,512),[[R,o.name]])]),t("div",ys,[s[14]||(s[14]=t("label",{class:"block text-sm font-medium mb-1"},"賣出價格",-1)),V(t("input",{"onUpdate:modelValue":s[3]||(s[3]=d=>o.sellPrice=d),type:"number",step:"0.01",required:"",class:"input w-full",placeholder:"每股賣出價格"},null,512),[[R,o.sellPrice,void 0,{number:!0}]])]),t("div",fs,[s[15]||(s[15]=t("label",{class:"block text-sm font-medium mb-1"},"數量",-1)),V(t("input",{"onUpdate:modelValue":s[4]||(s[4]=d=>o.quantity=d),type:"number",required:"",class:"input w-full",placeholder:"賣出數量"},null,512),[[R,o.quantity,void 0,{number:!0}]])]),t("div",vs,[s[16]||(s[16]=t("label",{class:"block text-sm font-medium mb-1"},"買入價格",-1)),V(t("input",{"onUpdate:modelValue":s[5]||(s[5]=d=>o.buyPrice=d),type:"number",step:"0.01",required:"",class:"input w-full",placeholder:"每股買入價格"},null,512),[[R,o.buyPrice,void 0,{number:!0}]])]),t("div",gs,[s[17]||(s[17]=t("label",{class:"block text-sm font-medium mb-1"},"總成本",-1)),t("input",{value:f(),type:"number",step:"0.01",disabled:"",class:"input w-full bg-gray-100"},null,8,hs)]),t("div",xs,[s[18]||(s[18]=t("label",{class:"block text-sm font-medium mb-1"},"賣出日期",-1)),V(t("input",{"onUpdate:modelValue":s[6]||(s[6]=d=>o.date=d),type:"date",required:"",class:"input w-full"},null,512),[[R,o.date]])]),t("div",{class:"flex justify-end space-x-3"},[t("button",{type:"button",onClick:O,class:"btn bg-gray-200 text-gray-800"}," 取消 "),s[19]||(s[19]=t("button",{type:"submit",class:"btn btn-primary"},"儲存",-1))])],32)])])):E("",!0),S.value!==null?($(),k("div",_s,[t("div",$s,[s[20]||(s[20]=t("h3",{class:"text-lg font-bold mb-4"},"確認刪除",-1)),t("p",ks," 確定要刪除「"+y((T=r.value[S.value])==null?void 0:T.name)+"」的已實現收益資料嗎？ ",1),t("div",Ss,[t("button",{onClick:s[7]||(s[7]=d=>S.value=null),class:"btn bg-gray-200 text-gray-800"}," 取消 "),t("button",{onClick:s[8]||(s[8]=d=>D()),class:"btn btn-danger"}," 確認刪除 ")])])])):E("",!0)])}}},Ds=[{path:"/",component:Xe},{path:"/realized",component:ws},{path:"/charts",component:pe}],Ts=Ot({history:At(),routes:Ds}),ft=Rt(Ht);ft.use(Ts);ft.mount("#app");
