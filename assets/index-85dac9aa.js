import{r as X,o as f,c as x,a as t,F as Y,b as J,d as W,w as Z,t as b,u as N,e as mt,f as pt,g as nt,n as E,T as bt,h as vt,i as yt,C as ft,A as gt,p as ht,j as xt,k as _t,B as kt,P as $t,L as wt,l as St,m as T,q as F,s as G,v as U,x as M,y as ot,z as Dt,D as Ct,E as Pt,G as Tt,H as at,I as rt,J as V,K as R,M as qt,N as zt,O as Ft,Q as Vt}from"./vendor-fc4b5792.js";(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))d(c);new MutationObserver(c=>{for(const a of c)if(a.type==="childList")for(const v of a.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&d(v)}).observe(document,{childList:!0,subtree:!0});function D(c){const a={};return c.integrity&&(a.integrity=c.integrity),c.referrerPolicy&&(a.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?a.credentials="include":c.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function d(c){if(c.ep)return;c.ep=!0;const a=D(c);fetch(c.href,a)}})();const tt="investment-tracker-stocks",et="investment-tracker-realized";function H(){const _=()=>{try{const r=localStorage.getItem(tt);return r?JSON.parse(r):[]}catch(r){return console.error("無法讀取持股資料",r),[]}},g=r=>{try{localStorage.setItem(tt,JSON.stringify(r))}catch(o){console.error("無法儲存持股資料",o)}},D=r=>{const o=_();o.push(r),g(o)},d=(r,o)=>{const h=_();h[r]=o,g(h)},c=r=>{const o=_();o.splice(r,1),g(o)},a=()=>{try{const r=localStorage.getItem(et);return r?JSON.parse(r):[]}catch(r){return console.error("無法讀取已實現收益資料",r),[]}},v=r=>{try{localStorage.setItem(et,JSON.stringify(r))}catch(o){console.error("無法儲存已實現收益資料",o)}};return{getStocks:_,setStocks:g,addStock:D,updateStock:d,deleteStock:c,getRealizedTrades:a,setRealizedTrades:v,addRealizedTrade:r=>{const o=a();o.push(r),v(o)},updateRealizedTrade:(r,o)=>{const h=a();h[r]=o,v(h)},deleteRealizedTrade:r=>{const o=a();o.splice(r,1),v(o)}}}const At={class:"min-h-screen"},It={class:"bg-primary text-white p-4 shadow-md"},jt={class:"container mx-auto flex justify-between items-center"},Rt={class:"flex space-x-2"},Ot={class:"btn bg-secondary text-white text-sm px-3 py-1 cursor-pointer"},Et={class:"bg-white shadow-sm"},Mt={class:"container mx-auto"},Nt={class:"flex"},Ut={class:"container mx-auto p-4"},Lt={class:"bg-gray-100 text-gray-600 p-4 text-center text-sm"},Wt={__name:"App",setup(_){const{getStocks:g,getRealizedTrades:D,setStocks:d,setRealizedTrades:c}=H(),a=[{name:"持股管理",path:"/"},{name:"已實現收益",path:"/realized"},{name:"圖表分析",path:"/charts"}],v=()=>{const k=N.book_new(),n=g(),r=D(),o=n.map($=>({股票代碼:$.symbol,股票名稱:$.name,市場:$.market,成本價:$.cost,數量:$.quantity,購買日期:$.purchaseDate})),h=r.map($=>({股票代碼:$.symbol,股票名稱:$.name,賣出價格:$.sellPrice,數量:$.quantity,成本:$.cost,實現損益:$.profit,日期:$.date})),A=N.json_to_sheet(o),q=N.json_to_sheet(h);N.book_append_sheet(k,A,"持股紀錄"),N.book_append_sheet(k,q,"已實現收益"),mt(k,"投資損益資料.xlsx")},C=k=>{const n=k.target.files[0];if(!n)return;const r=new FileReader;r.onload=o=>{const h=new Uint8Array(o.target.result),A=pt(h,{type:"array"}),q=A.Sheets.持股紀錄;if(q){const I=N.sheet_to_json(q).map(S=>({symbol:S.股票代碼,name:S.股票名稱,market:S.市場,cost:parseFloat(S.成本價),quantity:parseInt(S.數量),purchaseDate:S.購買日期}));d(I)}const $=A.Sheets.已實現收益;if($){const I=N.sheet_to_json($).map(S=>({symbol:S.股票代碼,name:S.股票名稱,sellPrice:parseFloat(S.賣出價格),quantity:parseInt(S.數量),cost:parseFloat(S.成本),profit:parseFloat(S.實現損益),date:S.日期}));c(I)}k.target.value="",alert("資料匯入成功！")},r.readAsArrayBuffer(n)};return(k,n)=>{const r=X("router-link"),o=X("router-view");return f(),x("div",At,[t("header",It,[t("div",jt,[n[3]||(n[3]=t("h1",{class:"text-xl md:text-2xl font-bold"},"投資損益小幫手",-1)),t("div",Rt,[t("button",{onClick:v,class:"btn bg-secondary text-white text-sm px-3 py-1"},n[0]||(n[0]=[t("span",{class:"hidden md:inline"},"匯出資料",-1),t("span",{class:"md:hidden"},"匯出",-1)])),t("label",Ot,[n[1]||(n[1]=t("span",{class:"hidden md:inline"},"匯入資料",-1)),n[2]||(n[2]=t("span",{class:"md:hidden"},"匯入",-1)),t("input",{type:"file",accept:".xlsx",class:"hidden",onChange:C},null,32)])])])]),t("nav",Et,[t("div",Mt,[t("ul",Nt,[(f(),x(Y,null,J(a,h=>t("li",{key:h.path},[W(r,{to:h.path,class:E(["block px-4 py-3 hover:bg-gray-100 transition-colors border-b-2",k.$route.path===h.path?"border-primary text-primary font-medium":"border-transparent"])},{default:Z(()=>[nt(b(h.name),1)]),_:2},1032,["to","class"])])),64))])])]),t("main",Ut,[W(o,null,{default:Z(({Component:h})=>[W(bt,{name:"fade",mode:"out-in"},{default:Z(()=>[(f(),vt(yt(h)))]),_:2},1024)]),_:1})]),t("footer",Lt,[t("p",null,"投資損益小幫手 © "+b(new Date().getFullYear()),1)])])}}};const Bt={class:"mb-6"},Yt={class:"flex flex-wrap space-x-2"},Jt=["onClick"],Kt={class:"card"},Ht={key:0,class:"p-4"},Zt={key:0,class:"text-center py-6 text-gray-500"},Gt={key:1,class:"flex flex-col md:flex-row"},Qt={class:"w-full md:w-1/2 min-h-[300px]"},Xt={class:"w-full md:w-1/2 p-4"},te={class:"flex-1"},ee={class:"text-right"},se={key:1,class:"p-4"},le={key:0,class:"text-center py-6 text-gray-500"},ne={key:1,class:"min-h-[300px]"},oe={key:2,class:"p-4"},ae={key:0,class:"text-center py-6 text-gray-500"},re={key:1,class:"min-h-[300px]"},ie={__name:"ChartsView",setup(_){ft.register(gt,ht,xt,_t,LinearScale,kt,$t,wt,St);const{getStocks:g,getRealizedTrades:D}=H(),d=T("allocation"),c=T([]),a=T([]),v=T({}),C=[{id:"allocation",name:"持股分配"},{id:"profit",name:"總體損益"},{id:"realized",name:"已實現收益趨勢"}],k=["#4CAF50","#2196F3","#F44336","#FF9800","#9C27B0","#3F51B5","#009688","#795548","#607D8B","#E91E63"],n=F(()=>c.value.length>0),r=F(()=>a.value.length>0),o=F(()=>n.value||r.value),h=F(()=>{if(!n.value)return[];const m=c.value.map(p=>{var w;const e=(((w=v.value[p.symbol])==null?void 0:w.price)||p.cost)*p.quantity;return{...p,marketValue:e}}),y=m.reduce((p,i)=>p+i.marketValue,0);return m.map(p=>({...p,percentage:p.marketValue/y*100})).sort((p,i)=>i.marketValue-p.marketValue)}),A=F(()=>n.value?{labels:h.value.map(m=>m.name),datasets:[{data:h.value.map(m=>m.marketValue),backgroundColor:h.value.map((m,y)=>k[y%k.length]),hoverOffset:4}]}:{datasets:[]}),q=F(()=>{const m=["未實現損益","已實現收益","總體損益"],y=c.value.reduce((w,l)=>{var z;const P=(((z=v.value[l.symbol])==null?void 0:z.price)||l.cost)*l.quantity,u=l.cost*l.quantity;return w+(P-u)},0),p=a.value.reduce((w,l)=>w+l.profit,0),i=y+p,e=[y,p,i];return{labels:m,datasets:[{label:"損益金額",data:e,backgroundColor:e.map(w=>w>=0?"rgba(76, 175, 80, 0.6)":"rgba(244, 67, 54, 0.6)"),borderColor:e.map(w=>w>=0?"rgb(76, 175, 80)":"rgb(244, 67, 54)"),borderWidth:1}]}}),$=F(()=>{if(!r.value)return{datasets:[]};const m=[...a.value].sort((e,w)=>new Date(e.date)-new Date(w.date));let y=0;const p=[],i=[];return m.forEach(e=>{y+=e.profit,p.push(y),i.push(ot(e.date).format("YYYY/MM/DD"))}),{labels:i,datasets:[{label:"累計已實現收益",data:p,borderColor:"rgb(54, 162, 235)",backgroundColor:"rgba(54, 162, 235, 0.5)",tension:.1,pointBackgroundColor:p.map(e=>e>=0?"rgb(76, 175, 80)":"rgb(244, 67, 54)")}]}}),O={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(m){const y=m.label||"",p=m.raw||0,i=p/m.dataset.data.reduce((e,w)=>e+w,0)*100;return`${y}: ${j(p)} (${i.toFixed(2)}%)`}}}}},I={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(m){return`${m.dataset.label}: ${j(m.raw)}`}}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(m){return j(m)}}}}},S={responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{callbacks:{label:function(m){return`${m.dataset.label}: ${j(m.raw)}`}}}},scales:{y:{ticks:{callback:function(m){return j(m)}}}}},j=m=>new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(m),L=()=>{c.value=g(),a.value=D();const m={};c.value.forEach(y=>{m[y.symbol]={price:y.cost,change:0,changePercent:0}}),v.value=m;try{const y=localStorage.getItem("investment-tracker-prices");y&&(v.value={...v.value,...JSON.parse(y)})}catch(y){console.error("無法讀取價格資料",y)}};return G(()=>{L(),window.addEventListener("storage",m=>{(m.key==="investment-tracker-stocks"||m.key==="investment-tracker-realized"||m.key==="investment-tracker-prices")&&L()})}),(m,y)=>(f(),x("div",null,[y[4]||(y[4]=t("h2",{class:"text-xl font-bold mb-4"},"圖表分析",-1)),t("div",Bt,[t("div",Yt,[(f(),x(Y,null,J(C,p=>t("button",{key:p.id,onClick:i=>d.value=p.id,class:E(["px-4 py-2 rounded-md transition-colors mb-2",d.value===p.id?"bg-primary text-white":"bg-gray-100 text-gray-700"])},b(p.name),11,Jt)),64))])]),t("div",Kt,[d.value==="allocation"?(f(),x("div",Ht,[y[1]||(y[1]=t("h3",{class:"text-lg font-medium mb-4"},"持股分配",-1)),n.value?(f(),x("div",Gt,[t("div",Qt,[W(U(Dt),{"chart-data":A.value,"chart-options":O},null,8,["chart-data"])]),t("div",Xt,[y[0]||(y[0]=t("h4",{class:"text-md font-medium mb-2"},"持股比例",-1)),(f(!0),x(Y,null,J(h.value,(p,i)=>(f(),x("div",{key:i,class:"flex items-center mb-2"},[t("div",{class:"w-4 h-4 rounded-full mr-2",style:Ct({backgroundColor:k[i%k.length]})},null,4),t("div",te,b(p.name)+" ("+b(p.symbol)+")",1),t("div",ee,b(p.percentage.toFixed(2))+"%",1)]))),128))])])):(f(),x("div",Zt," 尚未新增持股資料，請先在持股管理頁面新增股票。 "))])):M("",!0),d.value==="profit"?(f(),x("div",se,[y[2]||(y[2]=t("h3",{class:"text-lg font-medium mb-4"},"總體損益",-1)),o.value?(f(),x("div",ne,[W(U(Pt),{"chart-data":q.value,"chart-options":I},null,8,["chart-data"])])):(f(),x("div",le," 尚未有足夠資料，請先新增持股或已實現收益。 "))])):M("",!0),d.value==="realized"?(f(),x("div",oe,[y[3]||(y[3]=t("h3",{class:"text-lg font-medium mb-4"},"已實現收益分析",-1)),r.value?(f(),x("div",re,[W(U(Tt),{"chart-data":$.value,"chart-options":S},null,8,["chart-data"])])):(f(),x("div",ae," 尚未新增已實現收益資料，請先在已實現收益頁面新增資料。 "))])):M("",!0)])]))}},it="https://yahoo-finance-backend.vercel.app/";function ut(_){return _?_.includes(".")?_:/^\d+$/.test(_)?`${_}.TW`:_:""}async function ue(_){const g=ut(_),D=`${it}/api/stock/${g}`;console.log(`請求股票數據：${g}`);try{const d=await fetch(D,{headers:{Accept:"application/json","Cache-Control":"no-cache"}});if(!d.ok)throw console.warn(`API 請求失敗 (${g}): ${d.status} ${d.statusText}`),new Error(`API 請求失敗: ${d.status} ${d.statusText}`);const c=await d.json();if(c.error)throw new Error(`API 錯誤: ${c.error}`);return console.log(`成功獲取 ${g} 價格: ${c.price} ${c.currency}`),c}catch(d){throw console.error(`獲取 ${g} 價格失敗:`,d),d}}async function ce(_){const g=_.filter(d=>d&&d.trim());if(g.length===0)return[];const D=`${it}/api/stocks?symbols=${g.join(",")}`;console.log(`批量獲取股票數據: ${g.join(", ")}`);try{const d=await fetch(D,{headers:{Accept:"application/json","Cache-Control":"no-cache"}});if(!d.ok)throw console.warn(`批量API請求失敗: ${d.status} ${d.statusText}`),new Error(`批量API請求失敗: ${d.status} ${d.statusText}`);const c=await d.json();return console.log(`成功獲取 ${c.length} 支股票數據`),c}catch(d){console.error("批量獲取股票數據失敗:",d),console.log("嘗試逐個獲取股票數據...");const c=g.map(a=>ue(a).catch(v=>(console.error(`獲取 ${a} 數據失敗:`,v),{error:!0,errorMessage:v.message||"未知錯誤",symbol:ut(a),originalSymbol:a})));return Promise.all(c)}}function st(_,g,D=2){return _==null?"-":`${g==="TWD"?"NT$":"$"}${_.toFixed(D)}`}function lt(_){return _==null?"":_>0?"positive":_<0?"negative":""}const de={class:"card bg-white p-4 mb-6"},me={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},pe={class:"p-3 bg-gray-50 rounded-lg"},be={class:"text-lg font-semibold"},ve={class:"p-3 bg-gray-50 rounded-lg"},ye={class:"text-lg font-semibold"},fe={class:"p-3 bg-gray-50 rounded-lg"},ge={class:"text-sm"},he={class:"flex justify-between items-center mb-4"},xe={key:0,class:"inline-block animate-spin"},_e={class:"card"},ke={key:0,class:"text-center py-6 text-gray-500"},$e={key:1,class:"table-container"},we={class:"table"},Se={class:"flex space-x-2"},De=["onClick"],Ce=["onClick"],Pe={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},Te={class:"bg-white rounded-lg p-6 max-w-md w-full"},qe={class:"text-lg font-bold mb-4"},ze={class:"mb-4"},Fe={class:"mb-4"},Ve={class:"mb-4"},Ae={class:"mb-4"},Ie={class:"mb-4"},je={class:"mb-4"},Re={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},Oe={class:"bg-white rounded-lg p-6 max-w-md w-full"},Ee={class:"mb-4"},Me={class:"flex justify-end space-x-3"},Ne={__name:"HomeView",setup(_){const{getStocks:g,addStock:D,updateStock:d,deleteStock:c}=H(),a=T([]),v=T({}),C=T(!1),k=T(null),n=T(null),r=T(!1),o=at({symbol:"",name:"",market:"台股",cost:0,quantity:0,purchaseDate:new Date().toISOString().split("T")[0]}),h=F(()=>a.value.reduce((l,s)=>l+s.cost*s.quantity,0)),A=F(()=>a.value.reduce((l,s)=>{var u;const P=((u=v.value[s.symbol])==null?void 0:u.price)||0;return l+P*s.quantity},0)),q=F(()=>A.value-h.value),$=F(()=>h.value===0?0:q.value/h.value*100),O=()=>{a.value=g(),a.value.length>0&&I()},I=async()=>{if(a.value.length!==0){r.value=!0;try{const l=a.value.map(u=>u.symbol),s=await ce(l),P={};s.forEach(u=>{P[u.symbol]=u}),v.value=P}catch(l){console.error("更新價格出錯",l)}finally{r.value=!1}}},S=l=>{const s=a.value[l];k.value=l,o.symbol=s.symbol,o.name=s.name,o.market=s.market,o.cost=s.cost,o.quantity=s.quantity,o.purchaseDate=s.purchaseDate||"",C.value=!0},j=l=>{n.value=l},L=()=>{n.value!==null&&(c(n.value),O(),n.value=null)},m=()=>{const l={symbol:o.symbol,name:o.name,market:o.market,cost:o.cost,quantity:o.quantity,purchaseDate:o.purchaseDate};k.value!==null?d(k.value,l):D(l),O(),k.value=null,C.value=!1,p()},y=()=>{C.value=!1,k.value=null,p()},p=()=>{o.symbol="",o.name="",o.market="台股",o.cost=0,o.quantity=0,o.purchaseDate=new Date().toISOString().split("T")[0]},i=l=>new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(l),e=(l,s)=>{if(!s)return"載入中...";const P=l.cost*l.quantity,z=s*l.quantity-P,K=P>0?z/P*100:0,B=z>=0?"+":"";return`${B}${i(z)} (${B}${K.toFixed(2)}%)`},w=(l,s)=>{if(!s)return"";const P=l.cost*l.quantity,z=s*l.quantity-P;return z>0?"positive":z<0?"negative":""};return G(()=>{O();const l=setInterval(I,5*60*1e3);return()=>clearInterval(l)}),(l,s)=>{var P;return f(),x("div",null,[s[23]||(s[23]=t("h2",{class:"text-xl font-bold mb-4"},"持股管理",-1)),t("div",de,[t("div",me,[t("div",pe,[s[9]||(s[9]=t("h3",{class:"text-gray-500 text-sm"},"總投資成本",-1)),t("p",be,b(i(h.value)),1)]),t("div",ve,[s[10]||(s[10]=t("h3",{class:"text-gray-500 text-sm"},"目前總市值",-1)),t("p",ye,b(i(A.value)),1)]),t("div",fe,[s[11]||(s[11]=t("h3",{class:"text-gray-500 text-sm"},"未實現損益",-1)),t("p",{class:E(["text-lg font-semibold",U(lt)(q.value)])},[nt(b(q.value>0?"+":"")+b(i(q.value))+" ",1),t("span",ge," ("+b($.value>0?"+":"")+b($.value.toFixed(2))+"%) ",1)],2)])])]),t("div",he,[t("button",{onClick:s[0]||(s[0]=u=>C.value=!0),class:"btn btn-primary"}," + 新增持股 "),t("button",{onClick:I,class:"btn bg-gray-100 text-gray-700 flex items-center"},[s[12]||(s[12]=t("span",{class:"mr-1"},"更新價格",-1)),r.value?(f(),x("span",xe,"⟳")):M("",!0)])]),t("div",_e,[a.value.length===0?(f(),x("div",ke," 尚未新增持股資料，請點擊「新增持股」按鈕開始追蹤。 ")):(f(),x("div",$e,[t("table",we,[s[13]||(s[13]=t("thead",null,[t("tr",null,[t("th",null,"代碼"),t("th",null,"名稱"),t("th",null,"市場"),t("th",null,"持有股數"),t("th",null,"成本價"),t("th",null,"目前價格"),t("th",null,"市值"),t("th",null,"損益"),t("th",null,"操作")])],-1)),t("tbody",null,[(f(!0),x(Y,null,J(a.value,(u,z)=>{var K,B,Q;return f(),x("tr",{key:z},[t("td",null,b(u.symbol),1),t("td",null,b(u.name),1),t("td",null,b(u.market),1),t("td",null,b(u.quantity),1),t("td",null,b(U(st)(u.cost)),1),t("td",{class:E(U(lt)((K=v.value[u.symbol])==null?void 0:K.change))},b(v.value[u.symbol]?U(st)(v.value[u.symbol].price):"載入中..."),3),t("td",null,b(v.value[u.symbol]?i(u.quantity*v.value[u.symbol].price):"載入中..."),1),t("td",{class:E(w(u,(B=v.value[u.symbol])==null?void 0:B.price))},b(e(u,(Q=v.value[u.symbol])==null?void 0:Q.price)),3),t("td",null,[t("div",Se,[t("button",{onClick:dt=>S(z),class:"text-primary text-sm"}," 編輯 ",8,De),t("button",{onClick:dt=>j(z),class:"text-danger text-sm"}," 刪除 ",8,Ce)])])])}),128))])])]))]),C.value?(f(),x("div",Pe,[t("div",Te,[t("h3",qe,b(k.value===null?"新增持股":"編輯持股"),1),t("form",{onSubmit:rt(m,["prevent"])},[t("div",ze,[s[14]||(s[14]=t("label",{class:"block text-sm font-medium mb-1"},"股票代碼",-1)),V(t("input",{"onUpdate:modelValue":s[1]||(s[1]=u=>o.symbol=u),required:"",class:"input w-full",placeholder:"例如：2330.TW 或 AAPL"},null,512),[[R,o.symbol]])]),t("div",Fe,[s[15]||(s[15]=t("label",{class:"block text-sm font-medium mb-1"},"股票名稱",-1)),V(t("input",{"onUpdate:modelValue":s[2]||(s[2]=u=>o.name=u),required:"",class:"input w-full",placeholder:"例如：台積電 或 蘋果"},null,512),[[R,o.name]])]),t("div",Ve,[s[17]||(s[17]=t("label",{class:"block text-sm font-medium mb-1"},"市場",-1)),V(t("select",{"onUpdate:modelValue":s[3]||(s[3]=u=>o.market=u),required:"",class:"input w-full"},s[16]||(s[16]=[t("option",{value:"台股"},"台股",-1),t("option",{value:"美股"},"美股",-1),t("option",{value:"其他"},"其他",-1)]),512),[[qt,o.market]])]),t("div",Ae,[s[18]||(s[18]=t("label",{class:"block text-sm font-medium mb-1"},"成本價",-1)),V(t("input",{"onUpdate:modelValue":s[4]||(s[4]=u=>o.cost=u),type:"number",step:"0.01",required:"",class:"input w-full",placeholder:"每股成本"},null,512),[[R,o.cost,void 0,{number:!0}]])]),t("div",Ie,[s[19]||(s[19]=t("label",{class:"block text-sm font-medium mb-1"},"持有股數",-1)),V(t("input",{"onUpdate:modelValue":s[5]||(s[5]=u=>o.quantity=u),type:"number",required:"",class:"input w-full",placeholder:"持有數量"},null,512),[[R,o.quantity,void 0,{number:!0}]])]),t("div",je,[s[20]||(s[20]=t("label",{class:"block text-sm font-medium mb-1"},"購買日期",-1)),V(t("input",{"onUpdate:modelValue":s[6]||(s[6]=u=>o.purchaseDate=u),type:"date",class:"input w-full"},null,512),[[R,o.purchaseDate]])]),t("div",{class:"flex justify-end space-x-3"},[t("button",{type:"button",onClick:y,class:"btn bg-gray-200 text-gray-800"}," 取消 "),s[21]||(s[21]=t("button",{type:"submit",class:"btn btn-primary"},"儲存",-1))])],32)])])):M("",!0),n.value!==null?(f(),x("div",Re,[t("div",Oe,[s[22]||(s[22]=t("h3",{class:"text-lg font-bold mb-4"},"確認刪除",-1)),t("p",Ee," 確定要刪除「"+b((P=a.value[n.value])==null?void 0:P.name)+"」的持股資料嗎？ ",1),t("div",Me,[t("button",{onClick:s[7]||(s[7]=u=>n.value=null),class:"btn bg-gray-200 text-gray-800"}," 取消 "),t("button",{onClick:s[8]||(s[8]=u=>L()),class:"btn btn-danger"}," 確認刪除 ")])])])):M("",!0)])}}},Ue={class:"card bg-white p-4 mb-6"},Le={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},We={class:"p-3 bg-gray-50 rounded-lg"},Be={class:"p-3 bg-gray-50 rounded-lg"},Ye={class:"text-lg font-semibold"},Je={class:"flex justify-between items-center mb-4"},Ke={class:"card"},He={key:0,class:"text-center py-6 text-gray-500"},Ze={key:1,class:"table-container"},Ge={class:"table"},Qe={class:"flex space-x-2"},Xe=["onClick"],ts=["onClick"],es={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},ss={class:"bg-white rounded-lg p-6 max-w-md w-full"},ls={class:"text-lg font-bold mb-4"},ns={class:"mb-4"},os={class:"mb-4"},as={class:"mb-4"},rs={class:"mb-4"},is={class:"mb-4"},us={class:"mb-4"},cs=["value"],ds={class:"mb-4"},ms={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},ps={class:"bg-white rounded-lg p-6 max-w-md w-full"},bs={class:"mb-4"},vs={class:"flex justify-end space-x-3"},ys={__name:"RealizedView",setup(_){const{getRealizedTrades:g,addRealizedTrade:D,updateRealizedTrade:d,deleteRealizedTrade:c}=H(),a=T([]),v=T(!1),C=T(null),k=T(null),n=at({symbol:"",name:"",sellPrice:0,quantity:0,buyPrice:0,date:new Date().toISOString().split("T")[0]}),r=F(()=>a.value.reduce((i,e)=>i+e.profit,0)),o=F(()=>[...a.value].sort((i,e)=>new Date(e.date)-new Date(i.date))),h=()=>{a.value=g()},A=i=>{const e=a.value[i];C.value=i,n.symbol=e.symbol,n.name=e.name,n.sellPrice=e.sellPrice,n.quantity=e.quantity,n.buyPrice=e.cost/e.quantity||0,n.date=e.date,v.value=!0},q=i=>{k.value=i},$=()=>{k.value!==null&&(c(k.value),h(),k.value=null)},O=()=>{const i=p(),w=n.sellPrice*n.quantity-i,l={symbol:n.symbol,name:n.name,sellPrice:n.sellPrice,quantity:n.quantity,cost:i,profit:w,date:n.date};C.value!==null?d(C.value,l):D(l),h(),C.value=null,v.value=!1,S()},I=()=>{v.value=!1,C.value=null,S()},S=()=>{n.symbol="",n.name="",n.sellPrice=0,n.quantity=0,n.buyPrice=0,n.date=new Date().toISOString().split("T")[0]},j=i=>new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(i),L=i=>i.toFixed(2),m=i=>ot(i).format("YYYY/MM/DD"),y=i=>{if(i.cost===0)return"0.00%";const e=i.profit/i.cost*100;return`${e>=0?"+":""}${e.toFixed(2)}%`},p=()=>n.buyPrice*n.quantity;return G(()=>{h()}),(i,e)=>{var w;return f(),x("div",null,[e[21]||(e[21]=t("h2",{class:"text-xl font-bold mb-4"},"已實現收益",-1)),t("div",Ue,[t("div",Le,[t("div",We,[e[9]||(e[9]=t("h3",{class:"text-gray-500 text-sm"},"總實現收益",-1)),t("p",{class:E(["text-lg font-semibold",r.value>=0?"positive":"negative"])},b(r.value>0?"+":"")+b(j(r.value)),3)]),t("div",Be,[e[10]||(e[10]=t("h3",{class:"text-gray-500 text-sm"},"總交易次數",-1)),t("p",Ye,b(a.value.length)+" 次",1)])])]),t("div",Je,[t("button",{onClick:e[0]||(e[0]=l=>v.value=!0),class:"btn btn-primary"}," + 新增已實現收益 ")]),t("div",Ke,[a.value.length===0?(f(),x("div",He," 尚未新增已實現收益資料，請點擊「新增已實現收益」按鈕進行新增。 ")):(f(),x("div",Ze,[t("table",Ge,[e[11]||(e[11]=t("thead",null,[t("tr",null,[t("th",null,"日期"),t("th",null,"代碼"),t("th",null,"名稱"),t("th",null,"賣出價格"),t("th",null,"數量"),t("th",null,"總成本"),t("th",null,"實現損益"),t("th",null,"報酬率"),t("th",null,"操作")])],-1)),t("tbody",null,[(f(!0),x(Y,null,J(o.value,(l,s)=>(f(),x("tr",{key:s},[t("td",null,b(m(l.date)),1),t("td",null,b(l.symbol),1),t("td",null,b(l.name),1),t("td",null,b(L(l.sellPrice)),1),t("td",null,b(l.quantity),1),t("td",null,b(j(l.cost)),1),t("td",{class:E(l.profit>=0?"positive":"negative")},b(l.profit>0?"+":"")+b(j(l.profit)),3),t("td",{class:E(l.profit>=0?"positive":"negative")},b(y(l)),3),t("td",null,[t("div",Qe,[t("button",{onClick:P=>A(s),class:"text-primary text-sm"}," 編輯 ",8,Xe),t("button",{onClick:P=>q(s),class:"text-danger text-sm"}," 刪除 ",8,ts)])])]))),128))])])]))]),v.value?(f(),x("div",es,[t("div",ss,[t("h3",ls,b(C.value===null?"新增已實現收益":"編輯已實現收益"),1),t("form",{onSubmit:rt(O,["prevent"])},[t("div",ns,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium mb-1"},"股票代碼",-1)),V(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>n.symbol=l),required:"",class:"input w-full",placeholder:"例如：2330.TW 或 AAPL"},null,512),[[R,n.symbol]])]),t("div",os,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium mb-1"},"股票名稱",-1)),V(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>n.name=l),required:"",class:"input w-full",placeholder:"例如：台積電 或 蘋果"},null,512),[[R,n.name]])]),t("div",as,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium mb-1"},"賣出價格",-1)),V(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>n.sellPrice=l),type:"number",step:"0.01",required:"",class:"input w-full",placeholder:"每股賣出價格"},null,512),[[R,n.sellPrice,void 0,{number:!0}]])]),t("div",rs,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium mb-1"},"數量",-1)),V(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>n.quantity=l),type:"number",required:"",class:"input w-full",placeholder:"賣出數量"},null,512),[[R,n.quantity,void 0,{number:!0}]])]),t("div",is,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium mb-1"},"買入價格",-1)),V(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>n.buyPrice=l),type:"number",step:"0.01",required:"",class:"input w-full",placeholder:"每股買入價格"},null,512),[[R,n.buyPrice,void 0,{number:!0}]])]),t("div",us,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium mb-1"},"總成本",-1)),t("input",{value:p(),type:"number",step:"0.01",disabled:"",class:"input w-full bg-gray-100"},null,8,cs)]),t("div",ds,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium mb-1"},"賣出日期",-1)),V(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>n.date=l),type:"date",required:"",class:"input w-full"},null,512),[[R,n.date]])]),t("div",{class:"flex justify-end space-x-3"},[t("button",{type:"button",onClick:I,class:"btn bg-gray-200 text-gray-800"}," 取消 "),e[19]||(e[19]=t("button",{type:"submit",class:"btn btn-primary"},"儲存",-1))])],32)])])):M("",!0),k.value!==null?(f(),x("div",ms,[t("div",ps,[e[20]||(e[20]=t("h3",{class:"text-lg font-bold mb-4"},"確認刪除",-1)),t("p",bs," 確定要刪除「"+b((w=a.value[k.value])==null?void 0:w.name)+"」的已實現收益資料嗎？ ",1),t("div",vs,[t("button",{onClick:e[7]||(e[7]=l=>k.value=null),class:"btn bg-gray-200 text-gray-800"}," 取消 "),t("button",{onClick:e[8]||(e[8]=l=>$()),class:"btn btn-danger"}," 確認刪除 ")])])])):M("",!0)])}}},fs=[{path:"/",component:Ne},{path:"/realized",component:ys},{path:"/charts",component:ie}],gs=zt({history:Ft(),routes:fs}),ct=Vt(Wt);ct.use(gs);ct.mount("#app");
