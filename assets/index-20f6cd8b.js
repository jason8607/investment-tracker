import{r as tt,o as y,c as h,a as t,F as Y,b as J,d as W,w as Z,t as b,u as M,e as pt,f as bt,g as ot,n as E,T as vt,h as yt,i as ft,C as gt,A as ht,p as xt,j as _t,k as kt,B as $t,P as wt,L as St,l as Dt,m as q,q as F,s as Q,v as U,x as N,y as at,z as Ct,D as Pt,E as Tt,G as qt,H as rt,I as it,J as ut,K as V,M as O,N as zt,O as Ft,Q as Vt,R as It}from"./vendor-d115be86.js";(function(){const _=document.createElement("link").relList;if(_&&_.supports&&_.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))S(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&S(d)}).observe(document,{childList:!0,subtree:!0});function C(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function S(a){if(a.ep)return;a.ep=!0;const r=C(a);fetch(a.href,r)}})();const et="investment-tracker-stocks",st="investment-tracker-realized";function H(){const f=()=>{try{const u=localStorage.getItem(et);return u?JSON.parse(u):[]}catch(u){return console.error("無法讀取持股資料",u),[]}},_=u=>{try{localStorage.setItem(et,JSON.stringify(u))}catch(o){console.error("無法儲存持股資料",o)}},C=u=>{const o=f();o.push(u),_(o)},S=(u,o)=>{const g=f();g[u]=o,_(g)},a=u=>{const o=f();o.splice(u,1),_(o)},r=()=>{try{const u=localStorage.getItem(st);return u?JSON.parse(u):[]}catch(u){return console.error("無法讀取已實現收益資料",u),[]}},d=u=>{try{localStorage.setItem(st,JSON.stringify(u))}catch(o){console.error("無法儲存已實現收益資料",o)}};return{getStocks:f,setStocks:_,addStock:C,updateStock:S,deleteStock:a,getRealizedTrades:r,setRealizedTrades:d,addRealizedTrade:u=>{const o=r();o.push(u),d(o)},updateRealizedTrade:(u,o)=>{const g=r();g[u]=o,d(g)},deleteRealizedTrade:u=>{const o=r();o.splice(u,1),d(o)}}}const At={class:"min-h-screen"},Rt={class:"bg-primary text-white p-4 shadow-md"},Ot={class:"container mx-auto flex justify-between items-center"},jt={class:"flex space-x-2"},Et={class:"btn bg-secondary text-white text-sm px-3 py-1 cursor-pointer"},Nt={class:"bg-white shadow-sm"},Mt={class:"container mx-auto"},Ut={class:"flex"},Lt={class:"container mx-auto p-4"},Wt={class:"bg-gray-100 text-gray-600 p-4 text-center text-sm"},Bt={__name:"App",setup(f){const{getStocks:_,getRealizedTrades:C,setStocks:S,setRealizedTrades:a}=H(),r=[{name:"持股管理",path:"/"},{name:"已實現收益",path:"/realized"},{name:"圖表分析",path:"/charts"}],d=()=>{const x=M.book_new(),n=_(),u=C(),o=n.map(k=>({股票代碼:k.symbol,股票名稱:k.name,市場:k.market,成本價:k.cost,數量:k.quantity,購買日期:k.purchaseDate})),g=u.map(k=>({股票代碼:k.symbol,股票名稱:k.name,賣出價格:k.sellPrice,數量:k.quantity,成本:k.cost,實現損益:k.profit,日期:k.date})),I=M.json_to_sheet(o),z=M.json_to_sheet(g);M.book_append_sheet(x,I,"持股紀錄"),M.book_append_sheet(x,z,"已實現收益"),pt(x,"投資損益資料.xlsx")},$=x=>{const n=x.target.files[0];if(!n)return;const u=new FileReader;u.onload=o=>{const g=new Uint8Array(o.target.result),I=bt(g,{type:"array"}),z=I.Sheets.持股紀錄;if(z){const A=M.sheet_to_json(z).map(D=>({symbol:D.股票代碼,name:D.股票名稱,market:D.市場,cost:parseFloat(D.成本價),quantity:parseInt(D.數量),purchaseDate:D.購買日期}));S(A)}const k=I.Sheets.已實現收益;if(k){const A=M.sheet_to_json(k).map(D=>({symbol:D.股票代碼,name:D.股票名稱,sellPrice:parseFloat(D.賣出價格),quantity:parseInt(D.數量),cost:parseFloat(D.成本),profit:parseFloat(D.實現損益),date:D.日期}));a(A)}x.target.value="",alert("資料匯入成功！")},u.readAsArrayBuffer(n)};return(x,n)=>{const u=tt("router-link"),o=tt("router-view");return y(),h("div",At,[t("header",Rt,[t("div",Ot,[n[3]||(n[3]=t("h1",{class:"text-xl md:text-2xl font-bold"},"投資損益小幫手",-1)),t("div",jt,[t("button",{onClick:d,class:"btn bg-secondary text-white text-sm px-3 py-1"},n[0]||(n[0]=[t("span",{class:"hidden md:inline"},"匯出資料",-1),t("span",{class:"md:hidden"},"匯出",-1)])),t("label",Et,[n[1]||(n[1]=t("span",{class:"hidden md:inline"},"匯入資料",-1)),n[2]||(n[2]=t("span",{class:"md:hidden"},"匯入",-1)),t("input",{type:"file",accept:".xlsx",class:"hidden",onChange:$},null,32)])])])]),t("nav",Nt,[t("div",Mt,[t("ul",Ut,[(y(),h(Y,null,J(r,g=>t("li",{key:g.path},[W(u,{to:g.path,class:E(["block px-4 py-3 hover:bg-gray-100 transition-colors border-b-2",x.$route.path===g.path?"border-primary text-primary font-medium":"border-transparent"])},{default:Z(()=>[ot(b(g.name),1)]),_:2},1032,["to","class"])])),64))])])]),t("main",Lt,[W(o,null,{default:Z(({Component:g})=>[W(vt,{name:"fade",mode:"out-in"},{default:Z(()=>[(y(),yt(ft(g)))]),_:2},1024)]),_:1})]),t("footer",Wt,[t("p",null,"投資損益小幫手 © "+b(new Date().getFullYear()),1)])])}}};const Yt={class:"mb-6"},Jt={class:"flex flex-wrap space-x-2"},Kt=["onClick"],Ht={class:"card"},Zt={key:0,class:"p-4"},Gt={key:0,class:"text-center py-6 text-gray-500"},Qt={key:1,class:"flex flex-col md:flex-row"},Xt={class:"w-full md:w-1/2 min-h-[300px]"},te={class:"w-full md:w-1/2 p-4"},ee={class:"flex-1"},se={class:"text-right"},le={key:1,class:"p-4"},ne={key:0,class:"text-center py-6 text-gray-500"},oe={key:1,class:"min-h-[300px]"},ae={key:2,class:"p-4"},re={key:0,class:"text-center py-6 text-gray-500"},ie={key:1,class:"min-h-[300px]"},ue={__name:"ChartsView",setup(f){gt.register(ht,xt,_t,kt,LinearScale,$t,wt,St,Dt);const{getStocks:_,getRealizedTrades:C}=H(),S=q("allocation"),a=q([]),r=q([]),d=q({}),$=[{id:"allocation",name:"持股分配"},{id:"profit",name:"總體損益"},{id:"realized",name:"已實現收益趨勢"}],x=["#4CAF50","#2196F3","#F44336","#FF9800","#9C27B0","#3F51B5","#009688","#795548","#607D8B","#E91E63"],n=F(()=>a.value.length>0),u=F(()=>r.value.length>0),o=F(()=>n.value||u.value),g=F(()=>{if(!n.value)return[];const m=a.value.map(p=>{var w;const e=(((w=d.value[p.symbol])==null?void 0:w.price)||p.cost)*p.quantity;return{...p,marketValue:e}}),v=m.reduce((p,c)=>p+c.marketValue,0);return m.map(p=>({...p,percentage:p.marketValue/v*100})).sort((p,c)=>c.marketValue-p.marketValue)}),I=F(()=>n.value?{labels:g.value.map(m=>m.name),datasets:[{data:g.value.map(m=>m.marketValue),backgroundColor:g.value.map((m,v)=>x[v%x.length]),hoverOffset:4}]}:{datasets:[]}),z=F(()=>{const m=["未實現損益","已實現收益","總體損益"],v=a.value.reduce((w,l)=>{var T;const P=(((T=d.value[l.symbol])==null?void 0:T.price)||l.cost)*l.quantity,i=l.cost*l.quantity;return w+(P-i)},0),p=r.value.reduce((w,l)=>w+l.profit,0),c=v+p,e=[v,p,c];return{labels:m,datasets:[{label:"損益金額",data:e,backgroundColor:e.map(w=>w>=0?"rgba(76, 175, 80, 0.6)":"rgba(244, 67, 54, 0.6)"),borderColor:e.map(w=>w>=0?"rgb(76, 175, 80)":"rgb(244, 67, 54)"),borderWidth:1}]}}),k=F(()=>{if(!u.value)return{datasets:[]};const m=[...r.value].sort((e,w)=>new Date(e.date)-new Date(w.date));let v=0;const p=[],c=[];return m.forEach(e=>{v+=e.profit,p.push(v),c.push(at(e.date).format("YYYY/MM/DD"))}),{labels:c,datasets:[{label:"累計已實現收益",data:p,borderColor:"rgb(54, 162, 235)",backgroundColor:"rgba(54, 162, 235, 0.5)",tension:.1,pointBackgroundColor:p.map(e=>e>=0?"rgb(76, 175, 80)":"rgb(244, 67, 54)")}]}}),j={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(m){const v=m.label||"",p=m.raw||0,c=p/m.dataset.data.reduce((e,w)=>e+w,0)*100;return`${v}: ${R(p)} (${c.toFixed(2)}%)`}}}}},A={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(m){return`${m.dataset.label}: ${R(m.raw)}`}}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(m){return R(m)}}}}},D={responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{callbacks:{label:function(m){return`${m.dataset.label}: ${R(m.raw)}`}}}},scales:{y:{ticks:{callback:function(m){return R(m)}}}}},R=m=>new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(m),L=()=>{a.value=_(),r.value=C();const m={};a.value.forEach(v=>{m[v.symbol]={price:v.cost,change:0,changePercent:0}}),d.value=m;try{const v=localStorage.getItem("investment-tracker-prices");v&&(d.value={...d.value,...JSON.parse(v)})}catch(v){console.error("無法讀取價格資料",v)}};return Q(()=>{L(),window.addEventListener("storage",m=>{(m.key==="investment-tracker-stocks"||m.key==="investment-tracker-realized"||m.key==="investment-tracker-prices")&&L()})}),(m,v)=>(y(),h("div",null,[v[4]||(v[4]=t("h2",{class:"text-xl font-bold mb-4"},"圖表分析",-1)),t("div",Yt,[t("div",Jt,[(y(),h(Y,null,J($,p=>t("button",{key:p.id,onClick:c=>S.value=p.id,class:E(["px-4 py-2 rounded-md transition-colors mb-2",S.value===p.id?"bg-primary text-white":"bg-gray-100 text-gray-700"])},b(p.name),11,Kt)),64))])]),t("div",Ht,[S.value==="allocation"?(y(),h("div",Zt,[v[1]||(v[1]=t("h3",{class:"text-lg font-medium mb-4"},"持股分配",-1)),n.value?(y(),h("div",Qt,[t("div",Xt,[W(U(Ct),{"chart-data":I.value,"chart-options":j},null,8,["chart-data"])]),t("div",te,[v[0]||(v[0]=t("h4",{class:"text-md font-medium mb-2"},"持股比例",-1)),(y(!0),h(Y,null,J(g.value,(p,c)=>(y(),h("div",{key:c,class:"flex items-center mb-2"},[t("div",{class:"w-4 h-4 rounded-full mr-2",style:Pt({backgroundColor:x[c%x.length]})},null,4),t("div",ee,b(p.name)+" ("+b(p.symbol)+")",1),t("div",se,b(p.percentage.toFixed(2))+"%",1)]))),128))])])):(y(),h("div",Gt," 尚未新增持股資料，請先在持股管理頁面新增股票。 "))])):N("",!0),S.value==="profit"?(y(),h("div",le,[v[2]||(v[2]=t("h3",{class:"text-lg font-medium mb-4"},"總體損益",-1)),o.value?(y(),h("div",oe,[W(U(Tt),{"chart-data":z.value,"chart-options":A},null,8,["chart-data"])])):(y(),h("div",ne," 尚未有足夠資料，請先新增持股或已實現收益。 "))])):N("",!0),S.value==="realized"?(y(),h("div",ae,[v[3]||(v[3]=t("h3",{class:"text-lg font-medium mb-4"},"已實現收益分析",-1)),u.value?(y(),h("div",ie,[W(U(qt),{"chart-data":k.value,"chart-options":D},null,8,["chart-data"])])):(y(),h("div",re," 尚未新增已實現收益資料，請先在已實現收益頁面新增資料。 "))])):N("",!0)])]))}},ct="https://yahoo-finance-backend.vercel.app";function G(f){return f?f.includes(".")?f:/^\d+$/.test(f)?`${f}.TW`:f:""}async function ce(f){const _=f,C=G(f),S=`${ct}/api/stock/${C}`;console.log(`請求股票數據：${C}`);try{const a=await rt.get(S,{headers:{Accept:"application/json","Cache-Control":"no-cache"},timeout:1e4});if(a.data.error)throw new Error(`API 錯誤: ${a.data.error}`);return console.log(`成功獲取 ${C} 價格: ${a.data.price} ${a.data.currency}`),{...a.data,originalSymbol:_}}catch(a){throw console.error(`獲取 ${C} 價格失敗:`,a),a.response?new Error(`API 請求失敗: ${a.response.status} ${a.response.statusText}`):a.request?new Error("無法連接到服務器，請檢查網絡連接"):a}}async function de(f){const _=f.filter(a=>a&&a.trim());if(_.length===0)return[];const C=_.map(a=>G(a)),S=`${ct}/api/stocks?symbols=${C.join(",")}`;console.log(`批量獲取股票數據: ${_.join(", ")}`);try{const a=await rt.get(S,{headers:{Accept:"application/json","Cache-Control":"no-cache"},timeout:15e3});return console.log(`成功獲取 ${a.data.length} 支股票數據`),a.data.map((d,$)=>(d.originalSymbol||(d.originalSymbol=_[$]),d))}catch(a){console.error("批量獲取股票數據失敗:",a),console.log("嘗試逐個獲取股票數據...");const r=_.map(d=>ce(d).catch($=>(console.error(`獲取 ${d} 數據失敗:`,$),{error:!0,errorMessage:$.message||"未知錯誤",symbol:G(d),originalSymbol:d})));return Promise.all(r)}}function lt(f,_,C=2){return f==null?"-":`${_==="TWD"?"NT$":"$"}${f.toFixed(C)}`}function nt(f){return f==null?"":f>0?"positive":f<0?"negative":""}const me={class:"card bg-white p-4 mb-6"},pe={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},be={class:"p-3 bg-gray-50 rounded-lg"},ve={class:"text-lg font-semibold"},ye={class:"p-3 bg-gray-50 rounded-lg"},fe={class:"text-lg font-semibold"},ge={class:"p-3 bg-gray-50 rounded-lg"},he={class:"text-sm"},xe={class:"flex justify-between items-center mb-4"},_e={key:0,class:"inline-block animate-spin"},ke={class:"card"},$e={key:0,class:"text-center py-6 text-gray-500"},we={key:1,class:"table-container"},Se={class:"table"},De={class:"flex space-x-2"},Ce=["onClick"],Pe=["onClick"],Te={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},qe={class:"bg-white rounded-lg p-6 max-w-md w-full"},ze={class:"text-lg font-bold mb-4"},Fe={class:"mb-4"},Ve={class:"mb-4"},Ie={class:"mb-4"},Ae={class:"mb-4"},Re={class:"mb-4"},Oe={class:"mb-4"},je={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},Ee={class:"bg-white rounded-lg p-6 max-w-md w-full"},Ne={class:"mb-4"},Me={class:"flex justify-end space-x-3"},Ue={__name:"HomeView",setup(f){const{getStocks:_,addStock:C,updateStock:S,deleteStock:a}=H(),r=q([]),d=q({}),$=q(!1),x=q(null),n=q(null),u=q(!1),o=it({symbol:"",name:"",market:"台股",cost:0,quantity:0,purchaseDate:new Date().toISOString().split("T")[0]}),g=F(()=>r.value.reduce((l,s)=>l+s.cost*s.quantity,0)),I=F(()=>r.value.reduce((l,s)=>{var i;const P=((i=d.value[s.symbol])==null?void 0:i.price)||0;return l+P*s.quantity},0)),z=F(()=>I.value-g.value),k=F(()=>g.value===0?0:z.value/g.value*100),j=()=>{r.value=_(),r.value.length>0&&A()},A=async()=>{if(r.value.length!==0){u.value=!0;try{const l=r.value.map(i=>i.symbol),s=await de(l),P={};s.forEach(i=>{const T=i.originalSymbol||i.symbol;P[T]=i}),d.value=P;try{localStorage.setItem("investment-tracker-prices",JSON.stringify(P))}catch(i){console.error("無法儲存價格資料到本地存儲",i)}}catch(l){console.error("更新價格出錯",l)}finally{u.value=!1}}},D=l=>{const s=r.value[l];x.value=l,o.symbol=s.symbol,o.name=s.name,o.market=s.market,o.cost=s.cost,o.quantity=s.quantity,o.purchaseDate=s.purchaseDate||"",$.value=!0},R=l=>{n.value=l},L=()=>{n.value!==null&&(a(n.value),j(),n.value=null)},m=()=>{const l={symbol:o.symbol,name:o.name,market:o.market,cost:o.cost,quantity:o.quantity,purchaseDate:o.purchaseDate};x.value!==null?S(x.value,l):C(l),j(),x.value=null,$.value=!1,p()},v=()=>{$.value=!1,x.value=null,p()},p=()=>{o.symbol="",o.name="",o.market="台股",o.cost=0,o.quantity=0,o.purchaseDate=new Date().toISOString().split("T")[0]},c=l=>new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(l),e=(l,s)=>{if(!s)return"載入中...";const P=l.cost*l.quantity,T=s*l.quantity-P,K=P>0?T/P*100:0,B=T>=0?"+":"";return`${B}${c(T)} (${B}${K.toFixed(2)}%)`},w=(l,s)=>{if(!s)return"";const P=l.cost*l.quantity,T=s*l.quantity-P;return T>0?"positive":T<0?"negative":""};return Q(()=>{j();const l=setInterval(A,5*60*1e3);return()=>clearInterval(l)}),(l,s)=>{var P;return y(),h("div",null,[s[23]||(s[23]=t("h2",{class:"text-xl font-bold mb-4"},"持股管理",-1)),t("div",me,[t("div",pe,[t("div",be,[s[9]||(s[9]=t("h3",{class:"text-gray-500 text-sm"},"總投資成本",-1)),t("p",ve,b(c(g.value)),1)]),t("div",ye,[s[10]||(s[10]=t("h3",{class:"text-gray-500 text-sm"},"目前總市值",-1)),t("p",fe,b(c(I.value)),1)]),t("div",ge,[s[11]||(s[11]=t("h3",{class:"text-gray-500 text-sm"},"未實現損益",-1)),t("p",{class:E(["text-lg font-semibold",U(nt)(z.value)])},[ot(b(z.value>0?"+":"")+b(c(z.value))+" ",1),t("span",he," ("+b(k.value>0?"+":"")+b(k.value.toFixed(2))+"%) ",1)],2)])])]),t("div",xe,[t("button",{onClick:s[0]||(s[0]=i=>$.value=!0),class:"btn btn-primary"}," + 新增持股 "),t("button",{onClick:A,class:"btn bg-gray-100 text-gray-700 flex items-center"},[s[12]||(s[12]=t("span",{class:"mr-1"},"更新價格",-1)),u.value?(y(),h("span",_e,"⟳")):N("",!0)])]),t("div",ke,[r.value.length===0?(y(),h("div",$e," 尚未新增持股資料，請點擊「新增持股」按鈕開始追蹤。 ")):(y(),h("div",we,[t("table",Se,[s[13]||(s[13]=t("thead",null,[t("tr",null,[t("th",null,"代碼"),t("th",null,"名稱"),t("th",null,"市場"),t("th",null,"持有股數"),t("th",null,"成本價"),t("th",null,"目前價格"),t("th",null,"市值"),t("th",null,"損益"),t("th",null,"操作")])],-1)),t("tbody",null,[(y(!0),h(Y,null,J(r.value,(i,T)=>{var K,B,X;return y(),h("tr",{key:T},[t("td",null,b(i.symbol),1),t("td",null,b(i.name),1),t("td",null,b(i.market),1),t("td",null,b(i.quantity),1),t("td",null,b(U(lt)(i.cost)),1),t("td",{class:E(U(nt)((K=d.value[i.symbol])==null?void 0:K.change))},b(d.value[i.symbol]?U(lt)(d.value[i.symbol].price):"載入中..."),3),t("td",null,b(d.value[i.symbol]?c(i.quantity*d.value[i.symbol].price):"載入中..."),1),t("td",{class:E(w(i,(B=d.value[i.symbol])==null?void 0:B.price))},b(e(i,(X=d.value[i.symbol])==null?void 0:X.price)),3),t("td",null,[t("div",De,[t("button",{onClick:mt=>D(T),class:"text-primary text-sm"}," 編輯 ",8,Ce),t("button",{onClick:mt=>R(T),class:"text-danger text-sm"}," 刪除 ",8,Pe)])])])}),128))])])]))]),$.value?(y(),h("div",Te,[t("div",qe,[t("h3",ze,b(x.value===null?"新增持股":"編輯持股"),1),t("form",{onSubmit:ut(m,["prevent"])},[t("div",Fe,[s[14]||(s[14]=t("label",{class:"block text-sm font-medium mb-1"},"股票代碼",-1)),V(t("input",{"onUpdate:modelValue":s[1]||(s[1]=i=>o.symbol=i),required:"",class:"input w-full",placeholder:"例如：2330.TW 或 AAPL"},null,512),[[O,o.symbol]])]),t("div",Ve,[s[15]||(s[15]=t("label",{class:"block text-sm font-medium mb-1"},"股票名稱",-1)),V(t("input",{"onUpdate:modelValue":s[2]||(s[2]=i=>o.name=i),required:"",class:"input w-full",placeholder:"例如：台積電 或 蘋果"},null,512),[[O,o.name]])]),t("div",Ie,[s[17]||(s[17]=t("label",{class:"block text-sm font-medium mb-1"},"市場",-1)),V(t("select",{"onUpdate:modelValue":s[3]||(s[3]=i=>o.market=i),required:"",class:"input w-full"},s[16]||(s[16]=[t("option",{value:"台股"},"台股",-1),t("option",{value:"美股"},"美股",-1),t("option",{value:"其他"},"其他",-1)]),512),[[zt,o.market]])]),t("div",Ae,[s[18]||(s[18]=t("label",{class:"block text-sm font-medium mb-1"},"成本價",-1)),V(t("input",{"onUpdate:modelValue":s[4]||(s[4]=i=>o.cost=i),type:"number",step:"0.01",required:"",class:"input w-full",placeholder:"每股成本"},null,512),[[O,o.cost,void 0,{number:!0}]])]),t("div",Re,[s[19]||(s[19]=t("label",{class:"block text-sm font-medium mb-1"},"持有股數",-1)),V(t("input",{"onUpdate:modelValue":s[5]||(s[5]=i=>o.quantity=i),type:"number",required:"",class:"input w-full",placeholder:"持有數量"},null,512),[[O,o.quantity,void 0,{number:!0}]])]),t("div",Oe,[s[20]||(s[20]=t("label",{class:"block text-sm font-medium mb-1"},"購買日期",-1)),V(t("input",{"onUpdate:modelValue":s[6]||(s[6]=i=>o.purchaseDate=i),type:"date",class:"input w-full"},null,512),[[O,o.purchaseDate]])]),t("div",{class:"flex justify-end space-x-3"},[t("button",{type:"button",onClick:v,class:"btn bg-gray-200 text-gray-800"}," 取消 "),s[21]||(s[21]=t("button",{type:"submit",class:"btn btn-primary"},"儲存",-1))])],32)])])):N("",!0),n.value!==null?(y(),h("div",je,[t("div",Ee,[s[22]||(s[22]=t("h3",{class:"text-lg font-bold mb-4"},"確認刪除",-1)),t("p",Ne," 確定要刪除「"+b((P=r.value[n.value])==null?void 0:P.name)+"」的持股資料嗎？ ",1),t("div",Me,[t("button",{onClick:s[7]||(s[7]=i=>n.value=null),class:"btn bg-gray-200 text-gray-800"}," 取消 "),t("button",{onClick:s[8]||(s[8]=i=>L()),class:"btn btn-danger"}," 確認刪除 ")])])])):N("",!0)])}}},Le={class:"card bg-white p-4 mb-6"},We={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Be={class:"p-3 bg-gray-50 rounded-lg"},Ye={class:"p-3 bg-gray-50 rounded-lg"},Je={class:"text-lg font-semibold"},Ke={class:"flex justify-between items-center mb-4"},He={class:"card"},Ze={key:0,class:"text-center py-6 text-gray-500"},Ge={key:1,class:"table-container"},Qe={class:"table"},Xe={class:"flex space-x-2"},ts=["onClick"],es=["onClick"],ss={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},ls={class:"bg-white rounded-lg p-6 max-w-md w-full"},ns={class:"text-lg font-bold mb-4"},os={class:"mb-4"},as={class:"mb-4"},rs={class:"mb-4"},is={class:"mb-4"},us={class:"mb-4"},cs={class:"mb-4"},ds=["value"],ms={class:"mb-4"},ps={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},bs={class:"bg-white rounded-lg p-6 max-w-md w-full"},vs={class:"mb-4"},ys={class:"flex justify-end space-x-3"},fs={__name:"RealizedView",setup(f){const{getRealizedTrades:_,addRealizedTrade:C,updateRealizedTrade:S,deleteRealizedTrade:a}=H(),r=q([]),d=q(!1),$=q(null),x=q(null),n=it({symbol:"",name:"",sellPrice:0,quantity:0,buyPrice:0,date:new Date().toISOString().split("T")[0]}),u=F(()=>r.value.reduce((c,e)=>c+e.profit,0)),o=F(()=>[...r.value].sort((c,e)=>new Date(e.date)-new Date(c.date))),g=()=>{r.value=_()},I=c=>{const e=r.value[c];$.value=c,n.symbol=e.symbol,n.name=e.name,n.sellPrice=e.sellPrice,n.quantity=e.quantity,n.buyPrice=e.cost/e.quantity||0,n.date=e.date,d.value=!0},z=c=>{x.value=c},k=()=>{x.value!==null&&(a(x.value),g(),x.value=null)},j=()=>{const c=p(),w=n.sellPrice*n.quantity-c,l={symbol:n.symbol,name:n.name,sellPrice:n.sellPrice,quantity:n.quantity,cost:c,profit:w,date:n.date};$.value!==null?S($.value,l):C(l),g(),$.value=null,d.value=!1,D()},A=()=>{d.value=!1,$.value=null,D()},D=()=>{n.symbol="",n.name="",n.sellPrice=0,n.quantity=0,n.buyPrice=0,n.date=new Date().toISOString().split("T")[0]},R=c=>new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(c),L=c=>c.toFixed(2),m=c=>at(c).format("YYYY/MM/DD"),v=c=>{if(c.cost===0)return"0.00%";const e=c.profit/c.cost*100;return`${e>=0?"+":""}${e.toFixed(2)}%`},p=()=>n.buyPrice*n.quantity;return Q(()=>{g()}),(c,e)=>{var w;return y(),h("div",null,[e[21]||(e[21]=t("h2",{class:"text-xl font-bold mb-4"},"已實現收益",-1)),t("div",Le,[t("div",We,[t("div",Be,[e[9]||(e[9]=t("h3",{class:"text-gray-500 text-sm"},"總實現收益",-1)),t("p",{class:E(["text-lg font-semibold",u.value>=0?"positive":"negative"])},b(u.value>0?"+":"")+b(R(u.value)),3)]),t("div",Ye,[e[10]||(e[10]=t("h3",{class:"text-gray-500 text-sm"},"總交易次數",-1)),t("p",Je,b(r.value.length)+" 次",1)])])]),t("div",Ke,[t("button",{onClick:e[0]||(e[0]=l=>d.value=!0),class:"btn btn-primary"}," + 新增已實現收益 ")]),t("div",He,[r.value.length===0?(y(),h("div",Ze," 尚未新增已實現收益資料，請點擊「新增已實現收益」按鈕進行新增。 ")):(y(),h("div",Ge,[t("table",Qe,[e[11]||(e[11]=t("thead",null,[t("tr",null,[t("th",null,"日期"),t("th",null,"代碼"),t("th",null,"名稱"),t("th",null,"賣出價格"),t("th",null,"數量"),t("th",null,"總成本"),t("th",null,"實現損益"),t("th",null,"報酬率"),t("th",null,"操作")])],-1)),t("tbody",null,[(y(!0),h(Y,null,J(o.value,(l,s)=>(y(),h("tr",{key:s},[t("td",null,b(m(l.date)),1),t("td",null,b(l.symbol),1),t("td",null,b(l.name),1),t("td",null,b(L(l.sellPrice)),1),t("td",null,b(l.quantity),1),t("td",null,b(R(l.cost)),1),t("td",{class:E(l.profit>=0?"positive":"negative")},b(l.profit>0?"+":"")+b(R(l.profit)),3),t("td",{class:E(l.profit>=0?"positive":"negative")},b(v(l)),3),t("td",null,[t("div",Xe,[t("button",{onClick:P=>I(s),class:"text-primary text-sm"}," 編輯 ",8,ts),t("button",{onClick:P=>z(s),class:"text-danger text-sm"}," 刪除 ",8,es)])])]))),128))])])]))]),d.value?(y(),h("div",ss,[t("div",ls,[t("h3",ns,b($.value===null?"新增已實現收益":"編輯已實現收益"),1),t("form",{onSubmit:ut(j,["prevent"])},[t("div",os,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium mb-1"},"股票代碼",-1)),V(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>n.symbol=l),required:"",class:"input w-full",placeholder:"例如：2330.TW 或 AAPL"},null,512),[[O,n.symbol]])]),t("div",as,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium mb-1"},"股票名稱",-1)),V(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>n.name=l),required:"",class:"input w-full",placeholder:"例如：台積電 或 蘋果"},null,512),[[O,n.name]])]),t("div",rs,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium mb-1"},"賣出價格",-1)),V(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>n.sellPrice=l),type:"number",step:"0.01",required:"",class:"input w-full",placeholder:"每股賣出價格"},null,512),[[O,n.sellPrice,void 0,{number:!0}]])]),t("div",is,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium mb-1"},"數量",-1)),V(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>n.quantity=l),type:"number",required:"",class:"input w-full",placeholder:"賣出數量"},null,512),[[O,n.quantity,void 0,{number:!0}]])]),t("div",us,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium mb-1"},"買入價格",-1)),V(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>n.buyPrice=l),type:"number",step:"0.01",required:"",class:"input w-full",placeholder:"每股買入價格"},null,512),[[O,n.buyPrice,void 0,{number:!0}]])]),t("div",cs,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium mb-1"},"總成本",-1)),t("input",{value:p(),type:"number",step:"0.01",disabled:"",class:"input w-full bg-gray-100"},null,8,ds)]),t("div",ms,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium mb-1"},"賣出日期",-1)),V(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>n.date=l),type:"date",required:"",class:"input w-full"},null,512),[[O,n.date]])]),t("div",{class:"flex justify-end space-x-3"},[t("button",{type:"button",onClick:A,class:"btn bg-gray-200 text-gray-800"}," 取消 "),e[19]||(e[19]=t("button",{type:"submit",class:"btn btn-primary"},"儲存",-1))])],32)])])):N("",!0),x.value!==null?(y(),h("div",ps,[t("div",bs,[e[20]||(e[20]=t("h3",{class:"text-lg font-bold mb-4"},"確認刪除",-1)),t("p",vs," 確定要刪除「"+b((w=r.value[x.value])==null?void 0:w.name)+"」的已實現收益資料嗎？ ",1),t("div",ys,[t("button",{onClick:e[7]||(e[7]=l=>x.value=null),class:"btn bg-gray-200 text-gray-800"}," 取消 "),t("button",{onClick:e[8]||(e[8]=l=>k()),class:"btn btn-danger"}," 確認刪除 ")])])])):N("",!0)])}}},gs=[{path:"/",component:Ue},{path:"/realized",component:fs},{path:"/charts",component:ue}],hs=Ft({history:Vt(),routes:gs}),dt=It(Bt);dt.use(hs);dt.mount("#app");
