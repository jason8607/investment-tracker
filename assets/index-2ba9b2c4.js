import{r as nt,o as x,c as $,a as t,F as H,b as X,d as J,w as Q,t as b,u as N,e as yt,f as vt,g as ut,n as j,T as ft,h as gt,i as ht,C as xt,A as _t,p as kt,j as $t,k as St,B as wt,P as Dt,L as Tt,l as Ct,m as q,q as F,s as et,v as M,x as E,y as dt,z as Pt,D as qt,E as zt,G as Ft,H as st,I as mt,J as pt,K as V,M as A,N as Ut,O as Vt,Q as It,R as Wt}from"./vendor-d115be86.js";(function(){const v=document.createElement("link").relList;if(v&&v.supports&&v.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))k(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&k(d)}).observe(document,{childList:!0,subtree:!0});function _(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function k(o){if(o.ep)return;o.ep=!0;const a=_(o);fetch(o.href,a)}})();const at="investment-tracker-stocks",rt="investment-tracker-realized";function Z(){const y=()=>{try{const r=localStorage.getItem(at);return r?JSON.parse(r):[]}catch(r){return console.error("無法讀取持股資料",r),[]}},v=r=>{try{localStorage.setItem(at,JSON.stringify(r))}catch(h){console.error("無法儲存持股資料",h)}},_=r=>{const h=y();h.push(r),v(h)},k=(r,h)=>{const n=y();n[r]=h,v(n)},o=r=>{const h=y();h.splice(r,1),v(h)},a=()=>{try{const r=localStorage.getItem(rt);return r?JSON.parse(r):[]}catch(r){return console.error("無法讀取已實現收益資料",r),[]}},d=r=>{try{localStorage.setItem(rt,JSON.stringify(r))}catch(h){console.error("無法儲存已實現收益資料",h)}};return{getStocks:y,setStocks:v,addStock:_,updateStock:k,deleteStock:o,getRealizedTrades:a,setRealizedTrades:d,addRealizedTrade:r=>{const h=a();h.push(r),d(h)},updateRealizedTrade:(r,h)=>{const n=a();n[r]=h,d(n)},deleteRealizedTrade:r=>{const h=a();h.splice(r,1),d(h)}}}const Ot={class:"min-h-screen"},At={class:"bg-primary text-white p-4 shadow-md"},Rt={class:"container mx-auto flex justify-between items-center"},jt={class:"flex space-x-2"},Et={class:"btn bg-secondary text-white text-sm px-3 py-1 cursor-pointer"},Nt={class:"bg-white shadow-sm"},Mt={class:"container mx-auto"},Lt={class:"flex"},Bt={class:"container mx-auto p-4"},Yt={class:"bg-gray-100 text-gray-600 p-4 text-center text-sm"},Jt={__name:"App",setup(y){const{getStocks:v,getRealizedTrades:_,setStocks:k,setRealizedTrades:o}=Z(),a=[{name:"持股管理",path:"/"},{name:"已實現收益",path:"/realized"},{name:"圖表分析",path:"/charts"}],d=()=>{const S=N.book_new(),l=v(),r=_(),h=l.map(D=>({股票代碼:D.symbol,股票名稱:D.name,市場:D.market,成本價:D.cost,數量:D.quantity,購買日期:D.purchaseDate})),n=r.map(D=>({股票代碼:D.symbol,股票名稱:D.name,賣出價格:D.sellPrice,數量:D.quantity,成本:D.cost,實現損益:D.profit,日期:D.date})),z=N.json_to_sheet(h),I=N.json_to_sheet(n);N.book_append_sheet(S,z,"持股紀錄"),N.book_append_sheet(S,I,"已實現收益"),yt(S,"投資損益資料.xlsx")},C=S=>{const l=S.target.files[0];if(!l)return;const r=new FileReader;r.onload=h=>{const n=new Uint8Array(h.target.result),z=vt(n,{type:"array"}),I=z.Sheets.持股紀錄;if(I){const W=N.sheet_to_json(I).map(T=>({symbol:T.股票代碼,name:T.股票名稱,market:T.市場,cost:parseFloat(T.成本價),quantity:parseInt(T.數量),purchaseDate:T.購買日期}));k(W)}const D=z.Sheets.已實現收益;if(D){const W=N.sheet_to_json(D).map(T=>({symbol:T.股票代碼,name:T.股票名稱,sellPrice:parseFloat(T.賣出價格),quantity:parseInt(T.數量),cost:parseFloat(T.成本),profit:parseFloat(T.實現損益),date:T.日期}));o(W)}S.target.value="",alert("資料匯入成功！")},r.readAsArrayBuffer(l)};return(S,l)=>{const r=nt("router-link"),h=nt("router-view");return x(),$("div",Ot,[t("header",At,[t("div",Rt,[l[3]||(l[3]=t("h1",{class:"text-xl md:text-2xl font-bold"},"投資損益小幫手",-1)),t("div",jt,[t("button",{onClick:d,class:"btn bg-secondary text-white text-sm px-3 py-1"},l[0]||(l[0]=[t("span",{class:"hidden md:inline"},"匯出資料",-1),t("span",{class:"md:hidden"},"匯出",-1)])),t("label",Et,[l[1]||(l[1]=t("span",{class:"hidden md:inline"},"匯入資料",-1)),l[2]||(l[2]=t("span",{class:"md:hidden"},"匯入",-1)),t("input",{type:"file",accept:".xlsx",class:"hidden",onChange:C},null,32)])])])]),t("nav",Nt,[t("div",Mt,[t("ul",Lt,[(x(),$(H,null,X(a,n=>t("li",{key:n.path},[J(r,{to:n.path,class:j(["block px-4 py-3 hover:bg-gray-100 transition-colors border-b-2",S.$route.path===n.path?"border-primary text-primary font-medium":"border-transparent"])},{default:Q(()=>[ut(b(n.name),1)]),_:2},1032,["to","class"])])),64))])])]),t("main",Bt,[J(h,null,{default:Q(({Component:n})=>[J(ft,{name:"fade",mode:"out-in"},{default:Q(()=>[(x(),gt(ht(n)))]),_:2},1024)]),_:1})]),t("footer",Yt,[t("p",null,"投資損益小幫手 © "+b(new Date().getFullYear()),1)])])}}};const Kt={class:"mb-6"},Ht={class:"flex flex-wrap space-x-2"},Xt=["onClick"],Zt={class:"card"},Gt={key:0,class:"p-4"},Qt={key:0,class:"text-center py-6 text-gray-500"},te={key:1,class:"flex flex-col md:flex-row"},ee={class:"w-full md:w-1/2 min-h-[300px]"},se={class:"w-full md:w-1/2 p-4"},le={class:"flex-1"},oe={class:"text-right"},ne={key:1,class:"p-4"},ae={key:0,class:"text-center py-6 text-gray-500"},re={key:1,class:"min-h-[300px]"},ie={key:2,class:"p-4"},ce={key:0,class:"text-center py-6 text-gray-500"},ue={key:1,class:"min-h-[300px]"},de={__name:"ChartsView",setup(y){xt.register(_t,kt,$t,St,LinearScale,wt,Dt,Tt,Ct);const{getStocks:v,getRealizedTrades:_}=Z(),k=q("allocation"),o=q([]),a=q([]),d=q({}),C=[{id:"allocation",name:"持股分配"},{id:"profit",name:"總體損益"},{id:"realized",name:"已實現收益趨勢"}],S=["#4CAF50","#2196F3","#F44336","#FF9800","#9C27B0","#3F51B5","#009688","#795548","#607D8B","#E91E63"],l=F(()=>o.value.length>0),r=F(()=>a.value.length>0),h=F(()=>l.value||r.value),n=F(()=>{if(!l.value)return[];const m=o.value.map(f=>{var w;const s=(((w=d.value[f.symbol])==null?void 0:w.price)||f.cost)*f.quantity;return{...f,marketValue:s}}),g=m.reduce((f,c)=>f+c.marketValue,0);return m.map(f=>({...f,percentage:f.marketValue/g*100})).sort((f,c)=>c.marketValue-f.marketValue)}),z=F(()=>l.value?{labels:n.value.map(m=>m.name),datasets:[{data:n.value.map(m=>m.marketValue),backgroundColor:n.value.map((m,g)=>S[g%S.length]),hoverOffset:4}]}:{datasets:[]}),I=F(()=>{const m=["未實現損益","已實現收益","總體損益"],g=o.value.reduce((w,p)=>{var e;const K=(((e=d.value[p.symbol])==null?void 0:e.price)||p.cost)*p.quantity,i=p.cost*p.quantity;return w+(K-i)},0),f=a.value.reduce((w,p)=>w+p.profit,0),c=g+f,s=[g,f,c];return{labels:m,datasets:[{label:"損益金額",data:s,backgroundColor:s.map(w=>w>=0?"rgba(76, 175, 80, 0.6)":"rgba(244, 67, 54, 0.6)"),borderColor:s.map(w=>w>=0?"rgb(76, 175, 80)":"rgb(244, 67, 54)"),borderWidth:1}]}}),D=F(()=>{if(!r.value)return{datasets:[]};const m=[...a.value].sort((s,w)=>new Date(s.date)-new Date(w.date));let g=0;const f=[],c=[];return m.forEach(s=>{g+=s.profit,f.push(g),c.push(dt(s.date).format("YYYY/MM/DD"))}),{labels:c,datasets:[{label:"累計已實現收益",data:f,borderColor:"rgb(54, 162, 235)",backgroundColor:"rgba(54, 162, 235, 0.5)",tension:.1,pointBackgroundColor:f.map(s=>s>=0?"rgb(76, 175, 80)":"rgb(244, 67, 54)")}]}}),R={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(m){const g=m.label||"",f=m.raw||0,c=f/m.dataset.data.reduce((s,w)=>s+w,0)*100;return`${g}: ${O(f)} (${c.toFixed(2)}%)`}}}}},W={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(m){return`${m.dataset.label}: ${O(m.raw)}`}}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(m){return O(m)}}}}},T={responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{callbacks:{label:function(m){return`${m.dataset.label}: ${O(m.raw)}`}}}},scales:{y:{ticks:{callback:function(m){return O(m)}}}}},O=m=>new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(m),L=()=>{o.value=v(),a.value=_();const m={};o.value.forEach(g=>{m[g.symbol]={price:g.cost,change:0,changePercent:0}}),d.value=m;try{const g=localStorage.getItem("investment-tracker-prices");g&&(d.value={...d.value,...JSON.parse(g)})}catch(g){console.error("無法讀取價格資料",g)}};return et(()=>{L(),window.addEventListener("storage",m=>{(m.key==="investment-tracker-stocks"||m.key==="investment-tracker-realized"||m.key==="investment-tracker-prices")&&L()})}),(m,g)=>(x(),$("div",null,[g[4]||(g[4]=t("h2",{class:"text-xl font-bold mb-4"},"圖表分析",-1)),t("div",Kt,[t("div",Ht,[(x(),$(H,null,X(C,f=>t("button",{key:f.id,onClick:c=>k.value=f.id,class:j(["px-4 py-2 rounded-md transition-colors mb-2",k.value===f.id?"bg-primary text-white":"bg-gray-100 text-gray-700"])},b(f.name),11,Xt)),64))])]),t("div",Zt,[k.value==="allocation"?(x(),$("div",Gt,[g[1]||(g[1]=t("h3",{class:"text-lg font-medium mb-4"},"持股分配",-1)),l.value?(x(),$("div",te,[t("div",ee,[J(M(Pt),{"chart-data":z.value,"chart-options":R},null,8,["chart-data"])]),t("div",se,[g[0]||(g[0]=t("h4",{class:"text-md font-medium mb-2"},"持股比例",-1)),(x(!0),$(H,null,X(n.value,(f,c)=>(x(),$("div",{key:c,class:"flex items-center mb-2"},[t("div",{class:"w-4 h-4 rounded-full mr-2",style:qt({backgroundColor:S[c%S.length]})},null,4),t("div",le,b(f.name)+" ("+b(f.symbol)+")",1),t("div",oe,b(f.percentage.toFixed(2))+"%",1)]))),128))])])):(x(),$("div",Qt," 尚未新增持股資料，請先在持股管理頁面新增股票。 "))])):E("",!0),k.value==="profit"?(x(),$("div",ne,[g[2]||(g[2]=t("h3",{class:"text-lg font-medium mb-4"},"總體損益",-1)),h.value?(x(),$("div",re,[J(M(zt),{"chart-data":I.value,"chart-options":W},null,8,["chart-data"])])):(x(),$("div",ae," 尚未有足夠資料，請先新增持股或已實現收益。 "))])):E("",!0),k.value==="realized"?(x(),$("div",ie,[g[3]||(g[3]=t("h3",{class:"text-lg font-medium mb-4"},"已實現收益分析",-1)),r.value?(x(),$("div",ue,[J(M(Ft),{"chart-data":D.value,"chart-options":T},null,8,["chart-data"])])):(x(),$("div",ce," 尚未新增已實現收益資料，請先在已實現收益頁面新增資料。 "))])):E("",!0)])]))}},lt="https://yahoo-finance-backend.vercel.app";let Y={USD_TWD:null,lastUpdated:null};async function me(){const y=new Date;if(Y.USD_TWD&&Y.lastUpdated&&y-Y.lastUpdated<36e5)return console.log("使用緩存的匯率數據"),Y.USD_TWD;try{const v=["USDTWD=X","TWD=X"];let _,k=null;for(const o of v)try{const a=`${lt}/api/stock/${o}`;if(console.log(`請求美元兌台幣匯率 (${o})...`),_=await st.get(a,{headers:{Accept:"application/json","Cache-Control":"no-cache"},timeout:1e4}),!_.data.error&&_.data.price){k=_.data.price,console.log(`成功獲取美元兌台幣匯率: 1 USD = ${k} TWD (使用${o})`);break}}catch(a){console.error(`使用 ${o} 獲取匯率失敗:`,a.message)}k||(console.log("無法從API獲取匯率，使用預設值"),k=30),Y={USD_TWD:k,lastUpdated:y};try{localStorage.setItem("exchange-rate-cache",JSON.stringify(Y))}catch(o){console.error("無法將匯率數據存入localStorage",o)}return k}catch(v){console.error("獲取匯率失敗:",v);try{const _=localStorage.getItem("exchange-rate-cache");if(_){const k=JSON.parse(_);return console.log("使用localStorage中的匯率數據"),k.USD_TWD}}catch(_){console.error("讀取緩存匯率失敗",_)}return 30}}function pe(y,v){return y?(v||(v=30),y*v):0}function tt(y){return y?y.includes(".")?y:/^\d+$/.test(y)?`${y}.TW`:y:""}async function be(y){const v=y,_=tt(y),k=`${lt}/api/stock/${_}`;console.log(`請求股票數據：${_}`);try{const o=await st.get(k,{headers:{Accept:"application/json","Cache-Control":"no-cache"},timeout:1e4});if(o.data.error)throw new Error(`API 錯誤: ${o.data.error}`);return console.log(`成功獲取 ${_} 價格: ${o.data.price} ${o.data.currency}`),{...o.data,originalSymbol:v}}catch(o){throw console.error(`獲取 ${_} 價格失敗:`,o),o.response?new Error(`API 請求失敗: ${o.response.status} ${o.response.statusText}`):o.request?new Error("無法連接到服務器，請檢查網絡連接"):o}}async function ye(y){const v=y.filter(o=>o&&o.trim());if(v.length===0)return[];const _=v.map(o=>tt(o)),k=`${lt}/api/stocks?symbols=${_.join(",")}`;console.log(`批量獲取股票數據: ${v.join(", ")}`);try{const o=await st.get(k,{headers:{Accept:"application/json","Cache-Control":"no-cache"},timeout:15e3});return console.log(`成功獲取 ${o.data.length} 支股票數據`),o.data.map((d,C)=>(d.originalSymbol||(d.originalSymbol=v[C]),d))}catch(o){console.error("批量獲取股票數據失敗:",o),console.log("嘗試逐個獲取股票數據...");const a=v.map(d=>be(d).catch(C=>(console.error(`獲取 ${d} 數據失敗:`,C),{error:!0,errorMessage:C.message||"未知錯誤",symbol:tt(d),originalSymbol:d})));return Promise.all(a)}}function it(y,v,_=2){return y==null?"-":`${v==="TWD"?"NT$":"$"}${y.toFixed(_)}`}function ct(y){return y==null?"":y>0?"positive":y<0?"negative":""}const ve={class:"card bg-white p-4 mb-6"},fe={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ge={class:"p-3 bg-gray-50 rounded-lg"},he={class:"text-lg font-semibold"},xe={class:"p-3 bg-gray-50 rounded-lg"},_e={class:"text-lg font-semibold"},ke={class:"p-3 bg-gray-50 rounded-lg"},$e={class:"text-sm"},Se={class:"flex justify-between items-center mb-4"},we={class:"flex items-center"},De={class:"text-sm text-gray-500 mr-3"},Te={key:0,class:"inline-block animate-spin"},Ce={class:"card"},Pe={key:0,class:"text-center py-6 text-gray-500"},qe={key:1,class:"table-container"},ze={class:"table"},Fe={class:"flex space-x-2"},Ue=["onClick"],Ve=["onClick"],Ie={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},We={class:"bg-white rounded-lg p-6 max-w-md w-full"},Oe={class:"text-lg font-bold mb-4"},Ae={class:"mb-4"},Re={class:"mb-4"},je={class:"mb-4"},Ee={class:"mb-4"},Ne={class:"mb-4"},Me={class:"mb-4"},Le={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},Be={class:"bg-white rounded-lg p-6 max-w-md w-full"},Ye={class:"mb-4"},Je={class:"flex justify-end space-x-3"},Ke={__name:"HomeView",setup(y){const{getStocks:v,addStock:_,updateStock:k,deleteStock:o}=Z(),a=q([]),d=q({}),C=q(!1),S=q(null),l=q(null),r=q(!1),h=q(30),n=mt({symbol:"",name:"",market:"台股",cost:0,quantity:0,purchaseDate:new Date().toISOString().split("T")[0]}),z=F(()=>a.value.reduce((i,e)=>i+e.cost*e.quantity,0)),I=F(()=>a.value.reduce((i,e)=>{const P=w(e);return i+P*e.quantity},0)),D=F(()=>I.value-z.value),R=F(()=>z.value===0?0:D.value/z.value*100),W=()=>{a.value=v(),a.value.length>0&&T()},T=async()=>{if(a.value.length!==0){r.value=!0;try{const i=a.value.map(u=>u.symbol),e=await ye(i),P={};e.forEach(u=>{const U=u.originalSymbol||u.symbol;P[U]=u}),d.value=P;try{localStorage.setItem("investment-tracker-prices",JSON.stringify(P))}catch(u){console.error("無法儲存價格資料到本地存儲",u)}}catch(i){console.error("更新價格出錯",i)}finally{r.value=!1}}},O=i=>{const e=a.value[i];S.value=i,n.symbol=e.symbol,n.name=e.name,n.market=e.market,n.cost=e.cost,n.quantity=e.quantity,n.purchaseDate=e.purchaseDate||"",C.value=!0},L=i=>{l.value=i},m=()=>{l.value!==null&&(o(l.value),W(),l.value=null)},g=()=>{const i={symbol:n.symbol,name:n.name,market:n.market,cost:n.cost,quantity:n.quantity,purchaseDate:n.purchaseDate};S.value!==null?k(S.value,i):_(i),W(),S.value=null,C.value=!1,c()},f=()=>{C.value=!1,S.value=null,c()},c=()=>{n.symbol="",n.name="",n.market="台股",n.cost=0,n.quantity=0,n.purchaseDate=new Date().toISOString().split("T")[0]},s=i=>new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(i),w=i=>{const e=d.value[i.symbol]||d.value[`${i.symbol}.TW`]||Object.values(d.value).find(P=>P.originalSymbol===i.symbol||P.symbol===i.symbol||P.symbol===`${i.symbol}.TW`);return e?e.currency==="USD"?pe(e.price,h.value):e.price||0:0},p=i=>{const e=d.value[i.symbol]||d.value[`${i.symbol}.TW`]||Object.values(d.value).find(P=>P.originalSymbol===i.symbol||P.symbol===i.symbol||P.symbol===`${i.symbol}.TW`);return(e==null?void 0:e.change)||0},B=(i,e)=>{if(!e)return"載入中...";const P=i.cost*i.quantity,U=e*i.quantity-P,G=P>0?U/P*100:0,ot=U>=0?"+":"";return`${ot}${s(U)} (${ot}${G.toFixed(2)}%)`},K=(i,e)=>{if(!e)return"";const P=i.cost*i.quantity,U=e*i.quantity-P;return U>0?"positive":U<0?"negative":""};return et(()=>{W(),me().then(e=>{h.value=e,console.log(`設置匯率: 1 USD = ${e} TWD`),T()}).catch(e=>{console.error("獲取匯率失敗，使用預設值",e)});const i=setInterval(T,5*60*1e3);return()=>clearInterval(i)}),(i,e)=>{var P;return x(),$("div",null,[e[23]||(e[23]=t("h2",{class:"text-xl font-bold mb-4"},"持股管理",-1)),t("div",ve,[t("div",fe,[t("div",ge,[e[9]||(e[9]=t("h3",{class:"text-gray-500 text-sm"},"總投資成本",-1)),t("p",he,b(s(z.value)),1)]),t("div",xe,[e[10]||(e[10]=t("h3",{class:"text-gray-500 text-sm"},"目前總市值",-1)),t("p",_e,b(s(I.value)),1)]),t("div",ke,[e[11]||(e[11]=t("h3",{class:"text-gray-500 text-sm"},"未實現損益",-1)),t("p",{class:j(["text-lg font-semibold",M(ct)(D.value)])},[ut(b(D.value>0?"+":"")+b(s(D.value))+" ",1),t("span",$e," ("+b(R.value>0?"+":"")+b(R.value.toFixed(2))+"%) ",1)],2)])])]),t("div",Se,[t("button",{onClick:e[0]||(e[0]=u=>C.value=!0),class:"btn btn-primary"}," + 新增持股 "),t("div",we,[t("span",De,"匯率: 1 USD = "+b(h.value.toFixed(2))+" TWD",1),t("button",{onClick:T,class:"btn bg-gray-100 text-gray-700 flex items-center"},[e[12]||(e[12]=t("span",{class:"mr-1"},"更新價格",-1)),r.value?(x(),$("span",Te,"⟳")):E("",!0)])])]),t("div",Ce,[a.value.length===0?(x(),$("div",Pe," 尚未新增持股資料，請點擊「新增持股」按鈕開始追蹤。 ")):(x(),$("div",qe,[t("table",ze,[e[13]||(e[13]=t("thead",null,[t("tr",null,[t("th",null,"代碼"),t("th",null,"名稱"),t("th",null,"市場"),t("th",null,"持有股數"),t("th",null,"成本價"),t("th",null,"目前價格"),t("th",null,"市值"),t("th",null,"損益"),t("th",null,"操作")])],-1)),t("tbody",null,[(x(!0),$(H,null,X(a.value,(u,U)=>(x(),$("tr",{key:U},[t("td",null,b(u.symbol),1),t("td",null,b(u.name),1),t("td",null,b(u.market),1),t("td",null,b(u.quantity),1),t("td",null,b(M(it)(u.cost)),1),t("td",{class:j(M(ct)(p(u)))},b(w(u)?M(it)(w(u)):"載入中..."),3),t("td",null,b(w(u)?s(u.quantity*w(u)):"載入中..."),1),t("td",{class:j(K(u,w(u)))},b(B(u,w(u))),3),t("td",null,[t("div",Fe,[t("button",{onClick:G=>O(U),class:"text-primary text-sm"}," 編輯 ",8,Ue),t("button",{onClick:G=>L(U),class:"text-danger text-sm"}," 刪除 ",8,Ve)])])]))),128))])])]))]),C.value?(x(),$("div",Ie,[t("div",We,[t("h3",Oe,b(S.value===null?"新增持股":"編輯持股"),1),t("form",{onSubmit:pt(g,["prevent"])},[t("div",Ae,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium mb-1"},"股票代碼",-1)),V(t("input",{"onUpdate:modelValue":e[1]||(e[1]=u=>n.symbol=u),required:"",class:"input w-full",placeholder:"例如：2330.TW 或 AAPL"},null,512),[[A,n.symbol]])]),t("div",Re,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium mb-1"},"股票名稱",-1)),V(t("input",{"onUpdate:modelValue":e[2]||(e[2]=u=>n.name=u),required:"",class:"input w-full",placeholder:"例如：台積電 或 蘋果"},null,512),[[A,n.name]])]),t("div",je,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium mb-1"},"市場",-1)),V(t("select",{"onUpdate:modelValue":e[3]||(e[3]=u=>n.market=u),required:"",class:"input w-full"},e[16]||(e[16]=[t("option",{value:"台股"},"台股",-1),t("option",{value:"美股"},"美股",-1),t("option",{value:"其他"},"其他",-1)]),512),[[Ut,n.market]])]),t("div",Ee,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium mb-1"},"成本價",-1)),V(t("input",{"onUpdate:modelValue":e[4]||(e[4]=u=>n.cost=u),type:"number",step:"0.01",required:"",class:"input w-full",placeholder:"每股成本"},null,512),[[A,n.cost,void 0,{number:!0}]])]),t("div",Ne,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium mb-1"},"持有股數",-1)),V(t("input",{"onUpdate:modelValue":e[5]||(e[5]=u=>n.quantity=u),type:"number",required:"",class:"input w-full",placeholder:"持有數量"},null,512),[[A,n.quantity,void 0,{number:!0}]])]),t("div",Me,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium mb-1"},"購買日期",-1)),V(t("input",{"onUpdate:modelValue":e[6]||(e[6]=u=>n.purchaseDate=u),type:"date",class:"input w-full"},null,512),[[A,n.purchaseDate]])]),t("div",{class:"flex justify-end space-x-3"},[t("button",{type:"button",onClick:f,class:"btn bg-gray-200 text-gray-800"}," 取消 "),e[21]||(e[21]=t("button",{type:"submit",class:"btn btn-primary"},"儲存",-1))])],32)])])):E("",!0),l.value!==null?(x(),$("div",Le,[t("div",Be,[e[22]||(e[22]=t("h3",{class:"text-lg font-bold mb-4"},"確認刪除",-1)),t("p",Ye," 確定要刪除「"+b((P=a.value[l.value])==null?void 0:P.name)+"」的持股資料嗎？ ",1),t("div",Je,[t("button",{onClick:e[7]||(e[7]=u=>l.value=null),class:"btn bg-gray-200 text-gray-800"}," 取消 "),t("button",{onClick:e[8]||(e[8]=u=>m()),class:"btn btn-danger"}," 確認刪除 ")])])])):E("",!0)])}}},He={class:"card bg-white p-4 mb-6"},Xe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ze={class:"p-3 bg-gray-50 rounded-lg"},Ge={class:"p-3 bg-gray-50 rounded-lg"},Qe={class:"text-lg font-semibold"},ts={class:"flex justify-between items-center mb-4"},es={class:"card"},ss={key:0,class:"text-center py-6 text-gray-500"},ls={key:1,class:"table-container"},os={class:"table"},ns={class:"flex space-x-2"},as=["onClick"],rs=["onClick"],is={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},cs={class:"bg-white rounded-lg p-6 max-w-md w-full"},us={class:"text-lg font-bold mb-4"},ds={class:"mb-4"},ms={class:"mb-4"},ps={class:"mb-4"},bs={class:"mb-4"},ys={class:"mb-4"},vs={class:"mb-4"},fs=["value"],gs={class:"mb-4"},hs={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},xs={class:"bg-white rounded-lg p-6 max-w-md w-full"},_s={class:"mb-4"},ks={class:"flex justify-end space-x-3"},$s={__name:"RealizedView",setup(y){const{getRealizedTrades:v,addRealizedTrade:_,updateRealizedTrade:k,deleteRealizedTrade:o}=Z(),a=q([]),d=q(!1),C=q(null),S=q(null),l=mt({symbol:"",name:"",sellPrice:0,quantity:0,buyPrice:0,date:new Date().toISOString().split("T")[0]}),r=F(()=>a.value.reduce((c,s)=>c+s.profit,0)),h=F(()=>[...a.value].sort((c,s)=>new Date(s.date)-new Date(c.date))),n=()=>{a.value=v()},z=c=>{const s=a.value[c];C.value=c,l.symbol=s.symbol,l.name=s.name,l.sellPrice=s.sellPrice,l.quantity=s.quantity,l.buyPrice=s.cost/s.quantity||0,l.date=s.date,d.value=!0},I=c=>{S.value=c},D=()=>{S.value!==null&&(o(S.value),n(),S.value=null)},R=()=>{const c=f(),w=l.sellPrice*l.quantity-c,p={symbol:l.symbol,name:l.name,sellPrice:l.sellPrice,quantity:l.quantity,cost:c,profit:w,date:l.date};C.value!==null?k(C.value,p):_(p),n(),C.value=null,d.value=!1,T()},W=()=>{d.value=!1,C.value=null,T()},T=()=>{l.symbol="",l.name="",l.sellPrice=0,l.quantity=0,l.buyPrice=0,l.date=new Date().toISOString().split("T")[0]},O=c=>new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(c),L=c=>c.toFixed(2),m=c=>dt(c).format("YYYY/MM/DD"),g=c=>{if(c.cost===0)return"0.00%";const s=c.profit/c.cost*100;return`${s>=0?"+":""}${s.toFixed(2)}%`},f=()=>l.buyPrice*l.quantity;return et(()=>{n()}),(c,s)=>{var w;return x(),$("div",null,[s[21]||(s[21]=t("h2",{class:"text-xl font-bold mb-4"},"已實現收益",-1)),t("div",He,[t("div",Xe,[t("div",Ze,[s[9]||(s[9]=t("h3",{class:"text-gray-500 text-sm"},"總實現收益",-1)),t("p",{class:j(["text-lg font-semibold",r.value>=0?"positive":"negative"])},b(r.value>0?"+":"")+b(O(r.value)),3)]),t("div",Ge,[s[10]||(s[10]=t("h3",{class:"text-gray-500 text-sm"},"總交易次數",-1)),t("p",Qe,b(a.value.length)+" 次",1)])])]),t("div",ts,[t("button",{onClick:s[0]||(s[0]=p=>d.value=!0),class:"btn btn-primary"}," + 新增已實現收益 ")]),t("div",es,[a.value.length===0?(x(),$("div",ss," 尚未新增已實現收益資料，請點擊「新增已實現收益」按鈕進行新增。 ")):(x(),$("div",ls,[t("table",os,[s[11]||(s[11]=t("thead",null,[t("tr",null,[t("th",null,"日期"),t("th",null,"代碼"),t("th",null,"名稱"),t("th",null,"賣出價格"),t("th",null,"數量"),t("th",null,"總成本"),t("th",null,"實現損益"),t("th",null,"報酬率"),t("th",null,"操作")])],-1)),t("tbody",null,[(x(!0),$(H,null,X(h.value,(p,B)=>(x(),$("tr",{key:B},[t("td",null,b(m(p.date)),1),t("td",null,b(p.symbol),1),t("td",null,b(p.name),1),t("td",null,b(L(p.sellPrice)),1),t("td",null,b(p.quantity),1),t("td",null,b(O(p.cost)),1),t("td",{class:j(p.profit>=0?"positive":"negative")},b(p.profit>0?"+":"")+b(O(p.profit)),3),t("td",{class:j(p.profit>=0?"positive":"negative")},b(g(p)),3),t("td",null,[t("div",ns,[t("button",{onClick:K=>z(B),class:"text-primary text-sm"}," 編輯 ",8,as),t("button",{onClick:K=>I(B),class:"text-danger text-sm"}," 刪除 ",8,rs)])])]))),128))])])]))]),d.value?(x(),$("div",is,[t("div",cs,[t("h3",us,b(C.value===null?"新增已實現收益":"編輯已實現收益"),1),t("form",{onSubmit:pt(R,["prevent"])},[t("div",ds,[s[12]||(s[12]=t("label",{class:"block text-sm font-medium mb-1"},"股票代碼",-1)),V(t("input",{"onUpdate:modelValue":s[1]||(s[1]=p=>l.symbol=p),required:"",class:"input w-full",placeholder:"例如：2330.TW 或 AAPL"},null,512),[[A,l.symbol]])]),t("div",ms,[s[13]||(s[13]=t("label",{class:"block text-sm font-medium mb-1"},"股票名稱",-1)),V(t("input",{"onUpdate:modelValue":s[2]||(s[2]=p=>l.name=p),required:"",class:"input w-full",placeholder:"例如：台積電 或 蘋果"},null,512),[[A,l.name]])]),t("div",ps,[s[14]||(s[14]=t("label",{class:"block text-sm font-medium mb-1"},"賣出價格",-1)),V(t("input",{"onUpdate:modelValue":s[3]||(s[3]=p=>l.sellPrice=p),type:"number",step:"0.01",required:"",class:"input w-full",placeholder:"每股賣出價格"},null,512),[[A,l.sellPrice,void 0,{number:!0}]])]),t("div",bs,[s[15]||(s[15]=t("label",{class:"block text-sm font-medium mb-1"},"數量",-1)),V(t("input",{"onUpdate:modelValue":s[4]||(s[4]=p=>l.quantity=p),type:"number",required:"",class:"input w-full",placeholder:"賣出數量"},null,512),[[A,l.quantity,void 0,{number:!0}]])]),t("div",ys,[s[16]||(s[16]=t("label",{class:"block text-sm font-medium mb-1"},"買入價格",-1)),V(t("input",{"onUpdate:modelValue":s[5]||(s[5]=p=>l.buyPrice=p),type:"number",step:"0.01",required:"",class:"input w-full",placeholder:"每股買入價格"},null,512),[[A,l.buyPrice,void 0,{number:!0}]])]),t("div",vs,[s[17]||(s[17]=t("label",{class:"block text-sm font-medium mb-1"},"總成本",-1)),t("input",{value:f(),type:"number",step:"0.01",disabled:"",class:"input w-full bg-gray-100"},null,8,fs)]),t("div",gs,[s[18]||(s[18]=t("label",{class:"block text-sm font-medium mb-1"},"賣出日期",-1)),V(t("input",{"onUpdate:modelValue":s[6]||(s[6]=p=>l.date=p),type:"date",required:"",class:"input w-full"},null,512),[[A,l.date]])]),t("div",{class:"flex justify-end space-x-3"},[t("button",{type:"button",onClick:W,class:"btn bg-gray-200 text-gray-800"}," 取消 "),s[19]||(s[19]=t("button",{type:"submit",class:"btn btn-primary"},"儲存",-1))])],32)])])):E("",!0),S.value!==null?(x(),$("div",hs,[t("div",xs,[s[20]||(s[20]=t("h3",{class:"text-lg font-bold mb-4"},"確認刪除",-1)),t("p",_s," 確定要刪除「"+b((w=a.value[S.value])==null?void 0:w.name)+"」的已實現收益資料嗎？ ",1),t("div",ks,[t("button",{onClick:s[7]||(s[7]=p=>S.value=null),class:"btn bg-gray-200 text-gray-800"}," 取消 "),t("button",{onClick:s[8]||(s[8]=p=>D()),class:"btn btn-danger"}," 確認刪除 ")])])])):E("",!0)])}}},Ss=[{path:"/",component:Ke},{path:"/realized",component:$s},{path:"/charts",component:de}],ws=Vt({history:It(),routes:Ss}),bt=Wt(Jt);bt.use(ws);bt.mount("#app");
