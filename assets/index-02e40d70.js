import{r as et,o as f,c as x,a as t,F as J,b as K,d as Y,w as G,t as y,u as M,e as pt,f as bt,g as at,n as N,T as yt,h as vt,i as ft,C as gt,A as ht,p as xt,j as _t,k as kt,B as $t,P as wt,L as St,l as Ct,m as q,q as F,s as X,v as U,x as W,y as rt,z as Tt,D as Dt,E as Pt,G as qt,H as it,I as ut,J as ct,K as I,M as j,N as zt,O as Ft,Q as Vt,R as It}from"./vendor-d115be86.js";(function(){const k=document.createElement("link").relList;if(k&&k.supports&&k.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))T(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&T(d)}).observe(document,{childList:!0,subtree:!0});function P(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function T(o){if(o.ep)return;o.ep=!0;const a=P(o);fetch(o.href,a)}})();const st="investment-tracker-stocks",lt="investment-tracker-realized";function H(){const g=()=>{try{const r=localStorage.getItem(st);return r?JSON.parse(r):[]}catch(r){return console.error("無法讀取持股資料",r),[]}},k=r=>{try{localStorage.setItem(st,JSON.stringify(r))}catch(n){console.error("無法儲存持股資料",n)}},P=r=>{const n=g();n.push(r),k(n)},T=(r,n)=>{const h=g();h[r]=n,k(h)},o=r=>{const n=g();n.splice(r,1),k(n)},a=()=>{try{const r=localStorage.getItem(lt);return r?JSON.parse(r):[]}catch(r){return console.error("無法讀取已實現收益資料",r),[]}},d=r=>{try{localStorage.setItem(lt,JSON.stringify(r))}catch(n){console.error("無法儲存已實現收益資料",n)}};return{getStocks:g,setStocks:k,addStock:P,updateStock:T,deleteStock:o,getRealizedTrades:a,setRealizedTrades:d,addRealizedTrade:r=>{const n=a();n.push(r),d(n)},updateRealizedTrade:(r,n)=>{const h=a();h[r]=n,d(h)},deleteRealizedTrade:r=>{const n=a();n.splice(r,1),d(n)}}}const At={class:"min-h-screen"},Ot={class:"bg-primary text-white p-4 shadow-md"},Rt={class:"container mx-auto flex justify-between items-center"},jt={class:"flex space-x-2"},Et={class:"btn bg-secondary text-white text-sm px-3 py-1 cursor-pointer"},Nt={class:"bg-white shadow-sm"},Wt={class:"container mx-auto"},Mt={class:"flex"},Ut={class:"container mx-auto p-4"},Lt={class:"bg-gray-100 text-gray-600 p-4 text-center text-sm"},Bt={__name:"App",setup(g){const{getStocks:k,getRealizedTrades:P,setStocks:T,setRealizedTrades:o}=H(),a=[{name:"持股管理",path:"/"},{name:"已實現收益",path:"/realized"},{name:"圖表分析",path:"/charts"}],d=()=>{const _=M.book_new(),l=k(),r=P(),n=l.map(w=>({股票代碼:w.symbol,股票名稱:w.name,市場:w.market,成本價:w.cost,數量:w.quantity,購買日期:w.purchaseDate})),h=r.map(w=>({股票代碼:w.symbol,股票名稱:w.name,賣出價格:w.sellPrice,數量:w.quantity,成本:w.cost,實現損益:w.profit,日期:w.date})),A=M.json_to_sheet(n),z=M.json_to_sheet(h);M.book_append_sheet(_,A,"持股紀錄"),M.book_append_sheet(_,z,"已實現收益"),pt(_,"投資損益資料.xlsx")},S=_=>{const l=_.target.files[0];if(!l)return;const r=new FileReader;r.onload=n=>{const h=new Uint8Array(n.target.result),A=bt(h,{type:"array"}),z=A.Sheets.持股紀錄;if(z){const O=M.sheet_to_json(z).map(D=>({symbol:D.股票代碼,name:D.股票名稱,market:D.市場,cost:parseFloat(D.成本價),quantity:parseInt(D.數量),purchaseDate:D.購買日期}));T(O)}const w=A.Sheets.已實現收益;if(w){const O=M.sheet_to_json(w).map(D=>({symbol:D.股票代碼,name:D.股票名稱,sellPrice:parseFloat(D.賣出價格),quantity:parseInt(D.數量),cost:parseFloat(D.成本),profit:parseFloat(D.實現損益),date:D.日期}));o(O)}_.target.value="",alert("資料匯入成功！")},r.readAsArrayBuffer(l)};return(_,l)=>{const r=et("router-link"),n=et("router-view");return f(),x("div",At,[t("header",Ot,[t("div",Rt,[l[3]||(l[3]=t("h1",{class:"text-xl md:text-2xl font-bold"},"投資損益小幫手",-1)),t("div",jt,[t("button",{onClick:d,class:"btn bg-secondary text-white text-sm px-3 py-1"},l[0]||(l[0]=[t("span",{class:"hidden md:inline"},"匯出資料",-1),t("span",{class:"md:hidden"},"匯出",-1)])),t("label",Et,[l[1]||(l[1]=t("span",{class:"hidden md:inline"},"匯入資料",-1)),l[2]||(l[2]=t("span",{class:"md:hidden"},"匯入",-1)),t("input",{type:"file",accept:".xlsx",class:"hidden",onChange:S},null,32)])])])]),t("nav",Nt,[t("div",Wt,[t("ul",Mt,[(f(),x(J,null,K(a,h=>t("li",{key:h.path},[Y(r,{to:h.path,class:N(["block px-4 py-3 hover:bg-gray-100 transition-colors border-b-2",_.$route.path===h.path?"border-primary text-primary font-medium":"border-transparent"])},{default:G(()=>[at(y(h.name),1)]),_:2},1032,["to","class"])])),64))])])]),t("main",Ut,[Y(n,null,{default:G(({Component:h})=>[Y(yt,{name:"fade",mode:"out-in"},{default:G(()=>[(f(),vt(ft(h)))]),_:2},1024)]),_:1})]),t("footer",Lt,[t("p",null,"投資損益小幫手 © "+y(new Date().getFullYear()),1)])])}}};const Yt={class:"mb-6"},Jt={class:"flex flex-wrap space-x-2"},Kt=["onClick"],Ht={class:"card"},Zt={key:0,class:"p-4"},Gt={key:0,class:"text-center py-6 text-gray-500"},Qt={key:1,class:"flex flex-col md:flex-row"},Xt={class:"w-full md:w-1/2 min-h-[300px]"},te={class:"w-full md:w-1/2 p-4"},ee={class:"flex-1"},se={class:"text-right"},le={key:1,class:"p-4"},ne={key:0,class:"text-center py-6 text-gray-500"},oe={key:1,class:"min-h-[300px]"},ae={key:2,class:"p-4"},re={key:0,class:"text-center py-6 text-gray-500"},ie={key:1,class:"min-h-[300px]"},ue={__name:"ChartsView",setup(g){gt.register(ht,xt,_t,kt,LinearScale,$t,wt,St,Ct);const{getStocks:k,getRealizedTrades:P}=H(),T=q("allocation"),o=q([]),a=q([]),d=q({}),S=[{id:"allocation",name:"持股分配"},{id:"profit",name:"總體損益"},{id:"realized",name:"已實現收益趨勢"}],_=["#4CAF50","#2196F3","#F44336","#FF9800","#9C27B0","#3F51B5","#009688","#795548","#607D8B","#E91E63"],l=F(()=>o.value.length>0),r=F(()=>a.value.length>0),n=F(()=>l.value||r.value),h=F(()=>{if(!l.value)return[];const m=o.value.map(b=>{var C;const e=(((C=d.value[b.symbol])==null?void 0:C.price)||b.cost)*b.quantity;return{...b,marketValue:e}}),v=m.reduce((b,i)=>b+i.marketValue,0);return m.map(b=>({...b,percentage:b.marketValue/v*100})).sort((b,i)=>i.marketValue-b.marketValue)}),A=F(()=>l.value?{labels:h.value.map(m=>m.name),datasets:[{data:h.value.map(m=>m.marketValue),backgroundColor:h.value.map((m,v)=>_[v%_.length]),hoverOffset:4}]}:{datasets:[]}),z=F(()=>{const m=["未實現損益","已實現收益","總體損益"],v=o.value.reduce((C,p)=>{var $;const u=((($=d.value[p.symbol])==null?void 0:$.price)||p.cost)*p.quantity,s=p.cost*p.quantity;return C+(u-s)},0),b=a.value.reduce((C,p)=>C+p.profit,0),i=v+b,e=[v,b,i];return{labels:m,datasets:[{label:"損益金額",data:e,backgroundColor:e.map(C=>C>=0?"rgba(76, 175, 80, 0.6)":"rgba(244, 67, 54, 0.6)"),borderColor:e.map(C=>C>=0?"rgb(76, 175, 80)":"rgb(244, 67, 54)"),borderWidth:1}]}}),w=F(()=>{if(!r.value)return{datasets:[]};const m=[...a.value].sort((e,C)=>new Date(e.date)-new Date(C.date));let v=0;const b=[],i=[];return m.forEach(e=>{v+=e.profit,b.push(v),i.push(rt(e.date).format("YYYY/MM/DD"))}),{labels:i,datasets:[{label:"累計已實現收益",data:b,borderColor:"rgb(54, 162, 235)",backgroundColor:"rgba(54, 162, 235, 0.5)",tension:.1,pointBackgroundColor:b.map(e=>e>=0?"rgb(76, 175, 80)":"rgb(244, 67, 54)")}]}}),E={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(m){const v=m.label||"",b=m.raw||0,i=b/m.dataset.data.reduce((e,C)=>e+C,0)*100;return`${v}: ${R(b)} (${i.toFixed(2)}%)`}}}}},O={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(m){return`${m.dataset.label}: ${R(m.raw)}`}}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(m){return R(m)}}}}},D={responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{callbacks:{label:function(m){return`${m.dataset.label}: ${R(m.raw)}`}}}},scales:{y:{ticks:{callback:function(m){return R(m)}}}}},R=m=>new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(m),L=()=>{o.value=k(),a.value=P();const m={};o.value.forEach(v=>{m[v.symbol]={price:v.cost,change:0,changePercent:0}}),d.value=m;try{const v=localStorage.getItem("investment-tracker-prices");v&&(d.value={...d.value,...JSON.parse(v)})}catch(v){console.error("無法讀取價格資料",v)}};return X(()=>{L(),window.addEventListener("storage",m=>{(m.key==="investment-tracker-stocks"||m.key==="investment-tracker-realized"||m.key==="investment-tracker-prices")&&L()})}),(m,v)=>(f(),x("div",null,[v[4]||(v[4]=t("h2",{class:"text-xl font-bold mb-4"},"圖表分析",-1)),t("div",Yt,[t("div",Jt,[(f(),x(J,null,K(S,b=>t("button",{key:b.id,onClick:i=>T.value=b.id,class:N(["px-4 py-2 rounded-md transition-colors mb-2",T.value===b.id?"bg-primary text-white":"bg-gray-100 text-gray-700"])},y(b.name),11,Kt)),64))])]),t("div",Ht,[T.value==="allocation"?(f(),x("div",Zt,[v[1]||(v[1]=t("h3",{class:"text-lg font-medium mb-4"},"持股分配",-1)),l.value?(f(),x("div",Qt,[t("div",Xt,[Y(U(Tt),{"chart-data":A.value,"chart-options":E},null,8,["chart-data"])]),t("div",te,[v[0]||(v[0]=t("h4",{class:"text-md font-medium mb-2"},"持股比例",-1)),(f(!0),x(J,null,K(h.value,(b,i)=>(f(),x("div",{key:i,class:"flex items-center mb-2"},[t("div",{class:"w-4 h-4 rounded-full mr-2",style:Dt({backgroundColor:_[i%_.length]})},null,4),t("div",ee,y(b.name)+" ("+y(b.symbol)+")",1),t("div",se,y(b.percentage.toFixed(2))+"%",1)]))),128))])])):(f(),x("div",Gt," 尚未新增持股資料，請先在持股管理頁面新增股票。 "))])):W("",!0),T.value==="profit"?(f(),x("div",le,[v[2]||(v[2]=t("h3",{class:"text-lg font-medium mb-4"},"總體損益",-1)),n.value?(f(),x("div",oe,[Y(U(Pt),{"chart-data":z.value,"chart-options":O},null,8,["chart-data"])])):(f(),x("div",ne," 尚未有足夠資料，請先新增持股或已實現收益。 "))])):W("",!0),T.value==="realized"?(f(),x("div",ae,[v[3]||(v[3]=t("h3",{class:"text-lg font-medium mb-4"},"已實現收益分析",-1)),r.value?(f(),x("div",ie,[Y(U(qt),{"chart-data":w.value,"chart-options":D},null,8,["chart-data"])])):(f(),x("div",re," 尚未新增已實現收益資料，請先在已實現收益頁面新增資料。 "))])):W("",!0)])]))}},dt="https://yahoo-finance-backend.vercel.app";function Q(g){return g?g.includes(".")?g:/^\d+$/.test(g)?`${g}.TW`:g:""}async function ce(g){const k=g,P=Q(g),T=`${dt}/api/stock/${P}`;console.log(`請求股票數據：${P}`);try{const o=await it.get(T,{headers:{Accept:"application/json","Cache-Control":"no-cache"},timeout:1e4});if(o.data.error)throw new Error(`API 錯誤: ${o.data.error}`);return console.log(`成功獲取 ${P} 價格: ${o.data.price} ${o.data.currency}`),{...o.data,originalSymbol:k}}catch(o){throw console.error(`獲取 ${P} 價格失敗:`,o),o.response?new Error(`API 請求失敗: ${o.response.status} ${o.response.statusText}`):o.request?new Error("無法連接到服務器，請檢查網絡連接"):o}}async function de(g){const k=g.filter(o=>o&&o.trim());if(k.length===0)return[];const P=k.map(o=>Q(o)),T=`${dt}/api/stocks?symbols=${P.join(",")}`;console.log(`批量獲取股票數據: ${k.join(", ")}`);try{const o=await it.get(T,{headers:{Accept:"application/json","Cache-Control":"no-cache"},timeout:15e3});return console.log(`成功獲取 ${o.data.length} 支股票數據`),o.data.map((d,S)=>(d.originalSymbol||(d.originalSymbol=k[S]),d))}catch(o){console.error("批量獲取股票數據失敗:",o),console.log("嘗試逐個獲取股票數據...");const a=k.map(d=>ce(d).catch(S=>(console.error(`獲取 ${d} 數據失敗:`,S),{error:!0,errorMessage:S.message||"未知錯誤",symbol:Q(d),originalSymbol:d})));return Promise.all(a)}}function nt(g,k,P=2){return g==null?"-":`${k==="TWD"?"NT$":"$"}${g.toFixed(P)}`}function ot(g){return g==null?"":g>0?"positive":g<0?"negative":""}const me={class:"card bg-white p-4 mb-6"},pe={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},be={class:"p-3 bg-gray-50 rounded-lg"},ye={class:"text-lg font-semibold"},ve={class:"p-3 bg-gray-50 rounded-lg"},fe={class:"text-lg font-semibold"},ge={class:"p-3 bg-gray-50 rounded-lg"},he={class:"text-sm"},xe={class:"flex justify-between items-center mb-4"},_e={key:0,class:"inline-block animate-spin"},ke={class:"card"},$e={key:0,class:"text-center py-6 text-gray-500"},we={key:1,class:"table-container"},Se={class:"table"},Ce={class:"flex space-x-2"},Te=["onClick"],De=["onClick"],Pe={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},qe={class:"bg-white rounded-lg p-6 max-w-md w-full"},ze={class:"text-lg font-bold mb-4"},Fe={class:"mb-4"},Ve={class:"mb-4"},Ie={class:"mb-4"},Ae={class:"mb-4"},Oe={class:"mb-4"},Re={class:"mb-4"},je={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},Ee={class:"bg-white rounded-lg p-6 max-w-md w-full"},Ne={class:"mb-4"},We={class:"flex justify-end space-x-3"},Me={__name:"HomeView",setup(g){const{getStocks:k,addStock:P,updateStock:T,deleteStock:o}=H(),a=q([]),d=q({}),S=q(!1),_=q(null),l=q(null),r=q(!1),n=ut({symbol:"",name:"",market:"台股",cost:0,quantity:0,purchaseDate:new Date().toISOString().split("T")[0]}),h=F(()=>a.value.reduce((u,s)=>u+s.cost*s.quantity,0)),A=F(()=>a.value.reduce((u,s)=>{const $=e(s);return u+$*s.quantity},0)),z=F(()=>A.value-h.value),w=F(()=>h.value===0?0:z.value/h.value*100),E=()=>{a.value=k(),a.value.length>0&&O()},O=async()=>{if(a.value.length!==0){r.value=!0;try{const u=a.value.map(c=>c.symbol),s=await de(u),$={};s.forEach(c=>{const V=c.originalSymbol||c.symbol;$[V]=c}),d.value=$;try{localStorage.setItem("investment-tracker-prices",JSON.stringify($))}catch(c){console.error("無法儲存價格資料到本地存儲",c)}}catch(u){console.error("更新價格出錯",u)}finally{r.value=!1}}},D=u=>{const s=a.value[u];_.value=u,n.symbol=s.symbol,n.name=s.name,n.market=s.market,n.cost=s.cost,n.quantity=s.quantity,n.purchaseDate=s.purchaseDate||"",S.value=!0},R=u=>{l.value=u},L=()=>{l.value!==null&&(o(l.value),E(),l.value=null)},m=()=>{const u={symbol:n.symbol,name:n.name,market:n.market,cost:n.cost,quantity:n.quantity,purchaseDate:n.purchaseDate};_.value!==null?T(_.value,u):P(u),E(),_.value=null,S.value=!1,b()},v=()=>{S.value=!1,_.value=null,b()},b=()=>{n.symbol="",n.name="",n.market="台股",n.cost=0,n.quantity=0,n.purchaseDate=new Date().toISOString().split("T")[0]},i=u=>new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(u),e=u=>{const s=d.value[u.symbol]||d.value[`${u.symbol}.TW`]||Object.values(d.value).find($=>$.originalSymbol===u.symbol||$.symbol===u.symbol||$.symbol===`${u.symbol}.TW`);return(s==null?void 0:s.price)||0},C=u=>{const s=d.value[u.symbol]||d.value[`${u.symbol}.TW`]||Object.values(d.value).find($=>$.originalSymbol===u.symbol||$.symbol===u.symbol||$.symbol===`${u.symbol}.TW`);return(s==null?void 0:s.change)||0},p=(u,s)=>{if(!s)return"載入中...";const $=u.cost*u.quantity,V=s*u.quantity-$,Z=$>0?V/$*100:0,tt=V>=0?"+":"";return`${tt}${i(V)} (${tt}${Z.toFixed(2)}%)`},B=(u,s)=>{if(!s)return"";const $=u.cost*u.quantity,V=s*u.quantity-$;return V>0?"positive":V<0?"negative":""};return X(()=>{E();const u=setInterval(O,5*60*1e3);return()=>clearInterval(u)}),(u,s)=>{var $;return f(),x("div",null,[s[23]||(s[23]=t("h2",{class:"text-xl font-bold mb-4"},"持股管理",-1)),t("div",me,[t("div",pe,[t("div",be,[s[9]||(s[9]=t("h3",{class:"text-gray-500 text-sm"},"總投資成本",-1)),t("p",ye,y(i(h.value)),1)]),t("div",ve,[s[10]||(s[10]=t("h3",{class:"text-gray-500 text-sm"},"目前總市值",-1)),t("p",fe,y(i(A.value)),1)]),t("div",ge,[s[11]||(s[11]=t("h3",{class:"text-gray-500 text-sm"},"未實現損益",-1)),t("p",{class:N(["text-lg font-semibold",U(ot)(z.value)])},[at(y(z.value>0?"+":"")+y(i(z.value))+" ",1),t("span",he," ("+y(w.value>0?"+":"")+y(w.value.toFixed(2))+"%) ",1)],2)])])]),t("div",xe,[t("button",{onClick:s[0]||(s[0]=c=>S.value=!0),class:"btn btn-primary"}," + 新增持股 "),t("button",{onClick:O,class:"btn bg-gray-100 text-gray-700 flex items-center"},[s[12]||(s[12]=t("span",{class:"mr-1"},"更新價格",-1)),r.value?(f(),x("span",_e,"⟳")):W("",!0)])]),t("div",ke,[a.value.length===0?(f(),x("div",$e," 尚未新增持股資料，請點擊「新增持股」按鈕開始追蹤。 ")):(f(),x("div",we,[t("table",Se,[s[13]||(s[13]=t("thead",null,[t("tr",null,[t("th",null,"代碼"),t("th",null,"名稱"),t("th",null,"市場"),t("th",null,"持有股數"),t("th",null,"成本價"),t("th",null,"目前價格"),t("th",null,"市值"),t("th",null,"損益"),t("th",null,"操作")])],-1)),t("tbody",null,[(f(!0),x(J,null,K(a.value,(c,V)=>(f(),x("tr",{key:V},[t("td",null,y(c.symbol),1),t("td",null,y(c.name),1),t("td",null,y(c.market),1),t("td",null,y(c.quantity),1),t("td",null,y(U(nt)(c.cost)),1),t("td",{class:N(U(ot)(C(c)))},y(e(c)?U(nt)(e(c)):"載入中..."),3),t("td",null,y(e(c)?i(c.quantity*e(c)):"載入中..."),1),t("td",{class:N(B(c,e(c)))},y(p(c,e(c))),3),t("td",null,[t("div",Ce,[t("button",{onClick:Z=>D(V),class:"text-primary text-sm"}," 編輯 ",8,Te),t("button",{onClick:Z=>R(V),class:"text-danger text-sm"}," 刪除 ",8,De)])])]))),128))])])]))]),S.value?(f(),x("div",Pe,[t("div",qe,[t("h3",ze,y(_.value===null?"新增持股":"編輯持股"),1),t("form",{onSubmit:ct(m,["prevent"])},[t("div",Fe,[s[14]||(s[14]=t("label",{class:"block text-sm font-medium mb-1"},"股票代碼",-1)),I(t("input",{"onUpdate:modelValue":s[1]||(s[1]=c=>n.symbol=c),required:"",class:"input w-full",placeholder:"例如：2330.TW 或 AAPL"},null,512),[[j,n.symbol]])]),t("div",Ve,[s[15]||(s[15]=t("label",{class:"block text-sm font-medium mb-1"},"股票名稱",-1)),I(t("input",{"onUpdate:modelValue":s[2]||(s[2]=c=>n.name=c),required:"",class:"input w-full",placeholder:"例如：台積電 或 蘋果"},null,512),[[j,n.name]])]),t("div",Ie,[s[17]||(s[17]=t("label",{class:"block text-sm font-medium mb-1"},"市場",-1)),I(t("select",{"onUpdate:modelValue":s[3]||(s[3]=c=>n.market=c),required:"",class:"input w-full"},s[16]||(s[16]=[t("option",{value:"台股"},"台股",-1),t("option",{value:"美股"},"美股",-1),t("option",{value:"其他"},"其他",-1)]),512),[[zt,n.market]])]),t("div",Ae,[s[18]||(s[18]=t("label",{class:"block text-sm font-medium mb-1"},"成本價",-1)),I(t("input",{"onUpdate:modelValue":s[4]||(s[4]=c=>n.cost=c),type:"number",step:"0.01",required:"",class:"input w-full",placeholder:"每股成本"},null,512),[[j,n.cost,void 0,{number:!0}]])]),t("div",Oe,[s[19]||(s[19]=t("label",{class:"block text-sm font-medium mb-1"},"持有股數",-1)),I(t("input",{"onUpdate:modelValue":s[5]||(s[5]=c=>n.quantity=c),type:"number",required:"",class:"input w-full",placeholder:"持有數量"},null,512),[[j,n.quantity,void 0,{number:!0}]])]),t("div",Re,[s[20]||(s[20]=t("label",{class:"block text-sm font-medium mb-1"},"購買日期",-1)),I(t("input",{"onUpdate:modelValue":s[6]||(s[6]=c=>n.purchaseDate=c),type:"date",class:"input w-full"},null,512),[[j,n.purchaseDate]])]),t("div",{class:"flex justify-end space-x-3"},[t("button",{type:"button",onClick:v,class:"btn bg-gray-200 text-gray-800"}," 取消 "),s[21]||(s[21]=t("button",{type:"submit",class:"btn btn-primary"},"儲存",-1))])],32)])])):W("",!0),l.value!==null?(f(),x("div",je,[t("div",Ee,[s[22]||(s[22]=t("h3",{class:"text-lg font-bold mb-4"},"確認刪除",-1)),t("p",Ne," 確定要刪除「"+y(($=a.value[l.value])==null?void 0:$.name)+"」的持股資料嗎？ ",1),t("div",We,[t("button",{onClick:s[7]||(s[7]=c=>l.value=null),class:"btn bg-gray-200 text-gray-800"}," 取消 "),t("button",{onClick:s[8]||(s[8]=c=>L()),class:"btn btn-danger"}," 確認刪除 ")])])])):W("",!0)])}}},Ue={class:"card bg-white p-4 mb-6"},Le={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Be={class:"p-3 bg-gray-50 rounded-lg"},Ye={class:"p-3 bg-gray-50 rounded-lg"},Je={class:"text-lg font-semibold"},Ke={class:"flex justify-between items-center mb-4"},He={class:"card"},Ze={key:0,class:"text-center py-6 text-gray-500"},Ge={key:1,class:"table-container"},Qe={class:"table"},Xe={class:"flex space-x-2"},ts=["onClick"],es=["onClick"],ss={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},ls={class:"bg-white rounded-lg p-6 max-w-md w-full"},ns={class:"text-lg font-bold mb-4"},os={class:"mb-4"},as={class:"mb-4"},rs={class:"mb-4"},is={class:"mb-4"},us={class:"mb-4"},cs={class:"mb-4"},ds=["value"],ms={class:"mb-4"},ps={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10"},bs={class:"bg-white rounded-lg p-6 max-w-md w-full"},ys={class:"mb-4"},vs={class:"flex justify-end space-x-3"},fs={__name:"RealizedView",setup(g){const{getRealizedTrades:k,addRealizedTrade:P,updateRealizedTrade:T,deleteRealizedTrade:o}=H(),a=q([]),d=q(!1),S=q(null),_=q(null),l=ut({symbol:"",name:"",sellPrice:0,quantity:0,buyPrice:0,date:new Date().toISOString().split("T")[0]}),r=F(()=>a.value.reduce((i,e)=>i+e.profit,0)),n=F(()=>[...a.value].sort((i,e)=>new Date(e.date)-new Date(i.date))),h=()=>{a.value=k()},A=i=>{const e=a.value[i];S.value=i,l.symbol=e.symbol,l.name=e.name,l.sellPrice=e.sellPrice,l.quantity=e.quantity,l.buyPrice=e.cost/e.quantity||0,l.date=e.date,d.value=!0},z=i=>{_.value=i},w=()=>{_.value!==null&&(o(_.value),h(),_.value=null)},E=()=>{const i=b(),C=l.sellPrice*l.quantity-i,p={symbol:l.symbol,name:l.name,sellPrice:l.sellPrice,quantity:l.quantity,cost:i,profit:C,date:l.date};S.value!==null?T(S.value,p):P(p),h(),S.value=null,d.value=!1,D()},O=()=>{d.value=!1,S.value=null,D()},D=()=>{l.symbol="",l.name="",l.sellPrice=0,l.quantity=0,l.buyPrice=0,l.date=new Date().toISOString().split("T")[0]},R=i=>new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(i),L=i=>i.toFixed(2),m=i=>rt(i).format("YYYY/MM/DD"),v=i=>{if(i.cost===0)return"0.00%";const e=i.profit/i.cost*100;return`${e>=0?"+":""}${e.toFixed(2)}%`},b=()=>l.buyPrice*l.quantity;return X(()=>{h()}),(i,e)=>{var C;return f(),x("div",null,[e[21]||(e[21]=t("h2",{class:"text-xl font-bold mb-4"},"已實現收益",-1)),t("div",Ue,[t("div",Le,[t("div",Be,[e[9]||(e[9]=t("h3",{class:"text-gray-500 text-sm"},"總實現收益",-1)),t("p",{class:N(["text-lg font-semibold",r.value>=0?"positive":"negative"])},y(r.value>0?"+":"")+y(R(r.value)),3)]),t("div",Ye,[e[10]||(e[10]=t("h3",{class:"text-gray-500 text-sm"},"總交易次數",-1)),t("p",Je,y(a.value.length)+" 次",1)])])]),t("div",Ke,[t("button",{onClick:e[0]||(e[0]=p=>d.value=!0),class:"btn btn-primary"}," + 新增已實現收益 ")]),t("div",He,[a.value.length===0?(f(),x("div",Ze," 尚未新增已實現收益資料，請點擊「新增已實現收益」按鈕進行新增。 ")):(f(),x("div",Ge,[t("table",Qe,[e[11]||(e[11]=t("thead",null,[t("tr",null,[t("th",null,"日期"),t("th",null,"代碼"),t("th",null,"名稱"),t("th",null,"賣出價格"),t("th",null,"數量"),t("th",null,"總成本"),t("th",null,"實現損益"),t("th",null,"報酬率"),t("th",null,"操作")])],-1)),t("tbody",null,[(f(!0),x(J,null,K(n.value,(p,B)=>(f(),x("tr",{key:B},[t("td",null,y(m(p.date)),1),t("td",null,y(p.symbol),1),t("td",null,y(p.name),1),t("td",null,y(L(p.sellPrice)),1),t("td",null,y(p.quantity),1),t("td",null,y(R(p.cost)),1),t("td",{class:N(p.profit>=0?"positive":"negative")},y(p.profit>0?"+":"")+y(R(p.profit)),3),t("td",{class:N(p.profit>=0?"positive":"negative")},y(v(p)),3),t("td",null,[t("div",Xe,[t("button",{onClick:u=>A(B),class:"text-primary text-sm"}," 編輯 ",8,ts),t("button",{onClick:u=>z(B),class:"text-danger text-sm"}," 刪除 ",8,es)])])]))),128))])])]))]),d.value?(f(),x("div",ss,[t("div",ls,[t("h3",ns,y(S.value===null?"新增已實現收益":"編輯已實現收益"),1),t("form",{onSubmit:ct(E,["prevent"])},[t("div",os,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium mb-1"},"股票代碼",-1)),I(t("input",{"onUpdate:modelValue":e[1]||(e[1]=p=>l.symbol=p),required:"",class:"input w-full",placeholder:"例如：2330.TW 或 AAPL"},null,512),[[j,l.symbol]])]),t("div",as,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium mb-1"},"股票名稱",-1)),I(t("input",{"onUpdate:modelValue":e[2]||(e[2]=p=>l.name=p),required:"",class:"input w-full",placeholder:"例如：台積電 或 蘋果"},null,512),[[j,l.name]])]),t("div",rs,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium mb-1"},"賣出價格",-1)),I(t("input",{"onUpdate:modelValue":e[3]||(e[3]=p=>l.sellPrice=p),type:"number",step:"0.01",required:"",class:"input w-full",placeholder:"每股賣出價格"},null,512),[[j,l.sellPrice,void 0,{number:!0}]])]),t("div",is,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium mb-1"},"數量",-1)),I(t("input",{"onUpdate:modelValue":e[4]||(e[4]=p=>l.quantity=p),type:"number",required:"",class:"input w-full",placeholder:"賣出數量"},null,512),[[j,l.quantity,void 0,{number:!0}]])]),t("div",us,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium mb-1"},"買入價格",-1)),I(t("input",{"onUpdate:modelValue":e[5]||(e[5]=p=>l.buyPrice=p),type:"number",step:"0.01",required:"",class:"input w-full",placeholder:"每股買入價格"},null,512),[[j,l.buyPrice,void 0,{number:!0}]])]),t("div",cs,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium mb-1"},"總成本",-1)),t("input",{value:b(),type:"number",step:"0.01",disabled:"",class:"input w-full bg-gray-100"},null,8,ds)]),t("div",ms,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium mb-1"},"賣出日期",-1)),I(t("input",{"onUpdate:modelValue":e[6]||(e[6]=p=>l.date=p),type:"date",required:"",class:"input w-full"},null,512),[[j,l.date]])]),t("div",{class:"flex justify-end space-x-3"},[t("button",{type:"button",onClick:O,class:"btn bg-gray-200 text-gray-800"}," 取消 "),e[19]||(e[19]=t("button",{type:"submit",class:"btn btn-primary"},"儲存",-1))])],32)])])):W("",!0),_.value!==null?(f(),x("div",ps,[t("div",bs,[e[20]||(e[20]=t("h3",{class:"text-lg font-bold mb-4"},"確認刪除",-1)),t("p",ys," 確定要刪除「"+y((C=a.value[_.value])==null?void 0:C.name)+"」的已實現收益資料嗎？ ",1),t("div",vs,[t("button",{onClick:e[7]||(e[7]=p=>_.value=null),class:"btn bg-gray-200 text-gray-800"}," 取消 "),t("button",{onClick:e[8]||(e[8]=p=>w()),class:"btn btn-danger"}," 確認刪除 ")])])])):W("",!0)])}}},gs=[{path:"/",component:Me},{path:"/realized",component:fs},{path:"/charts",component:ue}],hs=Ft({history:Vt(),routes:gs}),mt=It(Bt);mt.use(hs);mt.mount("#app");
